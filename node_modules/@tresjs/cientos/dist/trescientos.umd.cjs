/**
 * name: @tresjs/cientos
 * version: v1.0.0
 * (c) 2022
 * description: Collection of useful helpers and fully functional, ready-made abstractions for Tres
 * author: Alvaro Saburido <hola@alvarosaburido.dev> (https://github.com/alvarosabu/)
 */
(function(Ne,Te){typeof exports=="object"&&typeof module<"u"?Te(exports,require("vue"),require("@tresjs/core"),require("three")):typeof define=="function"&&define.amd?define(["exports","vue","@tresjs/core","three"],Te):(Ne=typeof globalThis<"u"?globalThis:Ne||self,Te(Ne.trescientos={},Ne.Vue,Ne.core,Ne.Three))})(this,function(Ne,Te,Cs,C){"use strict";function jr(L,u){for(var p=0;p<u.length;p++){const a=u[p];if(typeof a!="string"&&!Array.isArray(a)){for(const d in a)if(d!=="default"&&!(d in L)){const m=Object.getOwnPropertyDescriptor(a,d);m&&Object.defineProperty(L,d,m.get?m:{enumerable:!0,get:()=>a[d]})}}}return Object.freeze(Object.defineProperty(L,Symbol.toStringTag,{value:"Module"}))}function K(L,u,p){return u in L?Object.defineProperty(L,u,{value:p,enumerable:!0,configurable:!0,writable:!0}):L[u]=p,L}const zi=(L,u)=>(L%u+u)%u;class Br extends C.EventDispatcher{constructor(u,p){super(),K(this,"object",void 0),K(this,"domElement",void 0),K(this,"enabled",!0),K(this,"target",new C.Vector3),K(this,"minDistance",0),K(this,"maxDistance",1/0),K(this,"minZoom",0),K(this,"maxZoom",1/0),K(this,"minPolarAngle",0),K(this,"maxPolarAngle",Math.PI),K(this,"minAzimuthAngle",-1/0),K(this,"maxAzimuthAngle",1/0),K(this,"enableDamping",!1),K(this,"dampingFactor",.05),K(this,"enableZoom",!0),K(this,"zoomSpeed",1),K(this,"enableRotate",!0),K(this,"rotateSpeed",1),K(this,"enablePan",!0),K(this,"panSpeed",1),K(this,"screenSpacePanning",!0),K(this,"keyPanSpeed",7),K(this,"autoRotate",!1),K(this,"autoRotateSpeed",2),K(this,"reverseOrbit",!1),K(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),K(this,"mouseButtons",{LEFT:C.MOUSE.ROTATE,MIDDLE:C.MOUSE.DOLLY,RIGHT:C.MOUSE.PAN}),K(this,"touches",{ONE:C.TOUCH.ROTATE,TWO:C.TOUCH.DOLLY_PAN}),K(this,"target0",void 0),K(this,"position0",void 0),K(this,"zoom0",void 0),K(this,"_domElementKeyEvents",null),K(this,"getPolarAngle",void 0),K(this,"getAzimuthalAngle",void 0),K(this,"setPolarAngle",void 0),K(this,"setAzimuthalAngle",void 0),K(this,"getDistance",void 0),K(this,"listenToKeyEvents",void 0),K(this,"saveState",void 0),K(this,"reset",void 0),K(this,"update",void 0),K(this,"connect",void 0),K(this,"dispose",void 0),this.object=u,this.domElement=p,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object instanceof C.PerspectiveCamera?this.object.zoom:1,this.getPolarAngle=()=>E.phi,this.getAzimuthalAngle=()=>E.theta,this.setPolarAngle=P=>{let T=zi(P,2*Math.PI),U=E.phi;U<0&&(U+=2*Math.PI),T<0&&(T+=2*Math.PI);let H=Math.abs(T-U);2*Math.PI-H<H&&(T<U?T+=2*Math.PI:U+=2*Math.PI),g.phi=T-U,a.update()},this.setAzimuthalAngle=P=>{let T=zi(P,2*Math.PI),U=E.theta;U<0&&(U+=2*Math.PI),T<0&&(T+=2*Math.PI);let H=Math.abs(T-U);2*Math.PI-H<H&&(T<U?T+=2*Math.PI:U+=2*Math.PI),g.theta=T-U,a.update()},this.getDistance=()=>a.object.position.distanceTo(a.target),this.listenToKeyEvents=P=>{P.addEventListener("keydown",Ye),this._domElementKeyEvents=P},this.saveState=()=>{a.target0.copy(a.target),a.position0.copy(a.object.position),a.zoom0=a.object instanceof C.PerspectiveCamera?a.object.zoom:1},this.reset=()=>{a.target.copy(a.target0),a.object.position.copy(a.position0),a.object instanceof C.PerspectiveCamera&&(a.object.zoom=a.zoom0,a.object.updateProjectionMatrix()),a.dispatchEvent(d),a.update(),f=b.NONE},this.update=(()=>{const P=new C.Vector3,T=new C.Quaternion().setFromUnitVectors(u.up,new C.Vector3(0,1,0)),U=T.clone().invert(),H=new C.Vector3,ae=new C.Quaternion,Me=2*Math.PI;return function(){const Jt=a.object.position;P.copy(Jt).sub(a.target),P.applyQuaternion(T),E.setFromVector3(P),a.autoRotate&&f===b.NONE&&Ce(se()),a.enableDamping?(E.theta+=g.theta*a.dampingFactor,E.phi+=g.phi*a.dampingFactor):(E.theta+=g.theta,E.phi+=g.phi);let we=a.minAzimuthAngle,xe=a.maxAzimuthAngle;return isFinite(we)&&isFinite(xe)&&(we<-Math.PI?we+=Me:we>Math.PI&&(we-=Me),xe<-Math.PI?xe+=Me:xe>Math.PI&&(xe-=Me),we<=xe?E.theta=Math.max(we,Math.min(xe,E.theta)):E.theta=E.theta>(we+xe)/2?Math.max(we,E.theta):Math.min(xe,E.theta)),E.phi=Math.max(a.minPolarAngle,Math.min(a.maxPolarAngle,E.phi)),E.makeSafe(),E.radius*=M,E.radius=Math.max(a.minDistance,Math.min(a.maxDistance,E.radius)),a.enableDamping===!0?a.target.addScaledVector(N,a.dampingFactor):a.target.add(N),P.setFromSpherical(E),P.applyQuaternion(U),Jt.copy(a.target).add(P),a.object.lookAt(a.target),a.enableDamping===!0?(g.theta*=1-a.dampingFactor,g.phi*=1-a.dampingFactor,N.multiplyScalar(1-a.dampingFactor)):(g.set(0,0,0),N.set(0,0,0)),M=1,A||H.distanceToSquared(a.object.position)>x||8*(1-ae.dot(a.object.quaternion))>x?(a.dispatchEvent(d),H.copy(a.object.position),ae.copy(a.object.quaternion),A=!1,!0):!1}})(),this.connect=P=>{P===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),a.domElement=P,a.domElement.style.touchAction="none",a.domElement.addEventListener("contextmenu",Ie),a.domElement.addEventListener("pointerdown",Nt),a.domElement.addEventListener("pointercancel",He),a.domElement.addEventListener("wheel",Oe)},this.dispose=()=>{var P,T,U,H,ae,Me;(P=a.domElement)===null||P===void 0||P.removeEventListener("contextmenu",Ie),(T=a.domElement)===null||T===void 0||T.removeEventListener("pointerdown",Nt),(U=a.domElement)===null||U===void 0||U.removeEventListener("pointercancel",He),(H=a.domElement)===null||H===void 0||H.removeEventListener("wheel",Oe),(ae=a.domElement)===null||ae===void 0||ae.ownerDocument.removeEventListener("pointermove",qe),(Me=a.domElement)===null||Me===void 0||Me.ownerDocument.removeEventListener("pointerup",nt),a._domElementKeyEvents!==null&&a._domElementKeyEvents.removeEventListener("keydown",Ye)};const a=this,d={type:"change"},m={type:"start"},h={type:"end"},b={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let f=b.NONE;const x=1e-6,E=new C.Spherical,g=new C.Spherical;let M=1;const N=new C.Vector3;let A=!1;const F=new C.Vector2,I=new C.Vector2,O=new C.Vector2,Y=new C.Vector2,D=new C.Vector2,re=new C.Vector2,de=new C.Vector2,ne=new C.Vector2,X=new C.Vector2,G=[],ee={};function se(){return 2*Math.PI/60/60*a.autoRotateSpeed}function _e(){return Math.pow(.95,a.zoomSpeed)}function Ce(P){a.reverseOrbit?g.theta+=P:g.theta-=P}function he(P){a.reverseOrbit?g.phi+=P:g.phi-=P}const ue=(()=>{const P=new C.Vector3;return function(U,H){P.setFromMatrixColumn(H,0),P.multiplyScalar(-U),N.add(P)}})(),fe=(()=>{const P=new C.Vector3;return function(U,H){a.screenSpacePanning===!0?P.setFromMatrixColumn(H,1):(P.setFromMatrixColumn(H,0),P.crossVectors(a.object.up,P)),P.multiplyScalar(U),N.add(P)}})(),W=(()=>{const P=new C.Vector3;return function(U,H){const ae=a.domElement;if(ae&&a.object instanceof C.PerspectiveCamera&&a.object.isPerspectiveCamera){const Me=a.object.position;P.copy(Me).sub(a.target);let vt=P.length();vt*=Math.tan(a.object.fov/2*Math.PI/180),ue(2*U*vt/ae.clientHeight,a.object.matrix),fe(2*H*vt/ae.clientHeight,a.object.matrix)}else ae&&a.object instanceof C.OrthographicCamera&&a.object.isOrthographicCamera?(ue(U*(a.object.right-a.object.left)/a.object.zoom/ae.clientWidth,a.object.matrix),fe(H*(a.object.top-a.object.bottom)/a.object.zoom/ae.clientHeight,a.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),a.enablePan=!1)}})();function B(P){a.object instanceof C.PerspectiveCamera&&a.object.isPerspectiveCamera?M/=P:a.object instanceof C.OrthographicCamera&&a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom*P)),a.object.updateProjectionMatrix(),A=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function ut(P){a.object instanceof C.PerspectiveCamera&&a.object.isPerspectiveCamera?M*=P:a.object instanceof C.OrthographicCamera&&a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom/P)),a.object.updateProjectionMatrix(),A=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function Yt(P){F.set(P.clientX,P.clientY)}function Xt(P){de.set(P.clientX,P.clientY)}function ge(P){Y.set(P.clientX,P.clientY)}function At(P){I.set(P.clientX,P.clientY),O.subVectors(I,F).multiplyScalar(a.rotateSpeed);const T=a.domElement;T&&(Ce(2*Math.PI*O.x/T.clientHeight),he(2*Math.PI*O.y/T.clientHeight)),F.copy(I),a.update()}function $(P){ne.set(P.clientX,P.clientY),X.subVectors(ne,de),X.y>0?B(_e()):X.y<0&&ut(_e()),de.copy(ne),a.update()}function oe(P){D.set(P.clientX,P.clientY),re.subVectors(D,Y).multiplyScalar(a.panSpeed),W(re.x,re.y),Y.copy(D),a.update()}function bn(P){P.deltaY<0?ut(_e()):P.deltaY>0&&B(_e()),a.update()}function Wt(P){let T=!1;switch(P.code){case a.keys.UP:W(0,a.keyPanSpeed),T=!0;break;case a.keys.BOTTOM:W(0,-a.keyPanSpeed),T=!0;break;case a.keys.LEFT:W(a.keyPanSpeed,0),T=!0;break;case a.keys.RIGHT:W(-a.keyPanSpeed,0),T=!0;break}T&&(P.preventDefault(),a.update())}function Tt(){if(G.length==1)F.set(G[0].pageX,G[0].pageY);else{const P=.5*(G[0].pageX+G[1].pageX),T=.5*(G[0].pageY+G[1].pageY);F.set(P,T)}}function Vt(){if(G.length==1)Y.set(G[0].pageX,G[0].pageY);else{const P=.5*(G[0].pageX+G[1].pageX),T=.5*(G[0].pageY+G[1].pageY);Y.set(P,T)}}function Pe(){const P=G[0].pageX-G[1].pageX,T=G[0].pageY-G[1].pageY,U=Math.sqrt(P*P+T*T);de.set(0,U)}function Ee(){a.enableZoom&&Pe(),a.enablePan&&Vt()}function et(){a.enableZoom&&Pe(),a.enableRotate&&Tt()}function tt(P){if(G.length==1)I.set(P.pageX,P.pageY);else{const U=je(P),H=.5*(P.pageX+U.x),ae=.5*(P.pageY+U.y);I.set(H,ae)}O.subVectors(I,F).multiplyScalar(a.rotateSpeed);const T=a.domElement;T&&(Ce(2*Math.PI*O.x/T.clientHeight),he(2*Math.PI*O.y/T.clientHeight)),F.copy(I)}function dt(P){if(G.length==1)D.set(P.pageX,P.pageY);else{const T=je(P),U=.5*(P.pageX+T.x),H=.5*(P.pageY+T.y);D.set(U,H)}re.subVectors(D,Y).multiplyScalar(a.panSpeed),W(re.x,re.y),Y.copy(D)}function ht(P){const T=je(P),U=P.pageX-T.x,H=P.pageY-T.y,ae=Math.sqrt(U*U+H*H);ne.set(0,ae),X.set(0,Math.pow(ne.y/de.y,a.zoomSpeed)),B(X.y),de.copy(ne)}function _n(P){a.enableZoom&&ht(P),a.enablePan&&dt(P)}function gn(P){a.enableZoom&&ht(P),a.enableRotate&&tt(P)}function Nt(P){if(a.enabled!==!1){if(G.length===0){var T,U;(T=a.domElement)===null||T===void 0||T.ownerDocument.addEventListener("pointermove",qe),(U=a.domElement)===null||U===void 0||U.ownerDocument.addEventListener("pointerup",nt)}mt(P),P.pointerType==="touch"?wn(P):Zt(P)}}function qe(P){a.enabled!==!1&&(P.pointerType==="touch"?Ot(P):Qt(P))}function nt(P){if(ke(P),G.length===0){var T,U,H;(T=a.domElement)===null||T===void 0||T.releasePointerCapture(P.pointerId),(U=a.domElement)===null||U===void 0||U.ownerDocument.removeEventListener("pointermove",qe),(H=a.domElement)===null||H===void 0||H.ownerDocument.removeEventListener("pointerup",nt)}a.dispatchEvent(h),f=b.NONE}function He(P){ke(P)}function Zt(P){let T;switch(P.button){case 0:T=a.mouseButtons.LEFT;break;case 1:T=a.mouseButtons.MIDDLE;break;case 2:T=a.mouseButtons.RIGHT;break;default:T=-1}switch(T){case C.MOUSE.DOLLY:if(a.enableZoom===!1)return;Xt(P),f=b.DOLLY;break;case C.MOUSE.ROTATE:if(P.ctrlKey||P.metaKey||P.shiftKey){if(a.enablePan===!1)return;ge(P),f=b.PAN}else{if(a.enableRotate===!1)return;Yt(P),f=b.ROTATE}break;case C.MOUSE.PAN:if(P.ctrlKey||P.metaKey||P.shiftKey){if(a.enableRotate===!1)return;Yt(P),f=b.ROTATE}else{if(a.enablePan===!1)return;ge(P),f=b.PAN}break;default:f=b.NONE}f!==b.NONE&&a.dispatchEvent(m)}function Qt(P){if(a.enabled!==!1)switch(f){case b.ROTATE:if(a.enableRotate===!1)return;At(P);break;case b.DOLLY:if(a.enableZoom===!1)return;$(P);break;case b.PAN:if(a.enablePan===!1)return;oe(P);break}}function Oe(P){a.enabled===!1||a.enableZoom===!1||f!==b.NONE&&f!==b.ROTATE||(P.preventDefault(),a.dispatchEvent(m),bn(P),a.dispatchEvent(h))}function Ye(P){a.enabled===!1||a.enablePan===!1||Wt(P)}function wn(P){switch(Fe(P),G.length){case 1:switch(a.touches.ONE){case C.TOUCH.ROTATE:if(a.enableRotate===!1)return;Tt(),f=b.TOUCH_ROTATE;break;case C.TOUCH.PAN:if(a.enablePan===!1)return;Vt(),f=b.TOUCH_PAN;break;default:f=b.NONE}break;case 2:switch(a.touches.TWO){case C.TOUCH.DOLLY_PAN:if(a.enableZoom===!1&&a.enablePan===!1)return;Ee(),f=b.TOUCH_DOLLY_PAN;break;case C.TOUCH.DOLLY_ROTATE:if(a.enableZoom===!1&&a.enableRotate===!1)return;et(),f=b.TOUCH_DOLLY_ROTATE;break;default:f=b.NONE}break;default:f=b.NONE}f!==b.NONE&&a.dispatchEvent(m)}function Ot(P){switch(Fe(P),f){case b.TOUCH_ROTATE:if(a.enableRotate===!1)return;tt(P),a.update();break;case b.TOUCH_PAN:if(a.enablePan===!1)return;dt(P),a.update();break;case b.TOUCH_DOLLY_PAN:if(a.enableZoom===!1&&a.enablePan===!1)return;_n(P),a.update();break;case b.TOUCH_DOLLY_ROTATE:if(a.enableZoom===!1&&a.enableRotate===!1)return;gn(P),a.update();break;default:f=b.NONE}}function Ie(P){a.enabled!==!1&&P.preventDefault()}function mt(P){G.push(P)}function ke(P){delete ee[P.pointerId];for(let T=0;T<G.length;T++)if(G[T].pointerId==P.pointerId){G.splice(T,1);return}}function Fe(P){let T=ee[P.pointerId];T===void 0&&(T=new C.Vector2,ee[P.pointerId]=T),T.set(P.pageX,P.pageY)}function je(P){const T=P.pointerId===G[0].pointerId?G[1]:G[0];return ee[T.pointerId]}p!==void 0&&this.connect(p),this.update()}}class Ur extends C.Loader{constructor(u){super(u),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(p){return new qr(p)}),this.register(function(p){return new Jr(p)}),this.register(function(p){return new eo(p)}),this.register(function(p){return new Yr(p)}),this.register(function(p){return new Xr(p)}),this.register(function(p){return new Wr(p)}),this.register(function(p){return new Zr(p)}),this.register(function(p){return new $r(p)}),this.register(function(p){return new Qr(p)}),this.register(function(p){return new Hr(p)}),this.register(function(p){return new Kr(p)}),this.register(function(p){return new to(p)})}load(u,p,a,d){const m=this;let h;this.resourcePath!==""?h=this.resourcePath:this.path!==""?h=this.path:h=C.LoaderUtils.extractUrlBase(u),this.manager.itemStart(u);const b=function(x){d?d(x):console.error(x),m.manager.itemError(u),m.manager.itemEnd(u)},f=new C.FileLoader(this.manager);f.setPath(this.path),f.setResponseType("arraybuffer"),f.setRequestHeader(this.requestHeader),f.setWithCredentials(this.withCredentials),f.load(u,function(x){try{m.parse(x,h,function(E){p(E),m.manager.itemEnd(u)},b)}catch(E){b(E)}},a,b)}setDRACOLoader(u){return this.dracoLoader=u,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(u){return this.ktx2Loader=u,this}setMeshoptDecoder(u){return this.meshoptDecoder=u,this}register(u){return this.pluginCallbacks.indexOf(u)===-1&&this.pluginCallbacks.push(u),this}unregister(u){return this.pluginCallbacks.indexOf(u)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(u),1),this}parse(u,p,a,d){let m;const h={},b={};if(typeof u=="string")m=u;else if(C.LoaderUtils.decodeText(new Uint8Array(u,0,4))===Ki){try{h[q.KHR_BINARY_GLTF]=new no(u)}catch(g){d&&d(g);return}m=h[q.KHR_BINARY_GLTF].content}else m=C.LoaderUtils.decodeText(new Uint8Array(u));const f=JSON.parse(m);if(f.asset===void 0||f.asset.version[0]<2){d&&d(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const x=new fo(f,{path:p||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});x.fileLoader.setRequestHeader(this.requestHeader);for(let E=0;E<this.pluginCallbacks.length;E++){const g=this.pluginCallbacks[E](x);b[g.name]=g,h[g.name]=!0}if(f.extensionsUsed)for(let E=0;E<f.extensionsUsed.length;++E){const g=f.extensionsUsed[E],M=f.extensionsRequired||[];switch(g){case q.KHR_MATERIALS_UNLIT:h[g]=new Gr;break;case q.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:h[g]=new ro;break;case q.KHR_DRACO_MESH_COMPRESSION:h[g]=new so(f,this.dracoLoader);break;case q.KHR_TEXTURE_TRANSFORM:h[g]=new io;break;case q.KHR_MESH_QUANTIZATION:h[g]=new oo;break;default:M.indexOf(g)>=0&&b[g]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+g+'".')}}x.setExtensions(h),x.setPlugins(b),x.parse(a,d)}parseAsync(u,p){const a=this;return new Promise(function(d,m){a.parse(u,p,d,m)})}}function zr(){let L={};return{get:function(u){return L[u]},add:function(u,p){L[u]=p},remove:function(u){delete L[u]},removeAll:function(){L={}}}}const q={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class Kr{constructor(u){this.parser=u,this.name=q.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const u=this.parser,p=this.parser.json.nodes||[];for(let a=0,d=p.length;a<d;a++){const m=p[a];m.extensions&&m.extensions[this.name]&&m.extensions[this.name].light!==void 0&&u._addNodeRef(this.cache,m.extensions[this.name].light)}}_loadLight(u){const p=this.parser,a="light:"+u;let d=p.cache.get(a);if(d)return d;const m=p.json,f=((m.extensions&&m.extensions[this.name]||{}).lights||[])[u];let x;const E=new C.Color(16777215);f.color!==void 0&&E.fromArray(f.color);const g=f.range!==void 0?f.range:0;switch(f.type){case"directional":x=new C.DirectionalLight(E),x.target.position.set(0,0,-1),x.add(x.target);break;case"point":x=new C.PointLight(E),x.distance=g;break;case"spot":x=new C.SpotLight(E),x.distance=g,f.spot=f.spot||{},f.spot.innerConeAngle=f.spot.innerConeAngle!==void 0?f.spot.innerConeAngle:0,f.spot.outerConeAngle=f.spot.outerConeAngle!==void 0?f.spot.outerConeAngle:Math.PI/4,x.angle=f.spot.outerConeAngle,x.penumbra=1-f.spot.innerConeAngle/f.spot.outerConeAngle,x.target.position.set(0,0,-1),x.add(x.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+f.type)}return x.position.set(0,0,0),x.decay=2,f.intensity!==void 0&&(x.intensity=f.intensity),x.name=p.createUniqueName(f.name||"light_"+u),d=Promise.resolve(x),p.cache.add(a,d),d}createNodeAttachment(u){const p=this,a=this.parser,m=a.json.nodes[u],b=(m.extensions&&m.extensions[this.name]||{}).light;return b===void 0?null:this._loadLight(b).then(function(f){return a._getNodeRef(p.cache,b,f)})}}class Gr{constructor(){this.name=q.KHR_MATERIALS_UNLIT}getMaterialType(){return C.MeshBasicMaterial}extendParams(u,p,a){const d=[];u.color=new C.Color(1,1,1),u.opacity=1;const m=p.pbrMetallicRoughness;if(m){if(Array.isArray(m.baseColorFactor)){const h=m.baseColorFactor;u.color.fromArray(h),u.opacity=h[3]}m.baseColorTexture!==void 0&&d.push(a.assignTexture(u,"map",m.baseColorTexture,C.sRGBEncoding))}return Promise.all(d)}}class $r{constructor(u){this.parser=u,this.name=q.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(u,p){const d=this.parser.json.materials[u];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const m=d.extensions[this.name].emissiveStrength;return m!==void 0&&(p.emissiveIntensity=m),Promise.resolve()}}class qr{constructor(u){this.parser=u,this.name=q.KHR_MATERIALS_CLEARCOAT}getMaterialType(u){const a=this.parser.json.materials[u];return!a.extensions||!a.extensions[this.name]?null:C.MeshPhysicalMaterial}extendMaterialParams(u,p){const a=this.parser,d=a.json.materials[u];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const m=[],h=d.extensions[this.name];if(h.clearcoatFactor!==void 0&&(p.clearcoat=h.clearcoatFactor),h.clearcoatTexture!==void 0&&m.push(a.assignTexture(p,"clearcoatMap",h.clearcoatTexture)),h.clearcoatRoughnessFactor!==void 0&&(p.clearcoatRoughness=h.clearcoatRoughnessFactor),h.clearcoatRoughnessTexture!==void 0&&m.push(a.assignTexture(p,"clearcoatRoughnessMap",h.clearcoatRoughnessTexture)),h.clearcoatNormalTexture!==void 0&&(m.push(a.assignTexture(p,"clearcoatNormalMap",h.clearcoatNormalTexture)),h.clearcoatNormalTexture.scale!==void 0)){const b=h.clearcoatNormalTexture.scale;p.clearcoatNormalScale=new C.Vector2(b,b)}return Promise.all(m)}}class Hr{constructor(u){this.parser=u,this.name=q.KHR_MATERIALS_IRIDESCENCE}getMaterialType(u){const a=this.parser.json.materials[u];return!a.extensions||!a.extensions[this.name]?null:C.MeshPhysicalMaterial}extendMaterialParams(u,p){const a=this.parser,d=a.json.materials[u];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const m=[],h=d.extensions[this.name];return h.iridescenceFactor!==void 0&&(p.iridescence=h.iridescenceFactor),h.iridescenceTexture!==void 0&&m.push(a.assignTexture(p,"iridescenceMap",h.iridescenceTexture)),h.iridescenceIor!==void 0&&(p.iridescenceIOR=h.iridescenceIor),p.iridescenceThicknessRange===void 0&&(p.iridescenceThicknessRange=[100,400]),h.iridescenceThicknessMinimum!==void 0&&(p.iridescenceThicknessRange[0]=h.iridescenceThicknessMinimum),h.iridescenceThicknessMaximum!==void 0&&(p.iridescenceThicknessRange[1]=h.iridescenceThicknessMaximum),h.iridescenceThicknessTexture!==void 0&&m.push(a.assignTexture(p,"iridescenceThicknessMap",h.iridescenceThicknessTexture)),Promise.all(m)}}class Yr{constructor(u){this.parser=u,this.name=q.KHR_MATERIALS_SHEEN}getMaterialType(u){const a=this.parser.json.materials[u];return!a.extensions||!a.extensions[this.name]?null:C.MeshPhysicalMaterial}extendMaterialParams(u,p){const a=this.parser,d=a.json.materials[u];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const m=[];p.sheenColor=new C.Color(0,0,0),p.sheenRoughness=0,p.sheen=1;const h=d.extensions[this.name];return h.sheenColorFactor!==void 0&&p.sheenColor.fromArray(h.sheenColorFactor),h.sheenRoughnessFactor!==void 0&&(p.sheenRoughness=h.sheenRoughnessFactor),h.sheenColorTexture!==void 0&&m.push(a.assignTexture(p,"sheenColorMap",h.sheenColorTexture,C.sRGBEncoding)),h.sheenRoughnessTexture!==void 0&&m.push(a.assignTexture(p,"sheenRoughnessMap",h.sheenRoughnessTexture)),Promise.all(m)}}class Xr{constructor(u){this.parser=u,this.name=q.KHR_MATERIALS_TRANSMISSION}getMaterialType(u){const a=this.parser.json.materials[u];return!a.extensions||!a.extensions[this.name]?null:C.MeshPhysicalMaterial}extendMaterialParams(u,p){const a=this.parser,d=a.json.materials[u];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const m=[],h=d.extensions[this.name];return h.transmissionFactor!==void 0&&(p.transmission=h.transmissionFactor),h.transmissionTexture!==void 0&&m.push(a.assignTexture(p,"transmissionMap",h.transmissionTexture)),Promise.all(m)}}class Wr{constructor(u){this.parser=u,this.name=q.KHR_MATERIALS_VOLUME}getMaterialType(u){const a=this.parser.json.materials[u];return!a.extensions||!a.extensions[this.name]?null:C.MeshPhysicalMaterial}extendMaterialParams(u,p){const a=this.parser,d=a.json.materials[u];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const m=[],h=d.extensions[this.name];p.thickness=h.thicknessFactor!==void 0?h.thicknessFactor:0,h.thicknessTexture!==void 0&&m.push(a.assignTexture(p,"thicknessMap",h.thicknessTexture)),p.attenuationDistance=h.attenuationDistance||1/0;const b=h.attenuationColor||[1,1,1];return p.attenuationColor=new C.Color(b[0],b[1],b[2]),Promise.all(m)}}class Zr{constructor(u){this.parser=u,this.name=q.KHR_MATERIALS_IOR}getMaterialType(u){const a=this.parser.json.materials[u];return!a.extensions||!a.extensions[this.name]?null:C.MeshPhysicalMaterial}extendMaterialParams(u,p){const d=this.parser.json.materials[u];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const m=d.extensions[this.name];return p.ior=m.ior!==void 0?m.ior:1.5,Promise.resolve()}}class Qr{constructor(u){this.parser=u,this.name=q.KHR_MATERIALS_SPECULAR}getMaterialType(u){const a=this.parser.json.materials[u];return!a.extensions||!a.extensions[this.name]?null:C.MeshPhysicalMaterial}extendMaterialParams(u,p){const a=this.parser,d=a.json.materials[u];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const m=[],h=d.extensions[this.name];p.specularIntensity=h.specularFactor!==void 0?h.specularFactor:1,h.specularTexture!==void 0&&m.push(a.assignTexture(p,"specularIntensityMap",h.specularTexture));const b=h.specularColorFactor||[1,1,1];return p.specularColor=new C.Color(b[0],b[1],b[2]),h.specularColorTexture!==void 0&&m.push(a.assignTexture(p,"specularColorMap",h.specularColorTexture,C.sRGBEncoding)),Promise.all(m)}}class Jr{constructor(u){this.parser=u,this.name=q.KHR_TEXTURE_BASISU}loadTexture(u){const p=this.parser,a=p.json,d=a.textures[u];if(!d.extensions||!d.extensions[this.name])return null;const m=d.extensions[this.name],h=p.options.ktx2Loader;if(!h){if(a.extensionsRequired&&a.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return p.loadTextureImage(u,m.source,h)}}class eo{constructor(u){this.parser=u,this.name=q.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(u){const p=this.name,a=this.parser,d=a.json,m=d.textures[u];if(!m.extensions||!m.extensions[p])return null;const h=m.extensions[p],b=d.images[h.source];let f=a.textureLoader;if(b.uri){const x=a.options.manager.getHandler(b.uri);x!==null&&(f=x)}return this.detectSupport().then(function(x){if(x)return a.loadTextureImage(u,h.source,f);if(d.extensionsRequired&&d.extensionsRequired.indexOf(p)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return a.loadTexture(u)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(u){const p=new Image;p.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",p.onload=p.onerror=function(){u(p.height===1)}})),this.isSupported}}class to{constructor(u){this.name=q.EXT_MESHOPT_COMPRESSION,this.parser=u}loadBufferView(u){const p=this.parser.json,a=p.bufferViews[u];if(a.extensions&&a.extensions[this.name]){const d=a.extensions[this.name],m=this.parser.getDependency("buffer",d.buffer),h=this.parser.options.meshoptDecoder;if(!h||!h.supported){if(p.extensionsRequired&&p.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return m.then(function(b){const f=d.byteOffset||0,x=d.byteLength||0,E=d.count,g=d.byteStride,M=new Uint8Array(b,f,x);return h.decodeGltfBufferAsync?h.decodeGltfBufferAsync(E,g,M,d.mode,d.filter).then(function(N){return N.buffer}):h.ready.then(function(){const N=new ArrayBuffer(E*g);return h.decodeGltfBuffer(new Uint8Array(N),E,g,M,d.mode,d.filter),N})})}else return null}}const Ki="glTF",mn=12,Gi={JSON:1313821514,BIN:5130562};class no{constructor(u){this.name=q.KHR_BINARY_GLTF,this.content=null,this.body=null;const p=new DataView(u,0,mn);if(this.header={magic:C.LoaderUtils.decodeText(new Uint8Array(u.slice(0,4))),version:p.getUint32(4,!0),length:p.getUint32(8,!0)},this.header.magic!==Ki)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const a=this.header.length-mn,d=new DataView(u,mn);let m=0;for(;m<a;){const h=d.getUint32(m,!0);m+=4;const b=d.getUint32(m,!0);if(m+=4,b===Gi.JSON){const f=new Uint8Array(u,mn+m,h);this.content=C.LoaderUtils.decodeText(f)}else if(b===Gi.BIN){const f=mn+m;this.body=u.slice(f,f+h)}m+=h}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class so{constructor(u,p){if(!p)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=q.KHR_DRACO_MESH_COMPRESSION,this.json=u,this.dracoLoader=p,this.dracoLoader.preload()}decodePrimitive(u,p){const a=this.json,d=this.dracoLoader,m=u.extensions[this.name].bufferView,h=u.extensions[this.name].attributes,b={},f={},x={};for(const E in h){const g=Es[E]||E.toLowerCase();b[g]=h[E]}for(const E in u.attributes){const g=Es[E]||E.toLowerCase();if(h[E]!==void 0){const M=a.accessors[u.attributes[E]],N=vn[M.componentType];x[g]=N.name,f[g]=M.normalized===!0}}return p.getDependency("bufferView",m).then(function(E){return new Promise(function(g){d.decodeDracoFile(E,function(M){for(const N in M.attributes){const A=M.attributes[N],F=f[N];F!==void 0&&(A.normalized=F)}g(M)},b,x)})})}}class io{constructor(){this.name=q.KHR_TEXTURE_TRANSFORM}extendTexture(u,p){return p.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),p.offset===void 0&&p.rotation===void 0&&p.scale===void 0||(u=u.clone(),p.offset!==void 0&&u.offset.fromArray(p.offset),p.rotation!==void 0&&(u.rotation=p.rotation),p.scale!==void 0&&u.repeat.fromArray(p.scale),u.needsUpdate=!0),u}}class Ps extends C.MeshStandardMaterial{constructor(u){super(),this.isGLTFSpecularGlossinessMaterial=!0;const p=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),a=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),d=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),m=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),h=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),b={specular:{value:new C.Color().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=b,this.onBeforeCompile=function(f){for(const x in b)f.uniforms[x]=b[x];f.fragmentShader=f.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",p).replace("#include <metalnessmap_pars_fragment>",a).replace("#include <roughnessmap_fragment>",d).replace("#include <metalnessmap_fragment>",m).replace("#include <lights_physical_fragment>",h)},Object.defineProperties(this,{specular:{get:function(){return b.specular.value},set:function(f){b.specular.value=f}},specularMap:{get:function(){return b.specularMap.value},set:function(f){b.specularMap.value=f,f?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return b.glossiness.value},set:function(f){b.glossiness.value=f}},glossinessMap:{get:function(){return b.glossinessMap.value},set:function(f){b.glossinessMap.value=f,f?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(u)}copy(u){return super.copy(u),this.specularMap=u.specularMap,this.specular.copy(u.specular),this.glossinessMap=u.glossinessMap,this.glossiness=u.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class ro{constructor(){this.name=q.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return Ps}extendParams(u,p,a){const d=p.extensions[this.name];u.color=new C.Color(1,1,1),u.opacity=1;const m=[];if(Array.isArray(d.diffuseFactor)){const h=d.diffuseFactor;u.color.fromArray(h),u.opacity=h[3]}if(d.diffuseTexture!==void 0&&m.push(a.assignTexture(u,"map",d.diffuseTexture,C.sRGBEncoding)),u.emissive=new C.Color(0,0,0),u.glossiness=d.glossinessFactor!==void 0?d.glossinessFactor:1,u.specular=new C.Color(1,1,1),Array.isArray(d.specularFactor)&&u.specular.fromArray(d.specularFactor),d.specularGlossinessTexture!==void 0){const h=d.specularGlossinessTexture;m.push(a.assignTexture(u,"glossinessMap",h)),m.push(a.assignTexture(u,"specularMap",h,C.sRGBEncoding))}return Promise.all(m)}createMaterial(u){const p=new Ps(u);return p.fog=!0,p.color=u.color,p.map=u.map===void 0?null:u.map,p.lightMap=null,p.lightMapIntensity=1,p.aoMap=u.aoMap===void 0?null:u.aoMap,p.aoMapIntensity=1,p.emissive=u.emissive,p.emissiveIntensity=u.emissiveIntensity===void 0?1:u.emissiveIntensity,p.emissiveMap=u.emissiveMap===void 0?null:u.emissiveMap,p.bumpMap=u.bumpMap===void 0?null:u.bumpMap,p.bumpScale=1,p.normalMap=u.normalMap===void 0?null:u.normalMap,p.normalMapType=C.TangentSpaceNormalMap,u.normalScale&&(p.normalScale=u.normalScale),p.displacementMap=null,p.displacementScale=1,p.displacementBias=0,p.specularMap=u.specularMap===void 0?null:u.specularMap,p.specular=u.specular,p.glossinessMap=u.glossinessMap===void 0?null:u.glossinessMap,p.glossiness=u.glossiness,p.alphaMap=null,p.envMap=u.envMap===void 0?null:u.envMap,p.envMapIntensity=1,p.refractionRatio=.98,p}}class oo{constructor(){this.name=q.KHR_MESH_QUANTIZATION}}class $i extends C.Interpolant{constructor(u,p,a,d){super(u,p,a,d)}copySampleValue_(u){const p=this.resultBuffer,a=this.sampleValues,d=this.valueSize,m=u*d*3+d;for(let h=0;h!==d;h++)p[h]=a[m+h];return p}interpolate_(u,p,a,d){const m=this.resultBuffer,h=this.sampleValues,b=this.valueSize,f=b*2,x=b*3,E=d-p,g=(a-p)/E,M=g*g,N=M*g,A=u*x,F=A-x,I=-2*N+3*M,O=N-M,Y=1-I,D=O-M+g;for(let re=0;re!==b;re++){const de=h[F+re+b],ne=h[F+re+f]*E,X=h[A+re+b],G=h[A+re]*E;m[re]=Y*de+D*ne+I*X+O*G}return m}}const ao=new C.Quaternion;class lo extends $i{interpolate_(u,p,a,d){const m=super.interpolate_(u,p,a,d);return ao.fromArray(m).normalize().toArray(m),m}}const Je={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},vn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},qi={9728:C.NearestFilter,9729:C.LinearFilter,9984:C.NearestMipmapNearestFilter,9985:C.LinearMipmapNearestFilter,9986:C.NearestMipmapLinearFilter,9987:C.LinearMipmapLinearFilter},Hi={33071:C.ClampToEdgeWrapping,33648:C.MirroredRepeatWrapping,10497:C.RepeatWrapping},Yi={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Es={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},pt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},co={CUBICSPLINE:void 0,LINEAR:C.InterpolateLinear,STEP:C.InterpolateDiscrete},ks={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function po(L){return L.DefaultMaterial===void 0&&(L.DefaultMaterial=new C.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:C.FrontSide})),L.DefaultMaterial}function fn(L,u,p){for(const a in p.extensions)L[a]===void 0&&(u.userData.gltfExtensions=u.userData.gltfExtensions||{},u.userData.gltfExtensions[a]=p.extensions[a])}function St(L,u){u.extras!==void 0&&(typeof u.extras=="object"?Object.assign(L.userData,u.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+u.extras))}function uo(L,u,p){let a=!1,d=!1,m=!1;for(let x=0,E=u.length;x<E;x++){const g=u[x];if(g.POSITION!==void 0&&(a=!0),g.NORMAL!==void 0&&(d=!0),g.COLOR_0!==void 0&&(m=!0),a&&d&&m)break}if(!a&&!d&&!m)return Promise.resolve(L);const h=[],b=[],f=[];for(let x=0,E=u.length;x<E;x++){const g=u[x];if(a){const M=g.POSITION!==void 0?p.getDependency("accessor",g.POSITION):L.attributes.position;h.push(M)}if(d){const M=g.NORMAL!==void 0?p.getDependency("accessor",g.NORMAL):L.attributes.normal;b.push(M)}if(m){const M=g.COLOR_0!==void 0?p.getDependency("accessor",g.COLOR_0):L.attributes.color;f.push(M)}}return Promise.all([Promise.all(h),Promise.all(b),Promise.all(f)]).then(function(x){const E=x[0],g=x[1],M=x[2];return a&&(L.morphAttributes.position=E),d&&(L.morphAttributes.normal=g),m&&(L.morphAttributes.color=M),L.morphTargetsRelative=!0,L})}function ho(L,u){if(L.updateMorphTargets(),u.weights!==void 0)for(let p=0,a=u.weights.length;p<a;p++)L.morphTargetInfluences[p]=u.weights[p];if(u.extras&&Array.isArray(u.extras.targetNames)){const p=u.extras.targetNames;if(L.morphTargetInfluences.length===p.length){L.morphTargetDictionary={};for(let a=0,d=p.length;a<d;a++)L.morphTargetDictionary[p[a]]=a}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function mo(L){const u=L.extensions&&L.extensions[q.KHR_DRACO_MESH_COMPRESSION];let p;return u?p="draco:"+u.bufferView+":"+u.indices+":"+Xi(u.attributes):p=L.indices+":"+Xi(L.attributes)+":"+L.mode,p}function Xi(L){let u="";const p=Object.keys(L).sort();for(let a=0,d=p.length;a<d;a++)u+=p[a]+":"+L[p[a]]+";";return u}function Ms(L){switch(L){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function vo(L){return L.search(/\.jpe?g($|\?)/i)>0||L.search(/^data\:image\/jpeg/)===0?"image/jpeg":L.search(/\.webp($|\?)/i)>0||L.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class fo{constructor(u={},p={}){var a,d;this.json=u,this.extensions={},this.plugins={},this.options=p,this.cache=new zr,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const m=typeof navigator<"u"&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,h=typeof navigator<"u"&&((a=navigator.userAgent)===null||a===void 0?void 0:a.indexOf("Firefox"))>-1,b=typeof navigator<"u"&&h?(d=navigator.userAgent)===null||d===void 0?void 0:d.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap>"u"||m||h&&b<98?this.textureLoader=new C.TextureLoader(this.options.manager):this.textureLoader=new C.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new C.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(u){this.extensions=u}setPlugins(u){this.plugins=u}parse(u,p){const a=this,d=this.json,m=this.extensions;this.cache.removeAll(),this._invokeAll(function(h){return h._markDefs&&h._markDefs()}),Promise.all(this._invokeAll(function(h){return h.beforeRoot&&h.beforeRoot()})).then(function(){return Promise.all([a.getDependencies("scene"),a.getDependencies("animation"),a.getDependencies("camera")])}).then(function(h){const b={scene:h[0][d.scene||0],scenes:h[0],animations:h[1],cameras:h[2],asset:d.asset,parser:a,userData:{}};fn(m,b,d),St(b,d),Promise.all(a._invokeAll(function(f){return f.afterRoot&&f.afterRoot(b)})).then(function(){u(b)})}).catch(p)}_markDefs(){const u=this.json.nodes||[],p=this.json.skins||[],a=this.json.meshes||[];for(let d=0,m=p.length;d<m;d++){const h=p[d].joints;for(let b=0,f=h.length;b<f;b++)u[h[b]].isBone=!0}for(let d=0,m=u.length;d<m;d++){const h=u[d];h.mesh!==void 0&&(this._addNodeRef(this.meshCache,h.mesh),h.skin!==void 0&&(a[h.mesh].isSkinnedMesh=!0)),h.camera!==void 0&&this._addNodeRef(this.cameraCache,h.camera)}}_addNodeRef(u,p){p!==void 0&&(u.refs[p]===void 0&&(u.refs[p]=u.uses[p]=0),u.refs[p]++)}_getNodeRef(u,p,a){if(u.refs[p]<=1)return a;const d=a.clone(),m=(h,b)=>{const f=this.associations.get(h);f!=null&&this.associations.set(b,f);for(const[x,E]of h.children.entries())m(E,b.children[x])};return m(a,d),d.name+="_instance_"+u.uses[p]++,d}_invokeOne(u){const p=Object.values(this.plugins);p.push(this);for(let a=0;a<p.length;a++){const d=u(p[a]);if(d)return d}return null}_invokeAll(u){const p=Object.values(this.plugins);p.unshift(this);const a=[];for(let d=0;d<p.length;d++){const m=u(p[d]);m&&a.push(m)}return a}getDependency(u,p){const a=u+":"+p;let d=this.cache.get(a);if(!d){switch(u){case"scene":d=this.loadScene(p);break;case"node":d=this.loadNode(p);break;case"mesh":d=this._invokeOne(function(m){return m.loadMesh&&m.loadMesh(p)});break;case"accessor":d=this.loadAccessor(p);break;case"bufferView":d=this._invokeOne(function(m){return m.loadBufferView&&m.loadBufferView(p)});break;case"buffer":d=this.loadBuffer(p);break;case"material":d=this._invokeOne(function(m){return m.loadMaterial&&m.loadMaterial(p)});break;case"texture":d=this._invokeOne(function(m){return m.loadTexture&&m.loadTexture(p)});break;case"skin":d=this.loadSkin(p);break;case"animation":d=this._invokeOne(function(m){return m.loadAnimation&&m.loadAnimation(p)});break;case"camera":d=this.loadCamera(p);break;default:throw new Error("Unknown type: "+u)}this.cache.add(a,d)}return d}getDependencies(u){let p=this.cache.get(u);if(!p){const a=this,d=this.json[u+(u==="mesh"?"es":"s")]||[];p=Promise.all(d.map(function(m,h){return a.getDependency(u,h)})),this.cache.add(u,p)}return p}loadBuffer(u){const p=this.json.buffers[u],a=this.fileLoader;if(p.type&&p.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+p.type+" buffer type is not supported.");if(p.uri===void 0&&u===0)return Promise.resolve(this.extensions[q.KHR_BINARY_GLTF].body);const d=this.options;return new Promise(function(m,h){a.load(C.LoaderUtils.resolveURL(p.uri,d.path),m,void 0,function(){h(new Error('THREE.GLTFLoader: Failed to load buffer "'+p.uri+'".'))})})}loadBufferView(u){const p=this.json.bufferViews[u];return this.getDependency("buffer",p.buffer).then(function(a){const d=p.byteLength||0,m=p.byteOffset||0;return a.slice(m,m+d)})}loadAccessor(u){const p=this,a=this.json,d=this.json.accessors[u];if(d.bufferView===void 0&&d.sparse===void 0)return Promise.resolve(null);const m=[];return d.bufferView!==void 0?m.push(this.getDependency("bufferView",d.bufferView)):m.push(null),d.sparse!==void 0&&(m.push(this.getDependency("bufferView",d.sparse.indices.bufferView)),m.push(this.getDependency("bufferView",d.sparse.values.bufferView))),Promise.all(m).then(function(h){const b=h[0],f=Yi[d.type],x=vn[d.componentType],E=x.BYTES_PER_ELEMENT,g=E*f,M=d.byteOffset||0,N=d.bufferView!==void 0?a.bufferViews[d.bufferView].byteStride:void 0,A=d.normalized===!0;let F,I;if(N&&N!==g){const O=Math.floor(M/N),Y="InterleavedBuffer:"+d.bufferView+":"+d.componentType+":"+O+":"+d.count;let D=p.cache.get(Y);D||(F=new x(b,O*N,d.count*N/E),D=new C.InterleavedBuffer(F,N/E),p.cache.add(Y,D)),I=new C.InterleavedBufferAttribute(D,f,M%N/E,A)}else b===null?F=new x(d.count*f):F=new x(b,M,d.count*f),I=new C.BufferAttribute(F,f,A);if(d.sparse!==void 0){const O=Yi.SCALAR,Y=vn[d.sparse.indices.componentType],D=d.sparse.indices.byteOffset||0,re=d.sparse.values.byteOffset||0,de=new Y(h[1],D,d.sparse.count*O),ne=new x(h[2],re,d.sparse.count*f);b!==null&&(I=new C.BufferAttribute(I.array.slice(),I.itemSize,I.normalized));for(let X=0,G=de.length;X<G;X++){const ee=de[X];if(I.setX(ee,ne[X*f]),f>=2&&I.setY(ee,ne[X*f+1]),f>=3&&I.setZ(ee,ne[X*f+2]),f>=4&&I.setW(ee,ne[X*f+3]),f>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return I})}loadTexture(u){const p=this.json,a=this.options,m=p.textures[u].source,h=p.images[m];let b=this.textureLoader;if(h.uri){const f=a.manager.getHandler(h.uri);f!==null&&(b=f)}return this.loadTextureImage(u,m,b)}loadTextureImage(u,p,a){const d=this,m=this.json,h=m.textures[u],b=m.images[p],f=(b.uri||b.bufferView)+":"+h.sampler;if(this.textureCache[f])return this.textureCache[f];const x=this.loadImageSource(p,a).then(function(E){E.flipY=!1,h.name&&(E.name=h.name);const M=(m.samplers||{})[h.sampler]||{};return E.magFilter=qi[M.magFilter]||C.LinearFilter,E.minFilter=qi[M.minFilter]||C.LinearMipmapLinearFilter,E.wrapS=Hi[M.wrapS]||C.RepeatWrapping,E.wrapT=Hi[M.wrapT]||C.RepeatWrapping,d.associations.set(E,{textures:u}),E}).catch(function(){return null});return this.textureCache[f]=x,x}loadImageSource(u,p){const a=this,d=this.json,m=this.options;if(this.sourceCache[u]!==void 0)return this.sourceCache[u].then(g=>g.clone());const h=d.images[u],b=self.URL||self.webkitURL;let f=h.uri||"",x=!1;if(h.bufferView!==void 0)f=a.getDependency("bufferView",h.bufferView).then(function(g){x=!0;const M=new Blob([g],{type:h.mimeType});return f=b.createObjectURL(M),f});else if(h.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+u+" is missing URI and bufferView");const E=Promise.resolve(f).then(function(g){return new Promise(function(M,N){let A=M;p.isImageBitmapLoader===!0&&(A=function(F){const I=new C.Texture(F);I.needsUpdate=!0,M(I)}),p.load(C.LoaderUtils.resolveURL(g,m.path),A,void 0,N)})}).then(function(g){return x===!0&&b.revokeObjectURL(f),g.userData.mimeType=h.mimeType||vo(h.uri),g}).catch(function(g){throw console.error("THREE.GLTFLoader: Couldn't load texture",f),g});return this.sourceCache[u]=E,E}assignTexture(u,p,a,d){const m=this;return this.getDependency("texture",a.index).then(function(h){if(a.texCoord!==void 0&&a.texCoord!=0&&!(p==="aoMap"&&a.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+a.texCoord+" for texture "+p+" not yet supported."),m.extensions[q.KHR_TEXTURE_TRANSFORM]){const b=a.extensions!==void 0?a.extensions[q.KHR_TEXTURE_TRANSFORM]:void 0;if(b){const f=m.associations.get(h);h=m.extensions[q.KHR_TEXTURE_TRANSFORM].extendTexture(h,b),m.associations.set(h,f)}}return d!==void 0&&(h.encoding=d),u[p]=h,h})}assignFinalMaterial(u){const p=u.geometry;let a=u.material;const d=p.attributes.tangent===void 0,m=p.attributes.color!==void 0,h=p.attributes.normal===void 0;if(u.isPoints){const b="PointsMaterial:"+a.uuid;let f=this.cache.get(b);f||(f=new C.PointsMaterial,C.Material.prototype.copy.call(f,a),f.color.copy(a.color),f.map=a.map,f.sizeAttenuation=!1,this.cache.add(b,f)),a=f}else if(u.isLine){const b="LineBasicMaterial:"+a.uuid;let f=this.cache.get(b);f||(f=new C.LineBasicMaterial,C.Material.prototype.copy.call(f,a),f.color.copy(a.color),this.cache.add(b,f)),a=f}if(d||m||h){let b="ClonedMaterial:"+a.uuid+":";a.isGLTFSpecularGlossinessMaterial&&(b+="specular-glossiness:"),d&&(b+="derivative-tangents:"),m&&(b+="vertex-colors:"),h&&(b+="flat-shading:");let f=this.cache.get(b);f||(f=a.clone(),m&&(f.vertexColors=!0),h&&(f.flatShading=!0),d&&(f.normalScale&&(f.normalScale.y*=-1),f.clearcoatNormalScale&&(f.clearcoatNormalScale.y*=-1)),this.cache.add(b,f),this.associations.set(f,this.associations.get(a))),a=f}a.aoMap&&p.attributes.uv2===void 0&&p.attributes.uv!==void 0&&p.setAttribute("uv2",p.attributes.uv),u.material=a}getMaterialType(){return C.MeshStandardMaterial}loadMaterial(u){const p=this,a=this.json,d=this.extensions,m=a.materials[u];let h;const b={},f=m.extensions||{},x=[];if(f[q.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const g=d[q.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];h=g.getMaterialType(),x.push(g.extendParams(b,m,p))}else if(f[q.KHR_MATERIALS_UNLIT]){const g=d[q.KHR_MATERIALS_UNLIT];h=g.getMaterialType(),x.push(g.extendParams(b,m,p))}else{const g=m.pbrMetallicRoughness||{};if(b.color=new C.Color(1,1,1),b.opacity=1,Array.isArray(g.baseColorFactor)){const M=g.baseColorFactor;b.color.fromArray(M),b.opacity=M[3]}g.baseColorTexture!==void 0&&x.push(p.assignTexture(b,"map",g.baseColorTexture,C.sRGBEncoding)),b.metalness=g.metallicFactor!==void 0?g.metallicFactor:1,b.roughness=g.roughnessFactor!==void 0?g.roughnessFactor:1,g.metallicRoughnessTexture!==void 0&&(x.push(p.assignTexture(b,"metalnessMap",g.metallicRoughnessTexture)),x.push(p.assignTexture(b,"roughnessMap",g.metallicRoughnessTexture))),h=this._invokeOne(function(M){return M.getMaterialType&&M.getMaterialType(u)}),x.push(Promise.all(this._invokeAll(function(M){return M.extendMaterialParams&&M.extendMaterialParams(u,b)})))}m.doubleSided===!0&&(b.side=C.DoubleSide);const E=m.alphaMode||ks.OPAQUE;if(E===ks.BLEND?(b.transparent=!0,b.depthWrite=!1):(b.transparent=!1,E===ks.MASK&&(b.alphaTest=m.alphaCutoff!==void 0?m.alphaCutoff:.5)),m.normalTexture!==void 0&&h!==C.MeshBasicMaterial&&(x.push(p.assignTexture(b,"normalMap",m.normalTexture)),b.normalScale=new C.Vector2(1,1),m.normalTexture.scale!==void 0)){const g=m.normalTexture.scale;b.normalScale.set(g,g)}return m.occlusionTexture!==void 0&&h!==C.MeshBasicMaterial&&(x.push(p.assignTexture(b,"aoMap",m.occlusionTexture)),m.occlusionTexture.strength!==void 0&&(b.aoMapIntensity=m.occlusionTexture.strength)),m.emissiveFactor!==void 0&&h!==C.MeshBasicMaterial&&(b.emissive=new C.Color().fromArray(m.emissiveFactor)),m.emissiveTexture!==void 0&&h!==C.MeshBasicMaterial&&x.push(p.assignTexture(b,"emissiveMap",m.emissiveTexture,C.sRGBEncoding)),Promise.all(x).then(function(){let g;return h===Ps?g=d[q.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(b):g=new h(b),m.name&&(g.name=m.name),St(g,m),p.associations.set(g,{materials:u}),m.extensions&&fn(d,g,m),g})}createUniqueName(u){const p=C.PropertyBinding.sanitizeNodeName(u||"");let a=p;for(let d=1;this.nodeNamesUsed[a];++d)a=p+"_"+d;return this.nodeNamesUsed[a]=!0,a}loadGeometries(u){const p=this,a=this.extensions,d=this.primitiveCache;function m(b){return a[q.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(b,p).then(function(f){return Zi(f,b,p)})}const h=[];for(let b=0,f=u.length;b<f;b++){const x=u[b],E=mo(x),g=d[E];if(g)h.push(g.promise);else{let M;x.extensions&&x.extensions[q.KHR_DRACO_MESH_COMPRESSION]?M=m(x):M=Zi(new C.BufferGeometry,x,p),d[E]={primitive:x,promise:M},h.push(M)}}return Promise.all(h)}loadMesh(u){const p=this,a=this.json,d=this.extensions,m=a.meshes[u],h=m.primitives,b=[];for(let f=0,x=h.length;f<x;f++){const E=h[f].material===void 0?po(this.cache):this.getDependency("material",h[f].material);b.push(E)}return b.push(p.loadGeometries(h)),Promise.all(b).then(function(f){const x=f.slice(0,f.length-1),E=f[f.length-1],g=[];for(let N=0,A=E.length;N<A;N++){const F=E[N],I=h[N];let O;const Y=x[N];if(I.mode===Je.TRIANGLES||I.mode===Je.TRIANGLE_STRIP||I.mode===Je.TRIANGLE_FAN||I.mode===void 0)O=m.isSkinnedMesh===!0?new C.SkinnedMesh(F,Y):new C.Mesh(F,Y),O.isSkinnedMesh===!0&&!O.geometry.attributes.skinWeight.normalized&&O.normalizeSkinWeights(),I.mode===Je.TRIANGLE_STRIP?O.geometry=Qi(O.geometry,C.TriangleStripDrawMode):I.mode===Je.TRIANGLE_FAN&&(O.geometry=Qi(O.geometry,C.TriangleFanDrawMode));else if(I.mode===Je.LINES)O=new C.LineSegments(F,Y);else if(I.mode===Je.LINE_STRIP)O=new C.Line(F,Y);else if(I.mode===Je.LINE_LOOP)O=new C.LineLoop(F,Y);else if(I.mode===Je.POINTS)O=new C.Points(F,Y);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+I.mode);Object.keys(O.geometry.morphAttributes).length>0&&ho(O,m),O.name=p.createUniqueName(m.name||"mesh_"+u),St(O,m),I.extensions&&fn(d,O,I),p.assignFinalMaterial(O),g.push(O)}for(let N=0,A=g.length;N<A;N++)p.associations.set(g[N],{meshes:u,primitives:N});if(g.length===1)return g[0];const M=new C.Group;p.associations.set(M,{meshes:u});for(let N=0,A=g.length;N<A;N++)M.add(g[N]);return M})}loadCamera(u){let p;const a=this.json.cameras[u],d=a[a.type];if(!d){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return a.type==="perspective"?p=new C.PerspectiveCamera(C.MathUtils.radToDeg(d.yfov),d.aspectRatio||1,d.znear||1,d.zfar||2e6):a.type==="orthographic"&&(p=new C.OrthographicCamera(-d.xmag,d.xmag,d.ymag,-d.ymag,d.znear,d.zfar)),a.name&&(p.name=this.createUniqueName(a.name)),St(p,a),Promise.resolve(p)}loadSkin(u){const p=this.json.skins[u],a={joints:p.joints};return p.inverseBindMatrices===void 0?Promise.resolve(a):this.getDependency("accessor",p.inverseBindMatrices).then(function(d){return a.inverseBindMatrices=d,a})}loadAnimation(u){const a=this.json.animations[u],d=[],m=[],h=[],b=[],f=[];for(let x=0,E=a.channels.length;x<E;x++){const g=a.channels[x],M=a.samplers[g.sampler],N=g.target,A=N.node,F=a.parameters!==void 0?a.parameters[M.input]:M.input,I=a.parameters!==void 0?a.parameters[M.output]:M.output;d.push(this.getDependency("node",A)),m.push(this.getDependency("accessor",F)),h.push(this.getDependency("accessor",I)),b.push(M),f.push(N)}return Promise.all([Promise.all(d),Promise.all(m),Promise.all(h),Promise.all(b),Promise.all(f)]).then(function(x){const E=x[0],g=x[1],M=x[2],N=x[3],A=x[4],F=[];for(let O=0,Y=E.length;O<Y;O++){const D=E[O],re=g[O],de=M[O],ne=N[O],X=A[O];if(D===void 0)continue;D.updateMatrix();let G;switch(pt[X.path]){case pt.weights:G=C.NumberKeyframeTrack;break;case pt.rotation:G=C.QuaternionKeyframeTrack;break;case pt.position:case pt.scale:default:G=C.VectorKeyframeTrack;break}const ee=D.name?D.name:D.uuid,se=ne.interpolation!==void 0?co[ne.interpolation]:C.InterpolateLinear,_e=[];pt[X.path]===pt.weights?D.traverse(function(he){he.morphTargetInfluences&&_e.push(he.name?he.name:he.uuid)}):_e.push(ee);let Ce=de.array;if(de.normalized){const he=Ms(Ce.constructor),ue=new Float32Array(Ce.length);for(let fe=0,W=Ce.length;fe<W;fe++)ue[fe]=Ce[fe]*he;Ce=ue}for(let he=0,ue=_e.length;he<ue;he++){const fe=new G(_e[he]+"."+pt[X.path],re.array,Ce,se);ne.interpolation==="CUBICSPLINE"&&(fe.createInterpolant=function(B){const ut=this instanceof C.QuaternionKeyframeTrack?lo:$i;return new ut(this.times,this.values,this.getValueSize()/3,B)},fe.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),F.push(fe)}}const I=a.name?a.name:"animation_"+u;return new C.AnimationClip(I,void 0,F)})}createNodeMesh(u){const p=this.json,a=this,d=p.nodes[u];return d.mesh===void 0?null:a.getDependency("mesh",d.mesh).then(function(m){const h=a._getNodeRef(a.meshCache,d.mesh,m);return d.weights!==void 0&&h.traverse(function(b){if(!!b.isMesh)for(let f=0,x=d.weights.length;f<x;f++)b.morphTargetInfluences[f]=d.weights[f]}),h})}loadNode(u){const p=this.json,a=this.extensions,d=this,m=p.nodes[u],h=m.name?d.createUniqueName(m.name):"";return function(){const b=[],f=d._invokeOne(function(x){return x.createNodeMesh&&x.createNodeMesh(u)});return f&&b.push(f),m.camera!==void 0&&b.push(d.getDependency("camera",m.camera).then(function(x){return d._getNodeRef(d.cameraCache,m.camera,x)})),d._invokeAll(function(x){return x.createNodeAttachment&&x.createNodeAttachment(u)}).forEach(function(x){b.push(x)}),Promise.all(b)}().then(function(b){let f;if(m.isBone===!0?f=new C.Bone:b.length>1?f=new C.Group:b.length===1?f=b[0]:f=new C.Object3D,f!==b[0])for(let x=0,E=b.length;x<E;x++)f.add(b[x]);if(m.name&&(f.userData.name=m.name,f.name=h),St(f,m),m.extensions&&fn(a,f,m),m.matrix!==void 0){const x=new C.Matrix4;x.fromArray(m.matrix),f.applyMatrix4(x)}else m.translation!==void 0&&f.position.fromArray(m.translation),m.rotation!==void 0&&f.quaternion.fromArray(m.rotation),m.scale!==void 0&&f.scale.fromArray(m.scale);return d.associations.has(f)||d.associations.set(f,{}),d.associations.get(f).nodes=u,f})}loadScene(u){const p=this.json,a=this.extensions,d=this.json.scenes[u],m=this,h=new C.Group;d.name&&(h.name=m.createUniqueName(d.name)),St(h,d),d.extensions&&fn(a,h,d);const b=d.nodes||[],f=[];for(let x=0,E=b.length;x<E;x++)f.push(Wi(b[x],h,p,m));return Promise.all(f).then(function(){const x=E=>{const g=new Map;for(const[M,N]of m.associations)(M instanceof C.Material||M instanceof C.Texture)&&g.set(M,N);return E.traverse(M=>{const N=m.associations.get(M);N!=null&&g.set(M,N)}),g};return m.associations=x(h),h})}}function Wi(L,u,p,a){const d=p.nodes[L];return a.getDependency("node",L).then(function(m){if(d.skin===void 0)return m;let h;return a.getDependency("skin",d.skin).then(function(b){h=b;const f=[];for(let x=0,E=h.joints.length;x<E;x++)f.push(a.getDependency("node",h.joints[x]));return Promise.all(f)}).then(function(b){return m.traverse(function(f){if(!f.isMesh)return;const x=[],E=[];for(let g=0,M=b.length;g<M;g++){const N=b[g];if(N){x.push(N);const A=new C.Matrix4;h.inverseBindMatrices!==void 0&&A.fromArray(h.inverseBindMatrices.array,g*16),E.push(A)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',h.joints[g])}f.bind(new C.Skeleton(x,E),f.matrixWorld)}),m})}).then(function(m){u.add(m);const h=[];if(d.children){const b=d.children;for(let f=0,x=b.length;f<x;f++){const E=b[f];h.push(Wi(E,m,p,a))}}return Promise.all(h)})}function bo(L,u,p){const a=u.attributes,d=new C.Box3;if(a.POSITION!==void 0){const b=p.json.accessors[a.POSITION],f=b.min,x=b.max;if(f!==void 0&&x!==void 0){if(d.set(new C.Vector3(f[0],f[1],f[2]),new C.Vector3(x[0],x[1],x[2])),b.normalized){const E=Ms(vn[b.componentType]);d.min.multiplyScalar(E),d.max.multiplyScalar(E)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const m=u.targets;if(m!==void 0){const b=new C.Vector3,f=new C.Vector3;for(let x=0,E=m.length;x<E;x++){const g=m[x];if(g.POSITION!==void 0){const M=p.json.accessors[g.POSITION],N=M.min,A=M.max;if(N!==void 0&&A!==void 0){if(f.setX(Math.max(Math.abs(N[0]),Math.abs(A[0]))),f.setY(Math.max(Math.abs(N[1]),Math.abs(A[1]))),f.setZ(Math.max(Math.abs(N[2]),Math.abs(A[2]))),M.normalized){const F=Ms(vn[M.componentType]);f.multiplyScalar(F)}b.max(f)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}d.expandByVector(b)}L.boundingBox=d;const h=new C.Sphere;d.getCenter(h.center),h.radius=d.min.distanceTo(d.max)/2,L.boundingSphere=h}function Zi(L,u,p){const a=u.attributes,d=[];function m(h,b){return p.getDependency("accessor",h).then(function(f){L.setAttribute(b,f)})}for(const h in a){const b=Es[h]||h.toLowerCase();b in L.attributes||d.push(m(a[h],b))}if(u.indices!==void 0&&!L.index){const h=p.getDependency("accessor",u.indices).then(function(b){L.setIndex(b)});d.push(h)}return St(L,u),bo(L,u,p),Promise.all(d).then(function(){return u.targets!==void 0?uo(L,u.targets,p):L})}function Qi(L,u){let p=L.getIndex();if(p===null){const h=[],b=L.getAttribute("position");if(b!==void 0){for(let f=0;f<b.count;f++)h.push(f);L.setIndex(h),p=L.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),L}const a=p.count-2,d=[];if(u===C.TriangleFanDrawMode)for(let h=1;h<=a;h++)d.push(p.getX(0)),d.push(p.getX(h)),d.push(p.getX(h+1));else for(let h=0;h<a;h++)h%2===0?(d.push(p.getX(h)),d.push(p.getX(h+1)),d.push(p.getX(h+2))):(d.push(p.getX(h+2)),d.push(p.getX(h+1)),d.push(p.getX(h)));d.length/3!==a&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const m=L.clone();return m.setIndex(d),m}var Ji=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _o(L){return L&&L.__esModule&&Object.prototype.hasOwnProperty.call(L,"default")?L.default:L}const Ls=new WeakMap;class go extends C.Loader{constructor(u){super(u),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(u){return this.decoderPath=u,this}setDecoderConfig(u){return this.decoderConfig=u,this}setWorkerLimit(u){return this.workerLimit=u,this}load(u,p,a,d){const m=new C.FileLoader(this.manager);m.setPath(this.path),m.setResponseType("arraybuffer"),m.setRequestHeader(this.requestHeader),m.setWithCredentials(this.withCredentials),m.load(u,h=>{const b={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(h,b).then(p).catch(d)},a,d)}decodeDracoFile(u,p,a,d){const m={attributeIDs:a||this.defaultAttributeIDs,attributeTypes:d||this.defaultAttributeTypes,useUniqueIDs:!!a};this.decodeGeometry(u,m).then(p)}decodeGeometry(u,p){for(const f in p.attributeTypes){const x=p.attributeTypes[f];x.BYTES_PER_ELEMENT!==void 0&&(p.attributeTypes[f]=x.name)}const a=JSON.stringify(p);if(Ls.has(u)){const f=Ls.get(u);if(f.key===a)return f.promise;if(u.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let d;const m=this.workerNextTaskID++,h=u.byteLength,b=this._getWorker(m,h).then(f=>(d=f,new Promise((x,E)=>{d._callbacks[m]={resolve:x,reject:E},d.postMessage({type:"decode",id:m,taskConfig:p,buffer:u},[u])}))).then(f=>this._createGeometry(f.geometry));return b.catch(()=>!0).then(()=>{d&&m&&this._releaseTask(d,m)}),Ls.set(u,{key:a,promise:b}),b}_createGeometry(u){const p=new C.BufferGeometry;u.index&&p.setIndex(new C.BufferAttribute(u.index.array,1));for(let a=0;a<u.attributes.length;a++){const d=u.attributes[a],m=d.name,h=d.array,b=d.itemSize;p.setAttribute(m,new C.BufferAttribute(h,b))}return p}_loadLibrary(u,p){const a=new C.FileLoader(this.manager);return a.setPath(this.decoderPath),a.setResponseType(p),a.setWithCredentials(this.withCredentials),new Promise((d,m)=>{a.load(u,d,void 0,m)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const u=typeof WebAssembly!="object"||this.decoderConfig.type==="js",p=[];return u?p.push(this._loadLibrary("draco_decoder.js","text")):(p.push(this._loadLibrary("draco_wasm_wrapper.js","text")),p.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(p).then(a=>{const d=a[0];u||(this.decoderConfig.wasmBinary=a[1]);const m=wo.toString(),h=["/* draco decoder */",d,"","/* worker */",m.substring(m.indexOf("{")+1,m.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([h]))}),this.decoderPending}_getWorker(u,p){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const d=new Worker(this.workerSourceURL);d._callbacks={},d._taskCosts={},d._taskLoad=0,d.postMessage({type:"init",decoderConfig:this.decoderConfig}),d.onmessage=function(m){const h=m.data;switch(h.type){case"decode":d._callbacks[h.id].resolve(h);break;case"error":d._callbacks[h.id].reject(h);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+h.type+'"')}},this.workerPool.push(d)}else this.workerPool.sort(function(d,m){return d._taskLoad>m._taskLoad?-1:1});const a=this.workerPool[this.workerPool.length-1];return a._taskCosts[u]=p,a._taskLoad+=p,a})}_releaseTask(u,p){u._taskLoad-=u._taskCosts[p],delete u._callbacks[p],delete u._taskCosts[p]}debug(){console.log("Task load: ",this.workerPool.map(u=>u._taskLoad))}dispose(){for(let u=0;u<this.workerPool.length;++u)this.workerPool[u].terminate();return this.workerPool.length=0,this}}function wo(){let L,u;onmessage=function(h){const b=h.data;switch(b.type){case"init":L=b.decoderConfig,u=new Promise(function(E){L.onModuleLoaded=function(g){E({draco:g})},DracoDecoderModule(L)});break;case"decode":const f=b.buffer,x=b.taskConfig;u.then(E=>{const g=E.draco,M=new g.Decoder,N=new g.DecoderBuffer;N.Init(new Int8Array(f),f.byteLength);try{const A=p(g,M,N,x),F=A.attributes.map(I=>I.array.buffer);A.index&&F.push(A.index.array.buffer),self.postMessage({type:"decode",id:b.id,geometry:A},F)}catch(A){console.error(A),self.postMessage({type:"error",id:b.id,error:A.message})}finally{g.destroy(N),g.destroy(M)}});break}};function p(h,b,f,x){const E=x.attributeIDs,g=x.attributeTypes;let M,N;const A=b.GetEncodedGeometryType(f);if(A===h.TRIANGULAR_MESH)M=new h.Mesh,N=b.DecodeBufferToMesh(f,M);else if(A===h.POINT_CLOUD)M=new h.PointCloud,N=b.DecodeBufferToPointCloud(f,M);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!N.ok()||M.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+N.error_msg());const F={index:null,attributes:[]};for(const I in E){const O=self[g[I]];let Y,D;if(x.useUniqueIDs)D=E[I],Y=b.GetAttributeByUniqueId(M,D);else{if(D=b.GetAttributeId(M,h[E[I]]),D===-1)continue;Y=b.GetAttribute(M,D)}F.attributes.push(d(h,b,M,I,O,Y))}return A===h.TRIANGULAR_MESH&&(F.index=a(h,b,M)),h.destroy(M),F}function a(h,b,f){const E=f.num_faces()*3,g=E*4,M=h._malloc(g);b.GetTrianglesUInt32Array(f,g,M);const N=new Uint32Array(h.HEAPF32.buffer,M,E).slice();return h._free(M),{array:N,itemSize:1}}function d(h,b,f,x,E,g){const M=g.num_components(),A=f.num_points()*M,F=A*E.BYTES_PER_ELEMENT,I=m(h,E),O=h._malloc(F);b.GetAttributeDataArrayForAllPoints(f,g,I,F,O);const Y=new E(h.HEAPF32.buffer,O,A).slice();return h._free(O),{name:x,array:Y,itemSize:M}}function m(h,b){switch(b){case Float32Array:return h.DT_FLOAT32;case Int8Array:return h.DT_INT8;case Int16Array:return h.DT_INT16;case Int32Array:return h.DT_INT32;case Uint8Array:return h.DT_UINT8;case Uint16Array:return h.DT_UINT16;case Uint32Array:return h.DT_UINT32}}}const xo=Te.defineComponent({__name:"OrbitControls",setup(L){let u;const p=Te.inject("camera"),a=Te.inject("renderer");return Te.watch([p,a],()=>{if((p==null?void 0:p.value)&&(a==null?void 0:a.value)){u=new Br(p.value,Te.unref(a).domElement),u.enableDamping=!0;const{onLoop:d}=Cs.useRenderLoop();d(()=>{u&&u.update()})}},{deep:!0}),()=>{}}});var Ss={exports:{}};/*! Tweakpane 3.1.0 (c) 2016 cocopon, licensed under the MIT license. */(function(L,u){(function(p,a){a(u)})(Ji,function(p){class a{constructor(e){const[t,i]=e.split("-"),c=t.split(".");this.major=parseInt(c[0],10),this.minor=parseInt(c[1],10),this.patch=parseInt(c[2],10),this.prerelease=i!=null?i:null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}}class d{constructor(e){this.controller_=e}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(e){this.controller_.viewProps.set("hidden",e)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class m{constructor(e){this.target=e}}class h extends m{constructor(e,t,i,c){super(e),this.value=t,this.presetKey=i,this.last=c!=null?c:!0}}class b extends m{constructor(e,t,i){super(e),this.value=t,this.presetKey=i}}class f extends m{constructor(e,t){super(e),this.expanded=t}}class x extends m{constructor(e,t){super(e),this.index=t}}function E(n){return n}function g(n){return n==null}function M(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}const N={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class A{constructor(e){var t;this.message=(t=N[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}static alreadyDisposed(){return new A({type:"alreadydisposed"})}static notBindable(){return new A({type:"notbindable"})}static propertyNotFound(e){return new A({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new A({type:"shouldneverhappen"})}}class F{constructor(e,t,i){this.obj_=e,this.key_=t,this.presetKey_=i!=null?i:t}static isBindable(e){return!(e===null||typeof e!="object")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(e){this.obj_[this.key_]=e}writeProperty(e,t){const i=this.read();if(!F.isBindable(i))throw A.notBindable();if(!(e in i))throw A.propertyNotFound(e);i[e]=t}}class I extends d{get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get title(){var e;return(e=this.controller_.valueController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller_.valueController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller_.valueController.emitter.on(e,()=>{i(new m(this))}),this}}class O{constructor(){this.observers_={}}on(e,t){let i=this.observers_[e];return i||(i=this.observers_[e]=[]),i.push({handler:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(c=>c.handler!==t)),this}emit(e,t){const i=this.observers_[e];!i||i.forEach(c=>{c.handler(t)})}}const Y="tp";function D(n){return(t,i)=>[Y,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}function re(n,e){return t=>e(n(t))}function de(n){return n.rawValue}function ne(n,e){n.emitter.on("change",re(de,e)),e(n.rawValue)}function X(n,e,t){ne(n.value(e),t)}function G(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function ee(n,e){return t=>{G(n,e,t)}}function se(n,e){ne(n,t=>{e.textContent=t!=null?t:""})}const _e=D("btn");class Ce{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(_e()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(_e("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const c=e.createElement("div");c.classList.add(_e("t")),se(t.props.value("title"),c),this.buttonElement.appendChild(c)}}class he{constructor(e,t){this.emitter=new O,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new Ce(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class ue{constructor(e,t){var i;this.constraint_=t==null?void 0:t.constraint,this.equals_=(i=t==null?void 0:t.equals)!==null&&i!==void 0?i:(c,_)=>c===_,this.emitter=new O,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t!=null?t:{forceEmit:!1,last:!0},c=this.constraint_?this.constraint_.constrain(e):e;!!this.equals_(this.rawValue_,c)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=c,this.emitter.emit("change",{options:i,rawValue:c,sender:this}))}}class fe{constructor(e){this.emitter=new O,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t!=null?t:{forceEmit:!1,last:!0};this.value_===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,rawValue:this.value_,sender:this}))}}function W(n,e){const t=e==null?void 0:e.constraint,i=e==null?void 0:e.equals;return!t&&!i?new fe(n):new ue(n,e)}class B{constructor(e){this.emitter=new O,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,c)=>Object.assign(i,{[c]:W(e[c])}),{})}static fromObject(e){const t=this.createCore(e);return new B(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}function ut(n,e){const i=Object.keys(e).reduce((c,_)=>{if(c===void 0)return;const y=e[_],S=y(n[_]);return S.succeeded?Object.assign(Object.assign({},c),{[_]:S.value}):void 0},{});return i}function Yt(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const c=e(i);if(!(!c.succeeded||c.value===void 0))return[...t,c.value]},[])}function Xt(n){return n===null?!1:typeof n=="object"}function ge(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function At(n){return{custom:e=>ge(e)(n),boolean:ge(e=>typeof e=="boolean"?e:void 0)(n),number:ge(e=>typeof e=="number"?e:void 0)(n),string:ge(e=>typeof e=="string"?e:void 0)(n),function:ge(e=>typeof e=="function"?e:void 0)(n),constant:e=>ge(t=>t===e?e:void 0)(n),raw:ge(e=>e)(n),object:e=>ge(t=>{if(!!Xt(t))return ut(t,e)})(n),array:e=>ge(t=>{if(!!Array.isArray(t))return Yt(t,e)})(n)}}const $={optional:At(!0),required:At(!1)};function oe(n,e){const t=$.required.object(e)(n);return t.succeeded?t.value:void 0}function bn(n){return n&&n.parentElement&&n.parentElement.removeChild(n),null}function Wt(){return["veryfirst","first","last","verylast"]}const Tt=D(""),Vt={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Pe{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{Wt().forEach(i=>{t.classList.remove(Tt(void 0,Vt[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(Tt(void 0,Vt[i]))})}),this.viewProps.handleDispose(()=>{bn(t)})}get parent(){return this.parent_}}const Ee="http://www.w3.org/2000/svg";function et(n){n.offsetHeight}function tt(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function dt(n){return n.ontouchstart!==void 0}function ht(){return new Function("return this")()}function _n(){return ht().document}function gn(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d"):null}const Nt={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function qe(n,e){const t=n.createElementNS(Ee,"svg");return t.innerHTML=Nt[e],t}function nt(n,e,t){n.insertBefore(e,n.children[t])}function He(n){n.parentElement&&n.parentElement.removeChild(n)}function Zt(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function Qt(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function Oe(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}const Ye=D("lbl");function wn(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(c=>n.createTextNode(c)).forEach((c,_)=>{_>0&&t.appendChild(n.createElement("br")),t.appendChild(c)}),t}class Ot{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ye()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Ye("l")),X(t.props,"label",_=>{g(_)?this.element.classList.add(Ye(void 0,"nol")):(this.element.classList.remove(Ye(void 0,"nol")),Qt(i),i.appendChild(wn(e,_)))}),this.element.appendChild(i),this.labelElement=i;const c=e.createElement("div");c.classList.add(Ye("v")),this.element.appendChild(c),this.valueElement=c}}class Ie extends Pe{constructor(e,t){const i=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{view:new Ot(e,{props:t.props,viewProps:i}),viewProps:i})),this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const mt={id:"button",type:"blade",accept(n){const e=$,t=oe(n,{title:e.required.string,view:e.required.constant("button"),label:e.optional.string});return t?{params:t}:null},controller(n){return new Ie(n.document,{blade:n.blade,props:B.fromObject({label:n.params.label}),valueController:new he(n.document,{props:B.fromObject({title:n.params.title}),viewProps:n.viewProps})})},api(n){return!(n.controller instanceof Ie)||!(n.controller.valueController instanceof he)?null:new I(n.controller)}};class ke extends Pe{constructor(e){super(e),this.value=e.value}}function Fe(){return new B({positions:W([],{equals:M})})}class je extends B{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=B.createCore(t);return new je(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!g(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};X(this,"expanded",i),X(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function P(n,e){let t=0;return tt(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),et(e),t=e.clientHeight,n.set("temporaryExpanded",null),et(e)}),t}function T(n,e){e.style.height=n.styleHeight}function U(n,e){n.value("expanded").emitter.on("beforechange",()=>{n.set("completed",!1),g(n.get("expandedHeight"))&&n.set("expandedHeight",P(n,e)),n.set("shouldFixHeight",!0),et(e)}),n.emitter.on("change",()=>{T(n,e)}),T(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}class H extends d{constructor(e,t){super(e),this.rackApi_=t}}function ae(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function Me(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function vt(n,e){const t=e!=null?e:{};return n.addBlade(Object.assign(Object.assign({},t),{view:"separator"}))}function Jt(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}class we{constructor(e){this.emitter=new O,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw A.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const c=this.extract_(e);c&&(c.emitter.on("add",this.onSubListAdd_),c.emitter.on("remove",this.onSubListRemove_),c.allItems().forEach(_=>{this.cache_.add(_)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}class xe extends d{constructor(e){super(e),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new O,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,c=>{i(c.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(e){const t=e.sender.target.read();this.emitter_.emit("change",{event:new h(this,t,this.controller_.binding.target.presetKey,e.options.last)})}}class Le extends Ie{constructor(e,t){super(e,t),this.binding=t.binding}}class st extends d{constructor(e){super(e),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new O,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,c=>{i(c.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(e){const t=e.sender.target.read();this.emitter_.emit("update",{event:new b(this,t,this.controller_.binding.target.presetKey)})}}class Xe extends Ie{constructor(e,t){super(e,t),this.binding=t.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function It(n){return n instanceof Rt?n.apiSet_:n instanceof H?n.rackApi_.apiSet_:null}function Dt(n,e){const t=n.find(i=>i.controller_===e);if(!t)throw A.shouldNeverHappen();return t}function en(n,e,t){if(!F.isBindable(n))throw A.notBindable();return new F(n,e,t)}class Rt extends d{constructor(e,t){super(e),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new O,this.apiSet_=new we(It),this.pool_=t;const i=this.controller_.rack;i.emitter.on("add",this.onRackAdd_),i.emitter.on("remove",this.onRackRemove_),i.emitter.on("inputchange",this.onRackInputChange_),i.emitter.on("monitorupdate",this.onRackMonitorUpdate_),i.children.forEach(c=>{this.setUpApi_(c)})}get children(){return this.controller_.rack.children.map(e=>Dt(this.apiSet_,e))}addInput(e,t,i){const c=i!=null?i:{},_=this.controller_.view.element.ownerDocument,y=this.pool_.createInput(_,en(e,t,c.presetKey),c),S=new xe(y);return this.add(S,c.index)}addMonitor(e,t,i){const c=i!=null?i:{},_=this.controller_.view.element.ownerDocument,y=this.pool_.createMonitor(_,en(e,t),c),S=new st(y);return this.add(S,c.index)}addFolder(e){return Me(this,e)}addButton(e){return ae(this,e)}addSeparator(e){return vt(this,e)}addTab(e){return Jt(this,e)}add(e,t){this.controller_.rack.add(e.controller_,t);const i=this.apiSet_.find(c=>c.controller_===e.controller_);return i&&this.apiSet_.remove(i),this.apiSet_.add(e),e}remove(e){this.controller_.rack.remove(e.controller_)}addBlade(e){const t=this.controller_.view.element.ownerDocument,i=this.pool_.createBlade(t,e),c=this.pool_.createBladeApi(i);return this.add(c,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,c=>{i(c.event)}),this}setUpApi_(e){this.apiSet_.find(i=>i.controller_===e)||this.apiSet_.add(this.pool_.createBladeApi(e))}onRackAdd_(e){this.setUpApi_(e.bladeController)}onRackRemove_(e){if(e.isRoot){const t=Dt(this.apiSet_,e.bladeController);this.apiSet_.remove(t)}}onRackInputChange_(e){const t=e.bladeController;if(t instanceof Le){const i=Dt(this.apiSet_,t),c=t.binding;this.emitter_.emit("change",{event:new h(i,c.target.read(),c.target.presetKey,e.options.last)})}else if(t instanceof ke){const i=Dt(this.apiSet_,t);this.emitter_.emit("change",{event:new h(i,t.value.rawValue,void 0,e.options.last)})}}onRackMonitorUpdate_(e){if(!(e.bladeController instanceof Xe))throw A.shouldNeverHappen();const t=Dt(this.apiSet_,e.bladeController),i=e.bladeController.binding;this.emitter_.emit("update",{event:new b(t,i.target.read(),i.target.presetKey)})}}class xn extends H{constructor(e,t){super(e,new Rt(e.rackController,t)),this.emitter_=new O,this.controller_.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",{event:new f(this,i.sender.rawValue)})}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",{event:i})}),this.rackApi_.on("update",i=>{this.emitter_.emit("update",{event:i})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(e){this.controller_.foldable.set("expanded",e)}get title(){return this.controller_.props.get("title")}set title(e){this.controller_.props.set("title",e)}get children(){return this.rackApi_.children}addInput(e,t,i){return this.rackApi_.addInput(e,t,i)}addMonitor(e,t,i){return this.rackApi_.addMonitor(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,c=>{i(c.event)}),this}}class yn extends Pe{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}}class Ts{constructor(e,t){const i=D(t.viewName);this.element=e.createElement("div"),this.element.classList.add(i()),t.viewProps.bindClassModifiers(this.element)}}function Vs(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(i instanceof Le&&i.binding===e)return i}return null}function Ns(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(i instanceof Xe&&i.binding===e)return i}return null}function Os(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(i instanceof ke&&i.value===e)return i}return null}function Cn(n){return n instanceof Ft?n.rack:n instanceof yn?n.rackController.rack:null}function Is(n){const e=Cn(n);return e?e.bcSet_:null}class Ds{constructor(e){var t;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new O,this.blade_=e!=null?e:null,(t=this.blade_)===null||t===void 0||t.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new we(Is),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){e.parent&&e.parent.remove(e),e.parent_=this,this.bcSet_.add(e,t)}remove(e){e.parent_=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(t=>t instanceof e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,isRoot:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),i instanceof Le)i.binding.emitter.on("change",this.onChildInputChange_);else if(i instanceof Xe)i.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(i instanceof ke)i.value.emitter.on("change",this.onChildValueChange_);else{const c=Cn(i);if(c){const _=c.emitter;_.on("layout",this.onDescendantLayout_),_.on("inputchange",this.onDescendantInputChange_),_.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,isRoot:t,sender:this}),!t)return;const i=e.item;if(i instanceof Le)i.binding.emitter.off("change",this.onChildInputChange_);else if(i instanceof Xe)i.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(i instanceof ke)i.value.emitter.off("change",this.onChildValueChange_);else{const c=Cn(i);if(c){const _=c.emitter;_.off("layout",this.onDescendantLayout_),_.off("inputchange",this.onDescendantInputChange_),_.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const e=this.bcSet_.items.filter(c=>!c.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(c=>{const _=[];c===t&&(_.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&_.push("veryfirst")),c===i&&(_.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&_.push("verylast")),c.blade.set("positions",_)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildInputChange_(e){const t=Vs(this.find(Le),e.sender);if(!t)throw A.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onChildMonitorUpdate_(e){const t=Ns(this.find(Xe),e.sender);if(!t)throw A.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:t,sender:this})}onChildValueChange_(e){const t=Os(this.find(ke),e.sender);if(!t)throw A.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onDescendantLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(e){this.emitter.emit("inputchange",{bladeController:e.bladeController,options:e.options,sender:this})}onDescendantMonitorUpdate_(e){this.emitter.emit("monitorupdate",{bladeController:e.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Ft extends Pe{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new Ts(e,{viewName:"brk",viewProps:t.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const i=new Ds(t.root?void 0:t.blade);i.emitter.on("add",this.onRackAdd_),i.emitter.on("remove",this.onRackRemove_),this.rack=i,this.viewProps.handleDispose(()=>{for(let c=this.rack.children.length-1;c>=0;c--)this.rack.children[c].viewProps.set("disposed",!0)})}onRackAdd_(e){!e.isRoot||nt(this.view.element,e.bladeController.view.element,e.index)}onRackRemove_(e){!e.isRoot||He(e.bladeController.view.element)}}const Zn=D("cnt");class Rs{constructor(e,t){var i;this.className_=D((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),Zn()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),X(this.foldable_,"completed",ee(this.element,this.className_(void 0,"cpl")));const c=e.createElement("button");c.classList.add(this.className_("b")),X(t.props,"title",j=>{g(j)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(c),this.element.appendChild(c),this.buttonElement=c;const _=e.createElement("div");_.classList.add(this.className_("t")),se(t.props.value("title"),_),this.buttonElement.appendChild(_),this.titleElement=_;const y=e.createElement("div");y.classList.add(this.className_("m")),this.buttonElement.appendChild(y);const S=t.containerElement;S.classList.add(this.className_("c")),this.element.appendChild(S),this.containerElement=S}}class Pn extends yn{constructor(e,t){var i;const c=je.create((i=t.expanded)!==null&&i!==void 0?i:!0),_=new Ft(e,{blade:t.blade,root:t.root,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:_,view:new Rs(e,{containerElement:_.view.element,foldable:c,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=c,U(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Fs={id:"folder",type:"blade",accept(n){const e=$,t=oe(n,{title:e.required.string,view:e.required.constant("folder"),expanded:e.optional.boolean});return t?{params:t}:null},controller(n){return new Pn(n.document,{blade:n.blade,expanded:n.params.expanded,props:B.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof Pn?new xn(n.controller,n.pool):null}};class ft extends ke{constructor(e,t){const i=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{value:t.valueController.value,view:new Ot(e,{props:t.props,viewProps:i}),viewProps:i})),this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class En extends d{}const Qn=D("spr");class js{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Qn()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("hr");i.classList.add(Qn("r")),this.element.appendChild(i)}}class Jn extends Pe{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new js(e,{viewProps:t.viewProps})}))}}const es={id:"separator",type:"blade",accept(n){const t=oe(n,{view:$.required.constant("separator")});return t?{params:t}:null},controller(n){return new Jn(n.document,{blade:n.blade,viewProps:n.viewProps})},api(n){return n.controller instanceof Jn?new En(n.controller):null}},Bs=D("");function jt(n,e){return ee(n,Bs(void 0,e))}class We extends B{constructor(e){super(e)}static create(e){var t,i;const c=e!=null?e:{},_={disabled:(t=c.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=c.hidden)!==null&&i!==void 0?i:!1},y=B.createCore(_);return new We(y)}bindClassModifiers(e){X(this,"disabled",jt(e,"disabled")),X(this,"hidden",jt(e,"hidden"))}bindDisabled(e){X(this,"disabled",t=>{e.disabled=t})}bindTabIndex(e){X(this,"disabled",t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}}const pe=D("tbi");class Us{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(pe()),t.viewProps.bindClassModifiers(this.element),X(t.props,"selected",_=>{_?this.element.classList.add(pe(void 0,"sel")):this.element.classList.remove(pe(void 0,"sel"))});const i=e.createElement("button");i.classList.add(pe("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const c=e.createElement("div");c.classList.add(pe("t")),se(t.props.value("title"),c),this.buttonElement.appendChild(c),this.titleElement=c}}class tn{constructor(e,t){this.emitter=new O,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new Us(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class ts{constructor(e,t){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new tn(e,{props:t.itemProps,viewProps:We.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Ft(e,{blade:Fe(),viewProps:We.create()}),this.props=t.props,X(this.props,"selected",i=>{this.itemController.props.set("selected",i),this.contentController.viewProps.set("hidden",!i)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class kn{constructor(e,t){this.controller_=e,this.rackApi_=t}get title(){var e;return(e=this.controller_.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller_.itemController.props.set("title",e)}get selected(){return this.controller_.props.get("selected")}set selected(e){this.controller_.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addInput(e,t,i){return this.rackApi_.addInput(e,t,i)}addMonitor(e,t,i){return this.rackApi_.addMonitor(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}}class ns extends H{constructor(e,t){super(e,new Rt(e.rackController,t)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new O,this.pageApiMap_=new Map,this.rackApi_.on("change",i=>{this.emitter_.emit("change",{event:i})}),this.rackApi_.on("update",i=>{this.emitter_.emit("update",{event:i})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(i=>{this.setUpPageApi_(i)})}get pages(){return this.controller_.pageSet.items.map(e=>{const t=this.pageApiMap_.get(e);if(!t)throw A.shouldNeverHappen();return t})}addPage(e){const t=this.controller_.view.element.ownerDocument,i=new ts(t,{itemProps:B.fromObject({selected:!1,title:e.title}),props:B.fromObject({selected:!1})});this.controller_.add(i,e.index);const c=this.pageApiMap_.get(i);if(!c)throw A.shouldNeverHappen();return c}removePage(e){this.controller_.remove(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,c=>{i(c.event)}),this}setUpPageApi_(e){const t=this.rackApi_.apiSet_.find(c=>c.controller_===e.contentController);if(!t)throw A.shouldNeverHappen();const i=new kn(e,t);this.pageApiMap_.set(e,i)}onPageAdd_(e){this.setUpPageApi_(e.item)}onPageRemove_(e){if(!this.pageApiMap_.get(e.item))throw A.shouldNeverHappen();this.pageApiMap_.delete(e.item)}onSelect_(e){this.emitter_.emit("select",{event:new x(this,e.rawValue)})}}const ss=-1;class zs{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=W(!0),this.selectedIndex=W(ss),this.items_=[]}add(e,t){const i=t!=null?t:this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=ss,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,c)=>{i.rawValue=c===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}}const Bt=D("tab");class bt{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Bt(),Zn()),t.viewProps.bindClassModifiers(this.element),ne(t.empty,ee(this.element,Bt(void 0,"nop")));const i=e.createElement("div");i.classList.add(Bt("i")),this.element.appendChild(i),this.itemsElement=i;const c=t.contentsElement;c.classList.add(Bt("c")),this.element.appendChild(c),this.contentsElement=c}}class Ut extends yn{constructor(e,t){const i=new Ft(e,{blade:t.blade,viewProps:t.viewProps}),c=new zs;super({blade:t.blade,rackController:i,view:new bt(e,{contentsElement:i.view.element,empty:c.empty,viewProps:t.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new we(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=c}get pageSet(){return this.pageSet_}add(e,t){this.pageSet_.add(e,t)}remove(e){this.pageSet_.remove(this.pageSet_.items[e])}onPageAdd_(e){const t=e.item;nt(this.view.itemsElement,t.itemController.view.element,e.index),this.rackController.rack.add(t.contentController,e.index),this.tab.add(t.props.value("selected"))}onPageRemove_(e){const t=e.item;He(t.itemController.view.element),this.rackController.rack.remove(t.contentController),this.tab.remove(t.props.value("selected"))}}const Mn={id:"tab",type:"blade",accept(n){const e=$,t=oe(n,{pages:e.required.array(e.required.object({title:e.required.string})),view:e.required.constant("tab")});return!t||t.pages.length===0?null:{params:t}},controller(n){const e=new Ut(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new ts(n.document,{itemProps:B.fromObject({selected:!1,title:t.title}),props:B.fromObject({selected:!1})});e.add(i)}),e},api(n){return n.controller instanceof Ut?new ns(n.controller,n.pool):null}};function Ks(n,e){const t=n.accept(e.params);if(!t)return null;const i=$.optional.boolean(e.params.disabled).value,c=$.optional.boolean(e.params.hidden).value;return n.controller({blade:Fe(),document:e.document,params:Object.assign(Object.assign({},t.params),{disabled:i,hidden:c}),viewProps:We.create({disabled:i,hidden:c})})}class is{constructor(){this.disabled=!1,this.emitter=new O}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Ln{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new O,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Ze{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}}function J(n,e){if(n instanceof e)return n;if(n instanceof Ze){const t=n.constraints.reduce((i,c)=>i||(c instanceof e?c:null),null);if(t)return t}return null}class _t{constructor(e){this.options=e}constrain(e){const t=this.options;return t.length===0||t.filter(c=>c.value===e).length>0?e:t[0].value}}class Ve{constructor(e){this.maxValue=e.max,this.minValue=e.min}constrain(e){let t=e;return g(this.minValue)||(t=Math.max(t,this.minValue)),g(this.maxValue)||(t=Math.min(t,this.maxValue)),t}}class me{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}}const Sn=D("lst");class Gs{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(Sn()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(Sn("s")),X(this.props_,"options",_=>{Zt(i),_.forEach((y,S)=>{const j=e.createElement("option");j.dataset.index=String(S),j.textContent=y.text,j.value=String(y.value),i.appendChild(j)})}),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const c=e.createElement("div");c.classList.add(Sn("m")),c.appendChild(qe(e,"dropdown")),this.element.appendChild(c),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class it{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Gs(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const i=e.currentTarget.selectedOptions.item(0);if(!i)return;const c=Number(i.dataset.index);this.value.rawValue=this.props.get("options")[c].value}}const rs=D("pop");class $s{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(rs()),t.viewProps.bindClassModifiers(this.element),ne(t.shows,ee(this.element,rs(void 0,"v")))}}class An{constructor(e,t){this.shows=W(!1),this.viewProps=t.viewProps,this.view=new $s(e,{shows:this.shows,viewProps:this.viewProps})}}const os=D("txt");class nn{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(os()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(os("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class zt{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new nn(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,c=this.parser_(i);g(c)||(this.value.rawValue=c),this.view.refresh()}}function qs(n){return String(n)}function as(n){return n==="false"?!1:!!n}function ls(n){return qs(n)}class Hs{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const Ys={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};class Xs{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=Ys[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Ws={"+":n=>n,"-":n=>-n,"~":n=>~n};class Zs{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=Ws[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Tn(n){return(e,t)=>{for(let i=0;i<n.length;i++){const c=n[i](e,t);if(c!=="")return c}return""}}function Kt(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Qs(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function Gt(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Js(n,e){const t=Gt(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const c=Gt(n,e);return c===""?"":i+c}function sn(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=Js(n,e);return i===""?"":t+i}function cs(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=Qs(n,e);return e+=i.length,i===""?"":i+Gt(n,e)}function ei(n,e){const t=cs(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const c=Gt(n,e);return e+=c.length,t+i+c+sn(n,e)}function Vn(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=Gt(n,e);return e+=i.length,i===""?"":t+i+sn(n,e)}function ti(n,e){const t=cs(n,e);return e+=t.length,t===""?"":t+sn(n,e)}const ni=Tn([ei,Vn,ti]);function si(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Qe(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=si(n,e);return i===""?"":t+i}function ii(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function ri(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=ii(n,e);return i===""?"":t+i}function oi(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function ai(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=oi(n,e);return i===""?"":t+i}const li=Tn([Qe,ri,ai]),ps=Tn([li,ni]);function ci(n,e){const t=ps(n,e);return e+=t.length,t===""?null:{evaluable:new Hs(t),cursor:e}}function pi(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=Be(n,e);if(!i)return null;e=i.cursor,e+=Kt(n,e).length;const c=n.substr(e,1);return e+=c.length,c!==")"?null:{evaluable:i.evaluable,cursor:e}}function Se(n,e){var t;return(t=ci(n,e))!==null&&t!==void 0?t:pi(n,e)}function us(n,e){const t=Se(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const c=us(n,e);return c?(e=c.cursor,{cursor:e,evaluable:new Zs(i,c.evaluable)}):null}function ui(n,e,t){t+=Kt(e,t).length;const i=n.filter(c=>e.startsWith(c,t))[0];return i?(t+=i.length,t+=Kt(e,t).length,{cursor:t,operator:i}):null}function Nn(n,e){return(t,i)=>{const c=n(t,i);if(!c)return null;i=c.cursor;let _=c.evaluable;for(;;){const y=ui(e,t,i);if(!y)break;i=y.cursor;const S=n(t,i);if(!S)return null;i=S.cursor,_=new Xs(y.operator,_,S.evaluable)}return _?{cursor:i,evaluable:_}:null}}const di=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>Nn(n,e),us);function Be(n,e){return e+=Kt(n,e).length,di(n,e)}function ds(n){const e=Be(n,0);return!e||e.cursor+Kt(n,e.cursor).length!==n.length?null:e.evaluable}function Ue(n){var e;const t=ds(n);return(e=t==null?void 0:t.evaluate())!==null&&e!==void 0?e:null}function On(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=Ue(n);if(!g(e))return e}return 0}function hi(n){return String(n)}function ie(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}const mi=ie(0);function gt(n){return mi(n)+"%"}function hs(n){return String(n)}function rn(n){return n}function ze(n,e){for(;n.length<e;)n.push(void 0)}function vi(n){const e=[];return ze(e,n),W(e)}function fi(n){const e=n.indexOf(void 0);return e<0?n:n.slice(0,e)}function ms(n,e){const t=[...fi(n),e];return t.length>n.length?t.splice(0,t.length-n.length):ze(t,n.length),t}function wt({primary:n,secondary:e,forward:t,backward:i}){let c=!1;function _(y){c||(c=!0,y(),c=!1)}n.emitter.on("change",y=>{_(()=>{e.setRawValue(t(n,e),y.options)})}),e.emitter.on("change",y=>{_(()=>{n.setRawValue(i(n,e),y.options)}),_(()=>{e.setRawValue(t(n,e),y.options)})}),_(()=>{e.setRawValue(t(n,e),{forceEmit:!1,last:!0})})}function ve(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function De(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function Ke(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function In(n){return n==="ArrowUp"||n==="ArrowDown"}function vs(n){return In(n)||n==="ArrowLeft"||n==="ArrowRight"}function Dn(n,e){var t,i;const c=e.ownerDocument.defaultView,_=e.getBoundingClientRect();return{x:n.pageX-(((t=c&&c.scrollX)!==null&&t!==void 0?t:0)+_.left),y:n.pageY-(((i=c&&c.scrollY)!==null&&i!==void 0?i:0)+_.top)}}class rt{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new O,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(Dn(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(Dn(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(Dn(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,c=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-c.left,y:i.clientY-c.top}:void 0),sender:this,shiftKey:e.shiftKey})}}function te(n,e,t,i,c){const _=(n-e)/(t-e);return i+_*(c-i)}function fs(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function le(n,e,t){return Math.min(Math.max(n,e),t)}function bs(n,e){return(n%e+e)%e}const ye=D("txt");class bi{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(ye(),ye(void 0,"num")),t.arrayPosition&&this.element.classList.add(ye(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(ye("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(ye()),this.inputElement.classList.add(ye("i"));const c=e.createElement("div");c.classList.add(ye("k")),this.element.appendChild(c),this.knobElement=c;const _=e.createElementNS(Ee,"svg");_.classList.add(ye("g")),this.knobElement.appendChild(_);const y=e.createElementNS(Ee,"path");y.classList.add(ye("gb")),_.appendChild(y),this.guideBodyElem_=y;const S=e.createElementNS(Ee,"path");S.classList.add(ye("gh")),_.appendChild(S),this.guideHeadElem_=S;const j=e.createElement("div");j.classList.add(D("tt")()),this.knobElement.appendChild(j),this.tooltipElem_=j,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(ye(void 0,"drg"));return}this.element.classList.add(ye(void 0,"drg"));const t=e.rawValue/this.props_.get("draggingScale"),i=t+(t>0?-1:t<0?1:0),c=le(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+c},0 L${i},4 L${i+c},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const _=this.props_.get("formatter");this.tooltipElem_.textContent=_(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class Ge{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=W(null),this.view=new bi(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const c=new rt(this.view.knobElement);c.emitter.on("down",this.onPointerDown_),c.emitter.on("move",this.onPointerMove_),c.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const c=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("minValue"),_=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("maxValue");let y=e;return c!==void 0&&(y=Math.max(y,c)),_!==void 0&&(y=Math.min(y,_)),y}onInputChange_(e){const i=e.currentTarget.value,c=this.parser_(i);g(c)||(this.value.rawValue=this.constrainValue_(c)),this.view.refresh()}onInputKeyDown_(e){const t=ve(this.baseStep_,De(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){ve(this.baseStep_,De(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("draggingScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Rn=D("sld");class _s{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Rn()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Rn("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const c=e.createElement("div");c.classList.add(Rn("k")),this.trackElement.appendChild(c),this.knobElement=c,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=le(te(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class _i{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new _s(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new rt(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){!e.point||this.value.setRawValue(te(le(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=ve(this.baseStep_,Ke(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){ve(this.baseStep_,Ke(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Fn=D("sldtxt");class Ae{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Fn());const i=e.createElement("div");i.classList.add(Fn("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const c=e.createElement("div");c.classList.add(Fn("t")),this.textView_=t.textView,c.appendChild(this.textView_.element),this.element.appendChild(c)}}class on{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new _i(e,{baseStep:t.baseStep,props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Ge(e,{baseStep:t.baseStep,parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new Ae(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function xt(n,e){n.write(e)}function yt(n){const e=$;if(Array.isArray(n))return e.required.array(e.required.object({text:e.required.string,value:e.required.raw}))(n).value;if(typeof n=="object")return e.required.raw(n).value}function gs(n){if(n==="inline"||n==="popup")return n}function be(n){const e=$;return e.required.object({max:e.optional.number,min:e.optional.number,step:e.optional.number})(n).value}function ws(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function jn(n){return g(n)?null:new _t(ws(n))}function Bn(n){const e=n?J(n,_t):null;return e?e.options:null}function gi(n){const e=n?J(n,me):null;return e?e.step:null}function an(n,e){const t=n&&J(n,me);return t?fs(t.step):Math.max(fs(e),2)}function Ct(n){const e=gi(n);return e!=null?e:1}function Pt(n,e){var t;const i=n&&J(n,me),c=Math.abs((t=i==null?void 0:i.step)!==null&&t!==void 0?t:e);return c===0?.1:Math.pow(10,Math.floor(Math.log10(c))-1)}const ln=D("ckb");class wi{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(ln()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(ln("l")),this.element.appendChild(i);const c=e.createElement("input");c.classList.add(ln("i")),c.type="checkbox",i.appendChild(c),this.inputElement=c,t.viewProps.bindDisabled(this.inputElement);const _=e.createElement("div");_.classList.add(ln("w")),i.appendChild(_);const y=qe(e,"check");_.appendChild(y),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class xi{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new wi(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}}function $t(n){const e=[],t=jn(n.options);return t&&e.push(t),new Ze(e)}const yi={id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const i=oe(e,{options:$.optional.custom(yt)});return i?{initialValue:n,params:i}:null},binding:{reader:n=>as,constraint:n=>$t(n.params),writer:n=>xt},controller:n=>{var e;const t=n.document,i=n.value,c=n.constraint;return c&&J(c,_t)?new it(t,{props:B.fromObject({options:(e=Bn(c))!==null&&e!==void 0?e:[]}),value:i,viewProps:n.viewProps}):new xi(t,{value:i,viewProps:n.viewProps})}},ot=D("col");class Un{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ot()),t.foldable.bindExpandedClass(this.element,ot(void 0,"expanded")),X(t.foldable,"completed",ee(this.element,ot(void 0,"cpl")));const i=e.createElement("div");i.classList.add(ot("h")),this.element.appendChild(i);const c=e.createElement("div");c.classList.add(ot("s")),i.appendChild(c),this.swatchElement=c;const _=e.createElement("div");if(_.classList.add(ot("t")),i.appendChild(_),this.textElement=_,t.pickerLayout==="inline"){const y=e.createElement("div");y.classList.add(ot("p")),this.element.appendChild(y),this.pickerElement=y}else this.pickerElement=null}}function Ci(n,e,t){const i=le(n/255,0,1),c=le(e/255,0,1),_=le(t/255,0,1),y=Math.max(i,c,_),S=Math.min(i,c,_),j=y-S;let z=0,Z=0;const Q=(S+y)/2;return j!==0&&(Z=j/(1-Math.abs(y+S-1)),i===y?z=(c-_)/j:c===y?z=2+(_-i)/j:z=4+(i-c)/j,z=z/6+(z<0?1:0)),[z*360,Z*100,Q*100]}function zn(n,e,t){const i=(n%360+360)%360,c=le(e/100,0,1),_=le(t/100,0,1),y=(1-Math.abs(2*_-1))*c,S=y*(1-Math.abs(i/60%2-1)),j=_-y/2;let z,Z,Q;return i>=0&&i<60?[z,Z,Q]=[y,S,0]:i>=60&&i<120?[z,Z,Q]=[S,y,0]:i>=120&&i<180?[z,Z,Q]=[0,y,S]:i>=180&&i<240?[z,Z,Q]=[0,S,y]:i>=240&&i<300?[z,Z,Q]=[S,0,y]:[z,Z,Q]=[y,0,S],[(z+j)*255,(Z+j)*255,(Q+j)*255]}function Pi(n,e,t){const i=le(n/255,0,1),c=le(e/255,0,1),_=le(t/255,0,1),y=Math.max(i,c,_),S=Math.min(i,c,_),j=y-S;let z;j===0?z=0:y===i?z=60*(((c-_)/j%6+6)%6):y===c?z=60*((_-i)/j+2):z=60*((i-c)/j+4);const Z=y===0?0:j/y,Q=y;return[z,Z*100,Q*100]}function xs(n,e,t){const i=bs(n,360),c=le(e/100,0,1),_=le(t/100,0,1),y=_*c,S=y*(1-Math.abs(i/60%2-1)),j=_-y;let z,Z,Q;return i>=0&&i<60?[z,Z,Q]=[y,S,0]:i>=60&&i<120?[z,Z,Q]=[S,y,0]:i>=120&&i<180?[z,Z,Q]=[0,y,S]:i>=180&&i<240?[z,Z,Q]=[0,S,y]:i>=240&&i<300?[z,Z,Q]=[S,0,y]:[z,Z,Q]=[y,0,S],[(z+j)*255,(Z+j)*255,(Q+j)*255]}function Ei(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function ki(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function o(n){return[n[0],n[1],n[2]]}function s(n,e){return[n[0],n[1],n[2],e]}const r={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:Ei,rgb:zn},hsv:{hsl:ki,hsv:(n,e,t)=>[n,e,t],rgb:xs},rgb:{hsl:Ci,hsv:Pi,rgb:(n,e,t)=>[n,e,t]}};function l(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function v(n,e,t){var i;const c=l(e,t);return[e==="rgb"?le(n[0],0,c[0]):bs(n[0],c[0]),le(n[1],0,c[1]),le(n[2],0,c[2]),le((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function w(n,e,t,i){const c=l(e,t),_=l(e,i);return n.map((y,S)=>y/c[S]*_[S])}function k(n,e,t){const i=w(n,e.mode,e.type,"int"),c=r[e.mode][t.mode](...i);return w(c,t.mode,"int",t.type)}function V(n,e){return typeof n!="object"||g(n)?!1:e in n&&typeof n[e]=="number"}class R{constructor(e,t,i="int"){this.mode=t,this.type=i,this.comps_=v(e,t,i)}static black(e="int"){return new R([0,0,0],"rgb",e)}static fromObject(e,t="int"){const i="a"in e?[e.r,e.g,e.b,e.a]:[e.r,e.g,e.b];return new R(i,"rgb",t)}static toRgbaObject(e,t="int"){return e.toRgbaObject(t)}static isRgbColorObject(e){return V(e,"r")&&V(e,"g")&&V(e,"b")}static isRgbaColorObject(e){return this.isRgbColorObject(e)&&V(e,"a")}static isColorObject(e){return this.isRgbColorObject(e)}static equals(e,t){if(e.mode!==t.mode)return!1;const i=e.comps_,c=t.comps_;for(let _=0;_<i.length;_++)if(i[_]!==c[_])return!1;return!0}getComponents(e,t="int"){return s(k(o(this.comps_),{mode:this.mode,type:this.type},{mode:e!=null?e:this.mode,type:t}),this.comps_[3])}toRgbaObject(e="int"){const t=this.getComponents("rgb",e);return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const ce=D("colp");class $e{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(ce());const i=e.createElement("div");i.classList.add(ce("hsv"));const c=e.createElement("div");c.classList.add(ce("sv")),this.svPaletteView_=t.svPaletteView,c.appendChild(this.svPaletteView_.element),i.appendChild(c);const _=e.createElement("div");_.classList.add(ce("h")),this.hPaletteView_=t.hPaletteView,_.appendChild(this.hPaletteView_.element),i.appendChild(_),this.element.appendChild(i);const y=e.createElement("div");if(y.classList.add(ce("rgb")),this.textView_=t.textView,y.appendChild(this.textView_.element),this.element.appendChild(y),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const S=e.createElement("div");S.classList.add(ce("a"));const j=e.createElement("div");j.classList.add(ce("ap")),j.appendChild(this.alphaViews_.palette.element),S.appendChild(j);const z=e.createElement("div");z.classList.add(ce("at")),z.appendChild(this.alphaViews_.text.element),S.appendChild(z),this.element.appendChild(S)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function Kn(n){return n==="int"?"int":n==="float"?"float":void 0}function Gn(n){const e=$;return oe(n,{alpha:e.optional.boolean,color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(Kn)}),expanded:e.optional.boolean,picker:e.optional.custom(gs)})}function at(n){return n?.1:1}function qt(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}function Mo(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function Re(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const Lo={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function tr(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return Lo[i](t)}function nr(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Re(e[1],255),Re(e[2],255),Re(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function sr(n){return e=>{const t=nr(e);return t?new R(t,"rgb",n):null}}function ir(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Re(e[1],255),Re(e[2],255),Re(e[3],255),Re(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function rr(n){return e=>{const t=ir(e);return t?new R(t,"rgb",n):null}}function or(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[tr(e[1]),Re(e[2],100),Re(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function ar(n){return e=>{const t=or(e);return t?new R(t,"hsl",n):null}}function lr(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[tr(e[1]),Re(e[2],100),Re(e[3],100),Re(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function cr(n){return e=>{const t=lr(e);return t?new R(t,"hsl",n):null}}function pr(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function So(n){const e=pr(n);return e?new R(e,"rgb","int"):null}function ur(n){const e=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),te(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),te(parseInt(t[4],16),0,255,0,1)]:null}function Ao(n){const e=ur(n);return e?new R(e,"rgb","int"):null}function dr(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function hr(n){return e=>{const t=dr(e);return t?new R(t,"rgb",n):null}}function mr(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function vr(n){return e=>{const t=mr(e);return t?new R(t,"rgb",n):null}}const To=[{parser:pr,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:ur,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:nr,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:ir,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:or,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:lr,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:dr,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:mr,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Vo(n){return To.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function Mi(n,e="int"){const t=Vo(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}const fr={int:[So,Ao,sr("int"),rr("int"),ar("int"),cr("int"),hr("int"),vr("int")],float:[sr("float"),rr("float"),ar("float"),cr("float"),hr("float"),vr("float")]};function No(n){const e=fr[n];return t=>{if(typeof t!="string")return R.black(n);const i=e.reduce((c,_)=>c||_(t),null);return i!=null?i:R.black(n)}}function Li(n){const e=fr[n];return t=>e.reduce((i,c)=>i||c(t),null)}function br(n){const e=le(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function _r(n,e="#"){const t=o(n.getComponents("rgb")).map(br).join("");return`${e}${t}`}function Si(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(br).join("");return`${e}${i}`}function gr(n,e){const t=ie(e==="float"?2:0);return`rgb(${o(n.getComponents("rgb",e)).map(c=>t(c)).join(", ")})`}function Oo(n){return e=>gr(e,n)}function ys(n,e){const t=ie(2),i=ie(e==="float"?2:0);return`rgba(${n.getComponents("rgb",e).map((_,y)=>(y===3?t:i)(_)).join(", ")})`}function Io(n){return e=>ys(e,n)}function Do(n){const e=[ie(0),gt,gt];return`hsl(${o(n.getComponents("hsl")).map((i,c)=>e[c](i)).join(", ")})`}function Ro(n){const e=[ie(0),gt,gt,ie(2)];return`hsla(${n.getComponents("hsl").map((i,c)=>e[c](i)).join(", ")})`}function wr(n,e){const t=ie(e==="float"?2:0),i=["r","g","b"];return`{${o(n.getComponents("rgb",e)).map((_,y)=>`${i[y]}: ${t(_)}`).join(", ")}}`}function Fo(n){return e=>wr(e,n)}function xr(n,e){const t=ie(2),i=ie(e==="float"?2:0),c=["r","g","b","a"];return`{${n.getComponents("rgb",e).map((y,S)=>{const j=S===3?t:i;return`${c[S]}: ${j(y)}`}).join(", ")}}`}function jo(n){return e=>xr(e,n)}const Bo=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:_r},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Si},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:Do},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:Ro},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"func",type:e},stringifier:Oo(e)},{format:{alpha:!0,mode:"rgb",notation:"func",type:e},stringifier:Io(e)},{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:Fo(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:jo(e)}],[])];function Ai(n){return Bo.reduce((e,t)=>e||(Mo(t.format,n)?t.stringifier:null),null)}const $n=D("apl");class Uo{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add($n()),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add($n("b")),this.element.appendChild(i);const c=e.createElement("div");c.classList.add($n("c")),i.appendChild(c),this.colorElem_=c;const _=e.createElement("div");_.classList.add($n("m")),this.element.appendChild(_),this.markerElem_=_;const y=e.createElement("div");y.classList.add($n("p")),this.markerElem_.appendChild(y),this.previewElem_=y,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new R([t[0],t[1],t[2],0],"rgb"),c=new R([t[0],t[1],t[2],255],"rgb"),_=["to right",ys(i),ys(c)];this.colorElem_.style.background=`linear-gradient(${_.join(",")})`,this.previewElem_.style.backgroundColor=ys(e);const y=te(t[3],0,1,0,100);this.markerElem_.style.left=`${y}%`}onValueChange_(){this.update_()}}class zo{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Uo(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new rt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,c=this.value.rawValue,[_,y,S]=c.getComponents("hsv");this.value.setRawValue(new R([_,y,S,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=ve(at(!0),Ke(e));if(t===0)return;const i=this.value.rawValue,[c,_,y,S]=i.getComponents("hsv");this.value.setRawValue(new R([c,_,y,S+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){ve(at(!0),Ke(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const cn=D("coltxt");function Ko(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return e.appendChild(t.reduce((i,c)=>{const _=n.createElement("option");return _.textContent=c.text,_.value=c.value,i.appendChild(_),i},n.createDocumentFragment())),e}class Go{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(cn());const i=e.createElement("div");i.classList.add(cn("m")),this.modeElem_=Ko(e),this.modeElem_.classList.add(cn("ms")),i.appendChild(this.modeSelectElement);const c=e.createElement("div");c.classList.add(cn("mm")),c.appendChild(qe(e,"dropdown")),i.appendChild(c),this.element.appendChild(i);const _=e.createElement("div");_.classList.add(cn("w")),this.element.appendChild(_),this.textsElem_=_,this.textViews_=t.textViews,this.applyTextViews_(),ne(t.colorMode,y=>{this.modeElem_.value=y})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(e){this.textViews_=e,this.applyTextViews_()}applyTextViews_(){Zt(this.textsElem_);const e=this.element.ownerDocument;this.textViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(cn("c")),i.appendChild(t.element),this.textsElem_.appendChild(i)})}}function $o(n){return ie(n==="float"?2:0)}function qo(n,e,t){const i=l(n,e)[t];return new Ve({min:0,max:i})}function Ti(n,e,t){return new Ge(n,{arrayPosition:t===0?"fst":t===3-1?"lst":"mid",baseStep:at(!1),parser:e.parser,props:B.fromObject({draggingScale:e.colorType==="float"?.01:1,formatter:$o(e.colorType)}),value:W(0,{constraint:qo(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}class Ho{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.parser_=t.parser,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=W(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new Go(e,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},i=[Ti(e,t,0),Ti(e,t,1),Ti(e,t,2)];return i.forEach((c,_)=>{wt({primary:this.value,secondary:c.value,forward:y=>y.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[_],backward:(y,S)=>{const j=this.colorMode.rawValue,z=y.rawValue.getComponents(j,this.colorType_);return z[_]=S.rawValue,new R(s(o(z),z[3]),j,this.colorType_)}})}),i}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Vi=D("hpl");class Yo{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Vi()),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Vi("c")),this.element.appendChild(i);const c=e.createElement("div");c.classList.add(Vi("m")),this.element.appendChild(c),this.markerElem_=c,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=gr(new R([t,100,100],"hsv"));const i=te(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}}class Xo{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Yo(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new rt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=te(le(e.point.x,0,e.bounds.width),0,e.bounds.width,0,359),c=this.value.rawValue,[,_,y,S]=c.getComponents("hsv");this.value.setRawValue(new R([i,_,y,S],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=ve(at(!1),Ke(e));if(t===0)return;const i=this.value.rawValue,[c,_,y,S]=i.getComponents("hsv");this.value.setRawValue(new R([c+t,_,y,S],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){ve(at(!1),Ke(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ni=D("svp"),yr=64;class Wo{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Ni()),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=yr,i.width=yr,i.classList.add(Ni("c")),this.element.appendChild(i),this.canvasElement=i;const c=e.createElement("div");c.classList.add(Ni("m")),this.element.appendChild(c),this.markerElem_=c,this.update_()}update_(){const e=gn(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),c=this.canvasElement.width,_=this.canvasElement.height,y=e.getImageData(0,0,c,_),S=y.data;for(let Z=0;Z<_;Z++)for(let Q=0;Q<c;Q++){const ct=te(Q,0,c,0,100),Hn=te(Z,0,_,100,0),Yn=xs(i[0],ct,Hn),hn=(Z*c+Q)*4;S[hn]=Yn[0],S[hn+1]=Yn[1],S[hn+2]=Yn[2],S[hn+3]=255}e.putImageData(y,0,0);const j=te(i[1],0,100,0,100);this.markerElem_.style.left=`${j}%`;const z=te(i[2],0,100,100,0);this.markerElem_.style.top=`${z}%`}onValueChange_(){this.update_()}}class Zo{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Wo(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new rt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=te(e.point.x,0,e.bounds.width,0,100),c=te(e.point.y,0,e.bounds.height,100,0),[_,,,y]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new R([_,i,c,y],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){vs(e.key)&&e.preventDefault();const[t,i,c,_]=this.value.rawValue.getComponents("hsv"),y=at(!1),S=ve(y,Ke(e)),j=ve(y,De(e));S===0&&j===0||this.value.setRawValue(new R([t,i+S,c+j,_],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=at(!1),i=ve(t,Ke(e)),c=ve(t,De(e));i===0&&c===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Qo{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new Xo(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Zo(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new zo(e,{value:this.value,viewProps:this.viewProps}),text:new Ge(e,{parser:Ue,baseStep:.1,props:B.fromObject({draggingScale:.01,formatter:ie(2)}),value:W(0,{constraint:new Ve({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&wt({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.rawValue.getComponents()[3],backward:(i,c)=>{const _=i.rawValue.getComponents();return _[3]=c.rawValue,new R(_,i.rawValue.mode)}}),this.textC_=new Ho(e,{colorType:t.colorType,parser:Ue,value:this.value,viewProps:this.viewProps}),this.view=new $e(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const Oi=D("colsw");class Jo{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Oi()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Oi("sw")),this.element.appendChild(i),this.swatchElem_=i;const c=e.createElement("button");c.classList.add(Oi("b")),t.viewProps.bindDisabled(c),this.element.appendChild(c),this.buttonElement=c,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=Si(e)}onValueChange_(){this.update_()}}class ea{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Jo(e,{value:this.value,viewProps:this.viewProps})}}class Ii{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=je.create(t.expanded),this.swatchC_=new ea(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new zt(e,{parser:t.parser,props:B.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Un(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new An(e,{viewProps:this.viewProps}):null;const c=new Qo(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});c.view.allFocusableElements.forEach(_=>{_.addEventListener("blur",this.onPopupChildBlur_),_.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=c,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(c.view.element),wt({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:_=>_.rawValue,backward:(_,y)=>y.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),U(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=Oe(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!dt(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function ta(n,e){return R.isColorObject(n)?R.fromObject(n,e):R.black(e)}function na(n){return o(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function sa(n){return n.getComponents("rgb").reduce((e,t,i)=>{const c=Math.floor(i===3?t*255:t)&255;return e<<8|c},0)>>>0}function ia(n){return new R([n>>16&255,n>>8&255,n&255],"rgb")}function ra(n){return new R([n>>24&255,n>>16&255,n>>8&255,te(n&255,0,255,0,1)],"rgb")}function oa(n){return typeof n!="number"?R.black():ia(n)}function aa(n){return typeof n!="number"?R.black():ra(n)}function la(n){const e=Ai(n);return e?(t,i)=>{xt(t,e(i))}:null}function ca(n){const e=n?sa:na;return(t,i)=>{xt(t,e(i))}}function pa(n,e,t){const i=e.toRgbaObject(t);n.writeProperty("r",i.r),n.writeProperty("g",i.g),n.writeProperty("b",i.b),n.writeProperty("a",i.a)}function ua(n,e,t){const i=e.toRgbaObject(t);n.writeProperty("r",i.r),n.writeProperty("g",i.g),n.writeProperty("b",i.b)}function da(n,e){return(t,i)=>{n?pa(t,i,e):ua(t,i,e)}}function Di(n){var e;return!!((n==null?void 0:n.alpha)||((e=n==null?void 0:n.color)===null||e===void 0?void 0:e.alpha))}function ha(n){return n?e=>Si(e,"0x"):e=>_r(e,"0x")}function ma(n){return"color"in n||"view"in n&&n.view==="color"}const va={id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!ma(e))return null;const t=Gn(e);return t?{initialValue:n,params:t}:null},binding:{reader:n=>Di(n.params)?aa:oa,equals:R.equals,writer:n=>ca(Di(n.params))},controller:n=>{const e=Di(n.params),t="expanded"in n.params?n.params.expanded:void 0,i="picker"in n.params?n.params.picker:void 0;return new Ii(n.document,{colorType:"int",expanded:t!=null?t:!1,formatter:ha(e),parser:Li("int"),pickerLayout:i!=null?i:"popup",supportsAlpha:e,value:n.value,viewProps:n.viewProps})}};function fa(n){return R.isRgbaColorObject(n)}function ba(n){return e=>ta(e,n)}function _a(n,e){return t=>n?xr(t,e):wr(t,e)}const ga={id:"input-color-object",type:"input",accept:(n,e)=>{if(!R.isColorObject(n))return null;const t=Gn(e);return t?{initialValue:n,params:t}:null},binding:{reader:n=>ba(qt(n.params)),equals:R.equals,writer:n=>da(fa(n.initialValue),qt(n.params))},controller:n=>{var e;const t=R.isRgbaColorObject(n.initialValue),i="expanded"in n.params?n.params.expanded:void 0,c="picker"in n.params?n.params.picker:void 0,_=(e=qt(n.params))!==null&&e!==void 0?e:"int";return new Ii(n.document,{colorType:_,expanded:i!=null?i:!1,formatter:_a(t,_),parser:Li(_),pickerLayout:c!=null?c:"popup",supportsAlpha:t,value:n.value,viewProps:n.viewProps})}},wa={id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||"view"in e&&e.view==="text")return null;const t=Mi(n,qt(e));if(!t||!Ai(t))return null;const c=Gn(e);return c?{initialValue:n,params:c}:null},binding:{reader:n=>{var e;return No((e=qt(n.params))!==null&&e!==void 0?e:"int")},equals:R.equals,writer:n=>{const e=Mi(n.initialValue,qt(n.params));if(!e)throw A.shouldNeverHappen();const t=la(e);if(!t)throw A.notBindable();return t}},controller:n=>{const e=Mi(n.initialValue,qt(n.params));if(!e)throw A.shouldNeverHappen();const t=Ai(e);if(!t)throw A.shouldNeverHappen();const i="expanded"in n.params?n.params.expanded:void 0,c="picker"in n.params?n.params.picker:void 0;return new Ii(n.document,{colorType:e.type,expanded:i!=null?i:!1,formatter:t,parser:Li(e.type),pickerLayout:c!=null?c:"popup",supportsAlpha:e.alpha,value:n.value,viewProps:n.viewProps})}};class Et{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,c)=>{var _,y;return(y=(_=this.components[c])===null||_===void 0?void 0:_.constrain(i))!==null&&y!==void 0?y:i});return this.asm_.fromComponents(t)}}const Cr=D("pndtxt");class xa{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(Cr()),this.textViews.forEach(i=>{const c=e.createElement("div");c.classList.add(Cr("a")),c.appendChild(i.element),this.element.appendChild(c)})}}function ya(n,e,t){return new Ge(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",baseStep:e.axes[t].baseStep,parser:e.parser,props:e.axes[t].textProps,value:W(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}class Ri{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,c)=>ya(e,t,c)),this.acs_.forEach((i,c)=>{wt({primary:this.value,secondary:i.value,forward:_=>t.assembly.toComponents(_.rawValue)[c],backward:(_,y)=>{const S=t.assembly.toComponents(_.rawValue);return S[c]=y.rawValue,t.assembly.fromComponents(S)}})}),this.view=new xa(e,{textViews:this.acs_.map(i=>i.view)})}}function Pr(n,e){return"step"in n&&!g(n.step)?new me(n.step,e):null}function Er(n){return"max"in n&&!g(n.max)||"min"in n&&!g(n.min)?new Ve({max:n.max,min:n.min}):null}function Ca(n,e){const t=[],i=Pr(n,e);i&&t.push(i);const c=Er(n);c&&t.push(c);const _=jn(n.options);return _&&t.push(_),new Ze(t)}function Pa(n){const e=n?J(n,Ve):null;return e?[e.minValue,e.maxValue]:[void 0,void 0]}function Ea(n){const[e,t]=Pa(n);return[e!=null?e:0,t!=null?t:100]}const ka={id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=$,i=oe(e,{format:t.optional.function,max:t.optional.number,min:t.optional.number,options:t.optional.custom(yt),step:t.optional.number});return i?{initialValue:n,params:i}:null},binding:{reader:n=>On,constraint:n=>Ca(n.params,n.initialValue),writer:n=>xt},controller:n=>{var e,t;const i=n.value,c=n.constraint;if(c&&J(c,_t))return new it(n.document,{props:B.fromObject({options:(e=Bn(c))!==null&&e!==void 0?e:[]}),value:i,viewProps:n.viewProps});const _=(t="format"in n.params?n.params.format:void 0)!==null&&t!==void 0?t:ie(an(c,i.rawValue));if(c&&J(c,Ve)){const[y,S]=Ea(c);return new on(n.document,{baseStep:Ct(c),parser:Ue,sliderProps:B.fromObject({maxValue:S,minValue:y}),textProps:B.fromObject({draggingScale:Pt(c,i.rawValue),formatter:_}),value:i,viewProps:n.viewProps})}return new Ge(n.document,{baseStep:Ct(c),parser:Ue,props:B.fromObject({draggingScale:Pt(c,i.rawValue),formatter:_}),value:i,viewProps:n.viewProps})}};class kt{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(g(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const kr={toComponents:n=>n.getComponents(),fromComponents:n=>new kt(...n)},pn=D("p2d");class Ma{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(pn()),t.viewProps.bindClassModifiers(this.element),ne(t.expanded,ee(this.element,pn(void 0,"expanded")));const i=e.createElement("div");i.classList.add(pn("h")),this.element.appendChild(i);const c=e.createElement("button");c.classList.add(pn("b")),c.appendChild(qe(e,"p2dpad")),t.viewProps.bindDisabled(c),i.appendChild(c),this.buttonElement=c;const _=e.createElement("div");if(_.classList.add(pn("t")),i.appendChild(_),this.textElement=_,t.pickerLayout==="inline"){const y=e.createElement("div");y.classList.add(pn("p")),this.element.appendChild(y),this.pickerElement=y}else this.pickerElement=null}}const Mt=D("p2dp");class La{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=t.invertsY,this.maxValue_=t.maxValue,this.element=e.createElement("div"),this.element.classList.add(Mt()),t.layout==="popup"&&this.element.classList.add(Mt(void 0,"p"));const i=e.createElement("div");i.classList.add(Mt("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const c=e.createElementNS(Ee,"svg");c.classList.add(Mt("g")),this.padElement.appendChild(c),this.svgElem_=c;const _=e.createElementNS(Ee,"line");_.classList.add(Mt("ax")),_.setAttributeNS(null,"x1","0"),_.setAttributeNS(null,"y1","50%"),_.setAttributeNS(null,"x2","100%"),_.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(_);const y=e.createElementNS(Ee,"line");y.classList.add(Mt("ax")),y.setAttributeNS(null,"x1","50%"),y.setAttributeNS(null,"y1","0"),y.setAttributeNS(null,"x2","50%"),y.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(y);const S=e.createElementNS(Ee,"line");S.classList.add(Mt("l")),S.setAttributeNS(null,"x1","50%"),S.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(S),this.lineElem_=S;const j=e.createElement("div");j.classList.add(Mt("m")),this.padElement.appendChild(j),this.markerElem_=j,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.maxValue_,c=te(e,-i,+i,0,100),_=te(t,-i,+i,0,100),y=this.invertsY_?100-_:_;this.lineElem_.setAttributeNS(null,"x2",`${c}%`),this.lineElem_.setAttributeNS(null,"y2",`${y}%`),this.markerElem_.style.left=`${c}%`,this.markerElem_.style.top=`${y}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Mr(n,e,t){return[ve(e[0],Ke(n)),ve(e[1],De(n))*(t?1:-1)]}class Sa{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.baseSteps_=t.baseSteps,this.maxValue_=t.maxValue,this.invertsY_=t.invertsY,this.view=new La(e,{invertsY:this.invertsY_,layout:t.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new rt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.maxValue_,c=te(e.point.x,0,e.bounds.width,-i,+i),_=te(this.invertsY_?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new kt(c,_),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){vs(e.key)&&e.preventDefault();const[t,i]=Mr(e,this.baseSteps_,this.invertsY_);t===0&&i===0||this.value.setRawValue(new kt(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=Mr(e,this.baseSteps_,this.invertsY_);t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Aa{constructor(e,t){var i,c;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=je.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new An(e,{viewProps:this.viewProps}):null;const _=new Sa(e,{baseSteps:[t.axes[0].baseStep,t.axes[1].baseStep],invertsY:t.invertsY,layout:t.pickerLayout,maxValue:t.maxValue,value:this.value,viewProps:this.viewProps});_.view.allFocusableElements.forEach(y=>{y.addEventListener("blur",this.onPopupChildBlur_),y.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=_,this.textC_=new Ri(e,{assembly:kr,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new Ma(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(c=this.view.buttonElement)===null||c===void 0||c.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),wt({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:y=>y.rawValue,backward:(y,S)=>S.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),U(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=Oe(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!dt(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}}function Ta(n){return kt.isObject(n)?new kt(n.x,n.y):new kt}function Va(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function lt(n,e){if(!n)return;const t=[],i=Pr(n,e);i&&t.push(i);const c=Er(n);return c&&t.push(c),new Ze(t)}function Na(n,e){return new Et({assembly:kr,components:[lt("x"in n?n.x:void 0,e.x),lt("y"in n?n.y:void 0,e.y)]})}function Lr(n,e){var t,i;const c=n&&J(n,Ve);if(c)return Math.max(Math.abs((t=c.minValue)!==null&&t!==void 0?t:0),Math.abs((i=c.maxValue)!==null&&i!==void 0?i:0));const _=Ct(n);return Math.max(Math.abs(_)*10,Math.abs(e)*10)}function Oa(n,e){const t=e instanceof Et?e.components[0]:void 0,i=e instanceof Et?e.components[1]:void 0,c=Lr(t,n.x),_=Lr(i,n.y);return Math.max(c,_)}function Sr(n,e){return{baseStep:Ct(e),constraint:e,textProps:B.fromObject({draggingScale:Pt(e,n),formatter:ie(an(e,n))})}}function Ia(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}const Da={id:"input-point2d",type:"input",accept:(n,e)=>{if(!kt.isObject(n))return null;const t=$,i=oe(e,{expanded:t.optional.boolean,picker:t.optional.custom(gs),x:t.optional.custom(be),y:t.optional.object({inverted:t.optional.boolean,max:t.optional.number,min:t.optional.number,step:t.optional.number})});return i?{initialValue:n,params:i}:null},binding:{reader:n=>Ta,constraint:n=>Na(n.params,n.initialValue),equals:kt.equals,writer:n=>Va},controller:n=>{const e=n.document,t=n.value,i=n.constraint;if(!(i instanceof Et))throw A.shouldNeverHappen();const c="expanded"in n.params?n.params.expanded:void 0,_="picker"in n.params?n.params.picker:void 0;return new Aa(e,{axes:[Sr(t.rawValue.x,i.components[0]),Sr(t.rawValue.y,i.components[1])],expanded:c!=null?c:!1,invertsY:Ia(n.params),maxValue:Oa(t.rawValue,i),parser:Ue,pickerLayout:_!=null?_:"popup",value:t,viewProps:n.viewProps})}};class un{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(g(e))return!1;const t=e.x,i=e.y,c=e.z;return!(typeof t!="number"||typeof i!="number"||typeof c!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Ar={toComponents:n=>n.getComponents(),fromComponents:n=>new un(...n)};function Ra(n){return un.isObject(n)?new un(n.x,n.y,n.z):new un}function Fa(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function ja(n,e){return new Et({assembly:Ar,components:[lt("x"in n?n.x:void 0,e.x),lt("y"in n?n.y:void 0,e.y),lt("z"in n?n.z:void 0,e.z)]})}function Fi(n,e){return{baseStep:Ct(e),constraint:e,textProps:B.fromObject({draggingScale:Pt(e,n),formatter:ie(an(e,n))})}}const Ba={id:"input-point3d",type:"input",accept:(n,e)=>{if(!un.isObject(n))return null;const t=$,i=oe(e,{x:t.optional.custom(be),y:t.optional.custom(be),z:t.optional.custom(be)});return i?{initialValue:n,params:i}:null},binding:{reader:n=>Ra,constraint:n=>ja(n.params,n.initialValue),equals:un.equals,writer:n=>Fa},controller:n=>{const e=n.value,t=n.constraint;if(!(t instanceof Et))throw A.shouldNeverHappen();return new Ri(n.document,{assembly:Ar,axes:[Fi(e.rawValue.x,t.components[0]),Fi(e.rawValue.y,t.components[1]),Fi(e.rawValue.z,t.components[2])],parser:Ue,value:e,viewProps:n.viewProps})}};class dn{constructor(e=0,t=0,i=0,c=0){this.x=e,this.y=t,this.z=i,this.w=c}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(g(e))return!1;const t=e.x,i=e.y,c=e.z,_=e.w;return!(typeof t!="number"||typeof i!="number"||typeof c!="number"||typeof _!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Tr={toComponents:n=>n.getComponents(),fromComponents:n=>new dn(...n)};function Ua(n){return dn.isObject(n)?new dn(n.x,n.y,n.z,n.w):new dn}function za(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function Ka(n,e){return new Et({assembly:Tr,components:[lt("x"in n?n.x:void 0,e.x),lt("y"in n?n.y:void 0,e.y),lt("z"in n?n.z:void 0,e.z),lt("w"in n?n.w:void 0,e.w)]})}function Ga(n,e){return{baseStep:Ct(e),constraint:e,textProps:B.fromObject({draggingScale:Pt(e,n),formatter:ie(an(e,n))})}}const $a={id:"input-point4d",type:"input",accept:(n,e)=>{if(!dn.isObject(n))return null;const t=$,i=oe(e,{x:t.optional.custom(be),y:t.optional.custom(be),z:t.optional.custom(be),w:t.optional.custom(be)});return i?{initialValue:n,params:i}:null},binding:{reader:n=>Ua,constraint:n=>Ka(n.params,n.initialValue),equals:dn.equals,writer:n=>za},controller:n=>{const e=n.value,t=n.constraint;if(!(t instanceof Et))throw A.shouldNeverHappen();return new Ri(n.document,{assembly:Tr,axes:e.rawValue.getComponents().map((i,c)=>Ga(i,t.components[c])),parser:Ue,value:e,viewProps:n.viewProps})}};function qa(n){const e=[],t=jn(n.options);return t&&e.push(t),new Ze(e)}const Ha={id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const i=oe(e,{options:$.optional.custom(yt)});return i?{initialValue:n,params:i}:null},binding:{reader:n=>hs,constraint:n=>qa(n.params),writer:n=>xt},controller:n=>{var e;const t=n.document,i=n.value,c=n.constraint;return c&&J(c,_t)?new it(t,{props:B.fromObject({options:(e=Bn(c))!==null&&e!==void 0?e:[]}),value:i,viewProps:n.viewProps}):new zt(t,{parser:_=>_,props:B.fromObject({formatter:rn}),value:i,viewProps:n.viewProps})}},qn={monitor:{defaultInterval:200,defaultLineCount:3}},Vr=D("mll");class Ya{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Vr()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(Vr("i")),i.style.height=`calc(var(--bld-us) * ${t.lineCount})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(c=>{c!==void 0&&i.push(this.formatter_(c))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class ji{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Ya(e,{formatter:t.formatter,lineCount:t.lineCount,value:this.value,viewProps:this.viewProps})}}const Nr=D("sgl");class Xa{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Nr()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Nr("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class Bi{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Xa(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}const Wa={id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const i=oe(e,{lineCount:$.optional.number});return i?{initialValue:n,params:i}:null},binding:{reader:n=>as},controller:n=>{var e;return n.value.rawValue.length===1?new Bi(n.document,{formatter:ls,value:n.value,viewProps:n.viewProps}):new ji(n.document,{formatter:ls,lineCount:(e=n.params.lineCount)!==null&&e!==void 0?e:qn.monitor.defaultLineCount,value:n.value,viewProps:n.viewProps})}},Lt=D("grl");class Za{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Lt()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(Ee,"svg");i.classList.add(Lt("g")),i.style.height=`calc(var(--bld-us) * ${t.lineCount})`,this.element.appendChild(i),this.svgElem_=i;const c=e.createElementNS(Ee,"polyline");this.svgElem_.appendChild(c),this.lineElem_=c;const _=e.createElement("div");_.classList.add(Lt("t"),D("tt")()),this.element.appendChild(_),this.tooltipElem_=_,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,i=this.props_.get("minValue"),c=this.props_.get("maxValue"),_=[];this.value.rawValue.forEach((Z,Q)=>{if(Z===void 0)return;const ct=te(Q,0,t,0,e.width),Hn=te(Z,i,c,e.height,0);_.push([ct,Hn].join(","))}),this.lineElem_.setAttributeNS(null,"points",_.join(" "));const y=this.tooltipElem_,S=this.value.rawValue[this.cursor_.rawValue];if(S===void 0){y.classList.remove(Lt("t","a"));return}const j=te(this.cursor_.rawValue,0,t,0,e.width),z=te(S,i,c,e.height,0);y.style.left=`${j}px`,y.style.top=`${z}px`,y.textContent=`${this.formatter_(S)}`,y.classList.contains(Lt("t","a"))||(y.classList.add(Lt("t","a"),Lt("t","in")),et(y),y.classList.remove(Lt("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Qa{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=W(-1),this.view=new Za(e,{cursor:this.cursor_,formatter:t.formatter,lineCount:t.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),!dt(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new rt(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(te(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(te(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Ui(n){return"format"in n&&!g(n.format)?n.format:ie(2)}function Ja(n){var e;return n.value.rawValue.length===1?new Bi(n.document,{formatter:Ui(n.params),value:n.value,viewProps:n.viewProps}):new ji(n.document,{formatter:Ui(n.params),lineCount:(e=n.params.lineCount)!==null&&e!==void 0?e:qn.monitor.defaultLineCount,value:n.value,viewProps:n.viewProps})}function el(n){var e,t,i;return new Qa(n.document,{formatter:Ui(n.params),lineCount:(e=n.params.lineCount)!==null&&e!==void 0?e:qn.monitor.defaultLineCount,props:B.fromObject({maxValue:(t="max"in n.params?n.params.max:null)!==null&&t!==void 0?t:100,minValue:(i="min"in n.params?n.params.min:null)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function Or(n){return"view"in n&&n.view==="graph"}const tl={id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=$,i=oe(e,{format:t.optional.function,lineCount:t.optional.number,max:t.optional.number,min:t.optional.number,view:t.optional.string});return i?{initialValue:n,params:i}:null},binding:{defaultBufferSize:n=>Or(n)?64:1,reader:n=>On},controller:n=>Or(n.params)?el(n):Ja(n)},nl={id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=$,i=oe(e,{lineCount:t.optional.number,multiline:t.optional.boolean});return i?{initialValue:n,params:i}:null},binding:{reader:n=>hs},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||"multiline"in n.params&&n.params.multiline?new ji(n.document,{formatter:rn,lineCount:(e=n.params.lineCount)!==null&&e!==void 0?e:qn.monitor.defaultLineCount,value:t,viewProps:n.viewProps}):new Bi(n.document,{formatter:rn,value:t,viewProps:n.viewProps})}};class sl{constructor(e){this.onValueChange_=this.onValueChange_.bind(this),this.reader=e.reader,this.writer=e.writer,this.emitter=new O,this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.target=e.target,this.read()}read(){const e=this.target.read();e!==void 0&&(this.value.rawValue=this.reader(e))}write_(e){this.writer(this.target,e)}onValueChange_(e){this.write_(e.rawValue),this.emitter.emit("change",{options:e.options,rawValue:e.rawValue,sender:this})}}function il(n,e){const t=n.accept(e.target.read(),e.params);if(g(t))return null;const i=$,c={target:e.target,initialValue:t.initialValue,params:t.params},_=n.binding.reader(c),y=n.binding.constraint?n.binding.constraint(c):void 0,S=W(_(t.initialValue),{constraint:y,equals:n.binding.equals}),j=new sl({reader:_,target:e.target,value:S,writer:n.binding.writer(c)}),z=i.optional.boolean(e.params.disabled).value,Z=i.optional.boolean(e.params.hidden).value,Q=n.controller({constraint:y,document:e.document,initialValue:t.initialValue,params:t.params,value:j.value,viewProps:We.create({disabled:z,hidden:Z})}),ct=i.optional.string(e.params.label).value;return new Le(e.document,{binding:j,blade:Fe(),props:B.fromObject({label:ct!=null?ct:e.target.key}),valueController:Q})}class rl{constructor(e){this.onTick_=this.onTick_.bind(this),this.reader_=e.reader,this.target=e.target,this.emitter=new O,this.value=e.value,this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const e=this.target.read();if(e===void 0)return;const t=this.value.rawValue,i=this.reader_(e);this.value.rawValue=ms(t,i),this.emitter.emit("update",{rawValue:i,sender:this})}onTick_(e){this.read()}}function ol(n,e){return e===0?new is:new Ln(n,e!=null?e:qn.monitor.defaultInterval)}function al(n,e){var t,i,c;const _=$,y=n.accept(e.target.read(),e.params);if(g(y))return null;const S={target:e.target,initialValue:y.initialValue,params:y.params},j=n.binding.reader(S),z=(i=(t=_.optional.number(e.params.bufferSize).value)!==null&&t!==void 0?t:n.binding.defaultBufferSize&&n.binding.defaultBufferSize(y.params))!==null&&i!==void 0?i:1,Z=_.optional.number(e.params.interval).value,Q=new rl({reader:j,target:e.target,ticker:ol(e.document,Z),value:vi(z)}),ct=_.optional.boolean(e.params.disabled).value,Hn=_.optional.boolean(e.params.hidden).value,Yn=n.controller({document:e.document,params:y.params,value:Q.value,viewProps:We.create({disabled:ct,hidden:Hn})}),hn=(c=_.optional.string(e.params.label).value)!==null&&c!==void 0?c:e.target.key;return new Xe(e.document,{binding:Q,blade:Fe(),props:B.fromObject({label:hn}),valueController:Yn})}class ll{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e){e.type==="blade"?this.pluginsMap_.blades.unshift(e):e.type==="input"?this.pluginsMap_.inputs.unshift(e):e.type==="monitor"&&this.pluginsMap_.monitors.unshift(e)}createInput(e,t,i){const c=t.read();if(g(c))throw new A({context:{key:t.key},type:"nomatchingcontroller"});const _=this.pluginsMap_.inputs.reduce((y,S)=>y!=null?y:il(S,{document:e,target:t,params:i}),null);if(_)return _;throw new A({context:{key:t.key},type:"nomatchingcontroller"})}createMonitor(e,t,i){const c=this.pluginsMap_.monitors.reduce((_,y)=>_!=null?_:al(y,{document:e,params:i,target:t}),null);if(c)return c;throw new A({context:{key:t.key},type:"nomatchingcontroller"})}createBlade(e,t){const i=this.pluginsMap_.blades.reduce((c,_)=>c!=null?c:Ks(_,{document:e,params:t}),null);if(!i)throw new A({type:"nomatchingview",context:{params:t}});return i}createBladeApi(e){if(e instanceof Le)return new xe(e);if(e instanceof Xe)return new st(e);if(e instanceof Ft)return new Rt(e,this);const t=this.pluginsMap_.blades.reduce((i,c)=>i!=null?i:c.api({controller:e,pool:this}),null);if(!t)throw A.shouldNeverHappen();return t}}function cl(){const n=new ll;return[Da,Ba,$a,Ha,ka,wa,ga,va,yi,Wa,nl,tl,mt,Fs,es,Mn].forEach(e=>{n.register(e)}),n}class Ir extends d{constructor(e){super(e),this.emitter_=new O,this.controller_.valueController.value.emitter.on("change",t=>{this.emitter_.emit("change",{event:new h(this,t.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get options(){return this.controller_.valueController.props.get("options")}set options(e){this.controller_.valueController.props.set("options",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,c=>{i(c.event)}),this}}class Dr extends d{constructor(e){super(e),this.emitter_=new O,this.controller_.valueController.value.emitter.on("change",t=>{this.emitter_.emit("change",{event:new h(this,t.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(e){this.controller_.valueController.sliderController.props.set("maxValue",e)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(e){this.controller_.valueController.sliderController.props.set("minValue",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,c=>{i(c.event)}),this}}class Rr extends d{constructor(e){super(e),this.emitter_=new O,this.controller_.valueController.value.emitter.on("change",t=>{this.emitter_.emit("change",{event:new h(this,t.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(e){this.controller_.valueController.props.set("formatter",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,c=>{i(c.event)}),this}}const pl=function(){return{id:"list",type:"blade",accept(n){const e=$,t=oe(n,{options:e.required.custom(yt),value:e.required.raw,view:e.required.constant("list"),label:e.optional.string});return t?{params:t}:null},controller(n){const e=new it(n.document,{props:B.fromObject({options:ws(n.params.options)}),value:W(n.params.value),viewProps:n.viewProps});return new ft(n.document,{blade:n.blade,props:B.fromObject({label:n.params.label}),valueController:e})},api(n){return!(n.controller instanceof ft)||!(n.controller.valueController instanceof it)?null:new Ir(n.controller)}}}();function ul(n){return n.reduce((e,t)=>Object.assign(e,{[t.presetKey]:t.read()}),{})}function dl(n,e){n.forEach(t=>{const i=e[t.presetKey];i!==void 0&&t.write(i)})}class hl extends xn{constructor(e,t){super(e,t)}get element(){return this.controller_.view.element}importPreset(e){const t=this.controller_.rackController.rack.find(Le).map(i=>i.binding.target);dl(t,e),this.refresh()}exportPreset(){const e=this.controller_.rackController.rack.find(Le).map(t=>t.binding.target);return ul(e)}refresh(){this.controller_.rackController.rack.find(Le).forEach(e=>{e.binding.read()}),this.controller_.rackController.rack.find(Xe).forEach(e=>{e.binding.read()})}}class ml extends Pn{constructor(e,t){super(e,{expanded:t.expanded,blade:t.blade,props:t.props,root:!0,viewProps:t.viewProps})}}const vl={id:"slider",type:"blade",accept(n){const e=$,t=oe(n,{max:e.required.number,min:e.required.number,view:e.required.constant("slider"),format:e.optional.function,label:e.optional.string,value:e.optional.number});return t?{params:t}:null},controller(n){var e,t;const i=(e=n.params.value)!==null&&e!==void 0?e:0,c=new on(n.document,{baseStep:1,parser:Ue,sliderProps:B.fromObject({maxValue:n.params.max,minValue:n.params.min}),textProps:B.fromObject({draggingScale:Pt(void 0,i),formatter:(t=n.params.format)!==null&&t!==void 0?t:hi}),value:W(i),viewProps:n.viewProps});return new ft(n.document,{blade:n.blade,props:B.fromObject({label:n.params.label}),valueController:c})},api(n){return!(n.controller instanceof ft)||!(n.controller.valueController instanceof on)?null:new Dr(n.controller)}},fl=function(){return{id:"text",type:"blade",accept(n){const e=$,t=oe(n,{parse:e.required.function,value:e.required.raw,view:e.required.constant("text"),format:e.optional.function,label:e.optional.string});return t?{params:t}:null},controller(n){var e;const t=new zt(n.document,{parser:n.params.parse,props:B.fromObject({formatter:(e=n.params.format)!==null&&e!==void 0?e:i=>String(i)}),value:W(n.params.value),viewProps:n.viewProps});return new ft(n.document,{blade:n.blade,props:B.fromObject({label:n.params.label}),valueController:t})},api(n){return!(n.controller instanceof ft)||!(n.controller.valueController instanceof zt)?null:new Rr(n.controller)}}}();function bl(n){const e=n.createElement("div");return e.classList.add(D("dfw")()),n.body&&n.body.appendChild(e),e}function Fr(n,e,t){if(n.querySelector(`style[data-tp-style=${e}]`))return;const i=n.createElement("style");i.dataset.tpStyle=e,i.textContent=t,n.head.appendChild(i)}class _l extends hl{constructor(e){var t,i;const c=e!=null?e:{},_=(t=c.document)!==null&&t!==void 0?t:_n(),y=cl(),S=new ml(_,{expanded:c.expanded,blade:Fe(),props:B.fromObject({title:c.title}),viewProps:We.create()});super(S,y),this.pool_=y,this.containerElem_=(i=c.container)!==null&&i!==void 0?i:bl(_),this.containerElem_.appendChild(this.element),this.doc_=_,this.usesDefaultWrapper_=!c.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw A.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw A.alreadyDisposed();if(this.usesDefaultWrapper_){const t=e.parentElement;t&&t.removeChild(e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(e){("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach(i=>{this.pool_.register(i),this.embedPluginStyle_(i)})}embedPluginStyle_(e){e.css&&Fr(this.document,`plugin-${e.id}`,e.css)}setUpDefaultPlugins_(){Fr(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(e=>{this.embedPluginStyle_(e)}),this.registerPlugin({plugins:[vl,pl,Mn,fl]})}}const gl=new a("3.1.0");p.BladeApi=d,p.ButtonApi=I,p.FolderApi=xn,p.InputBindingApi=xe,p.ListApi=Ir,p.MonitorBindingApi=st,p.Pane=_l,p.SeparatorApi=En,p.SliderApi=Dr,p.TabApi=ns,p.TabPageApi=kn,p.TextApi=Rr,p.TpChangeEvent=h,p.VERSION=gl,Object.defineProperty(p,"__esModule",{value:!0})})})(Ss,Ss.exports);var Xn={exports:{}};(function(L,u){(function(p,a){a(u)})(Ji,function(p){class a{constructor(s){this.controller_=s}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(s){this.controller_.viewProps.set("disabled",s)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(s){this.controller_.viewProps.set("hidden",s)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class d{constructor(s){this.target=s}}class m extends d{constructor(s,r,l,v){super(s),this.value=r,this.presetKey=l,this.last=v!=null?v:!0}}function h(o){return o}function b(o){return o==null}const f={alreadydisposed:()=>"View has been already disposed",invalidparams:o=>`Invalid parameters for '${o.name}'`,nomatchingcontroller:o=>`No matching controller for '${o.key}'`,nomatchingview:o=>`No matching view for '${JSON.stringify(o.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:o=>`Property '${o.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class x{constructor(s){var r;this.message=(r=f[s.type](s.context))!==null&&r!==void 0?r:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=s.type}static alreadyDisposed(){return new x({type:"alreadydisposed"})}static notBindable(){return new x({type:"notbindable"})}static propertyNotFound(s){return new x({type:"propertynotfound",context:{name:s}})}static shouldNeverHappen(){return new x({type:"shouldneverhappen"})}}class E{constructor(){this.observers_={}}on(s,r){let l=this.observers_[s];return l||(l=this.observers_[s]=[]),l.push({handler:r}),this}off(s,r){const l=this.observers_[s];return l&&(this.observers_[s]=l.filter(v=>v.handler!==r)),this}emit(s,r){const l=this.observers_[s];!l||l.forEach(v=>{v.handler(r)})}}const g="tp";function M(o){return(r,l)=>[g,"-",o,"v",r?`_${r}`:"",l?`-${l}`:""].join("")}function N(o,s){return r=>s(o(r))}function A(o){return o.rawValue}function F(o,s){o.emitter.on("change",N(A,s)),s(o.rawValue)}function I(o,s,r){F(o.value(s),r)}function O(o,s,r){r?o.classList.add(s):o.classList.remove(s)}function Y(o,s){return r=>{O(o,s,r)}}function D(o,s){F(o,r=>{s.textContent=r!=null?r:""})}const re=M("btn");class de{constructor(s,r){this.element=s.createElement("div"),this.element.classList.add(re()),r.viewProps.bindClassModifiers(this.element);const l=s.createElement("button");l.classList.add(re("b")),r.viewProps.bindDisabled(l),this.element.appendChild(l),this.buttonElement=l;const v=s.createElement("div");v.classList.add(re("t")),D(r.props.value("title"),v),this.buttonElement.appendChild(v)}}class ne{constructor(s,r){this.emitter=new E,this.onClick_=this.onClick_.bind(this),this.props=r.props,this.viewProps=r.viewProps,this.view=new de(s,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class X{constructor(s,r){var l;this.constraint_=r==null?void 0:r.constraint,this.equals_=(l=r==null?void 0:r.equals)!==null&&l!==void 0?l:(v,w)=>v===w,this.emitter=new E,this.rawValue_=s}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(s){this.setRawValue(s,{forceEmit:!1,last:!0})}setRawValue(s,r){const l=r!=null?r:{forceEmit:!1,last:!0},v=this.constraint_?this.constraint_.constrain(s):s;!!this.equals_(this.rawValue_,v)&&!l.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=v,this.emitter.emit("change",{options:l,rawValue:v,sender:this}))}}class G{constructor(s){this.emitter=new E,this.value_=s}get rawValue(){return this.value_}set rawValue(s){this.setRawValue(s,{forceEmit:!1,last:!0})}setRawValue(s,r){const l=r!=null?r:{forceEmit:!1,last:!0};this.value_===s&&!l.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=s,this.emitter.emit("change",{options:l,rawValue:this.value_,sender:this}))}}function ee(o,s){const r=s==null?void 0:s.constraint,l=s==null?void 0:s.equals;return!r&&!l?new G(o):new X(o,s)}class se{constructor(s){this.emitter=new E,this.valMap_=s;for(const r in this.valMap_)this.valMap_[r].emitter.on("change",()=>{this.emitter.emit("change",{key:r,sender:this})})}static createCore(s){return Object.keys(s).reduce((l,v)=>Object.assign(l,{[v]:ee(s[v])}),{})}static fromObject(s){const r=this.createCore(s);return new se(r)}get(s){return this.valMap_[s].rawValue}set(s,r){this.valMap_[s].rawValue=r}value(s){return this.valMap_[s]}}function _e(o,s){const l=Object.keys(s).reduce((v,w)=>{if(v===void 0)return;const k=s[w],V=k(o[w]);return V.succeeded?Object.assign(Object.assign({},v),{[w]:V.value}):void 0},{});return l}function Ce(o,s){return o.reduce((r,l)=>{if(r===void 0)return;const v=s(l);if(!(!v.succeeded||v.value===void 0))return[...r,v.value]},[])}function he(o){return o===null?!1:typeof o=="object"}function ue(o){return s=>r=>{if(!s&&r===void 0)return{succeeded:!1,value:void 0};if(s&&r===void 0)return{succeeded:!0,value:void 0};const l=o(r);return l!==void 0?{succeeded:!0,value:l}:{succeeded:!1,value:void 0}}}function fe(o){return{custom:s=>ue(s)(o),boolean:ue(s=>typeof s=="boolean"?s:void 0)(o),number:ue(s=>typeof s=="number"?s:void 0)(o),string:ue(s=>typeof s=="string"?s:void 0)(o),function:ue(s=>typeof s=="function"?s:void 0)(o),constant:s=>ue(r=>r===s?s:void 0)(o),raw:ue(s=>s)(o),object:s=>ue(r=>{if(!!he(r))return _e(r,s)})(o),array:s=>ue(r=>{if(!!Array.isArray(r))return Ce(r,s)})(o)}}const W={optional:fe(!0),required:fe(!1)};function B(o,s){const r=W.required.object(s)(o);return r.succeeded?r.value:void 0}function ut(o){return o&&o.parentElement&&o.parentElement.removeChild(o),null}function Yt(){return["veryfirst","first","last","verylast"]}const Xt=M(""),ge={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class At{constructor(s){this.parent_=null,this.blade=s.blade,this.view=s.view,this.viewProps=s.viewProps;const r=this.view.element;this.blade.value("positions").emitter.on("change",()=>{Yt().forEach(l=>{r.classList.remove(Xt(void 0,ge[l]))}),this.blade.get("positions").forEach(l=>{r.classList.add(Xt(void 0,ge[l]))})}),this.viewProps.handleDispose(()=>{ut(r)})}get parent(){return this.parent_}}const $="http://www.w3.org/2000/svg";function oe(o){o.offsetHeight}function bn(o,s){const r=o.style.transition;o.style.transition="none",s(),o.style.transition=r}function Wt(o){return o.ontouchstart!==void 0}function Tt(o){for(;o.childNodes.length>0;)o.removeChild(o.childNodes[0])}function Vt(o){return o.relatedTarget?o.relatedTarget:"explicitOriginalTarget"in o?o.explicitOriginalTarget:null}const Pe=M("lbl");function Ee(o,s){const r=o.createDocumentFragment();return s.split(`
`).map(v=>o.createTextNode(v)).forEach((v,w)=>{w>0&&r.appendChild(o.createElement("br")),r.appendChild(v)}),r}class et{constructor(s,r){this.element=s.createElement("div"),this.element.classList.add(Pe()),r.viewProps.bindClassModifiers(this.element);const l=s.createElement("div");l.classList.add(Pe("l")),I(r.props,"label",w=>{b(w)?this.element.classList.add(Pe(void 0,"nol")):(this.element.classList.remove(Pe(void 0,"nol")),Tt(l),l.appendChild(Ee(s,w)))}),this.element.appendChild(l),this.labelElement=l;const v=s.createElement("div");v.classList.add(Pe("v")),this.element.appendChild(v),this.valueElement=v}}class tt extends At{constructor(s,r){const l=r.valueController.viewProps;super(Object.assign(Object.assign({},r),{view:new et(s,{props:r.props,viewProps:l}),viewProps:l})),this.props=r.props,this.valueController=r.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class dt extends At{constructor(s){super(s),this.value=s.value}}class ht extends se{constructor(s){super(s)}static create(s){const r={completed:!0,expanded:s,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},l=se.createCore(r);return new ht(l)}get styleExpanded(){var s;return(s=this.get("temporaryExpanded"))!==null&&s!==void 0?s:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const s=this.get("expandedHeight");return this.get("shouldFixHeight")&&!b(s)?`${s}px`:"auto"}bindExpandedClass(s,r){const l=()=>{this.styleExpanded?s.classList.add(r):s.classList.remove(r)};I(this,"expanded",l),I(this,"temporaryExpanded",l)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function _n(o){return ht.create(o)}function gn(o,s){let r=0;return bn(s,()=>{o.set("expandedHeight",null),o.set("temporaryExpanded",!0),oe(s),r=s.clientHeight,o.set("temporaryExpanded",null),oe(s)}),r}function Nt(o,s){s.style.height=o.styleHeight}function qe(o,s){o.value("expanded").emitter.on("beforechange",()=>{o.set("completed",!1),b(o.get("expandedHeight"))&&o.set("expandedHeight",gn(o,s)),o.set("shouldFixHeight",!0),oe(s)}),o.emitter.on("change",()=>{Nt(o,s)}),Nt(o,s),s.addEventListener("transitionend",r=>{r.propertyName==="height"&&o.cleanUpTransition()})}class nt{constructor(s,r){const l=M(r.viewName);this.element=s.createElement("div"),this.element.classList.add(l()),r.viewProps.bindClassModifiers(this.element)}}class He extends dt{constructor(s,r){const l=r.valueController.viewProps;super(Object.assign(Object.assign({},r),{value:r.valueController.value,view:new et(s,{props:r.props,viewProps:l}),viewProps:l})),this.props=r.props,this.valueController=r.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const Zt=M("");function Qt(o,s){return Y(o,Zt(void 0,s))}class Oe extends se{constructor(s){super(s)}static create(s){var r,l;const v=s!=null?s:{},w={disabled:(r=v.disabled)!==null&&r!==void 0?r:!1,disposed:!1,hidden:(l=v.hidden)!==null&&l!==void 0?l:!1},k=se.createCore(w);return new Oe(k)}bindClassModifiers(s){I(this,"disabled",Qt(s,"disabled")),I(this,"hidden",Qt(s,"hidden"))}bindDisabled(s){I(this,"disabled",r=>{s.disabled=r})}bindTabIndex(s){I(this,"disabled",r=>{s.tabIndex=r?-1:0})}handleDispose(s){this.value("disposed").emitter.on("change",r=>{r&&s()})}}class Ye{constructor(){this.disabled=!1,this.emitter=new E}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class wn{constructor(s,r){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=s,this.emitter=new E,this.interval_=r,this.setTimer_()}get disabled(){return this.disabled_}set disabled(s){this.disabled_=s,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const s=this.doc_.defaultView;s&&s.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const s=this.doc_.defaultView;s&&(this.timerId_=s.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Ot{constructor(s){this.constraints=s}constrain(s){return this.constraints.reduce((r,l)=>l.constrain(r),s)}}function Ie(o,s){if(o instanceof s)return o;if(o instanceof Ot){const r=o.constraints.reduce((l,v)=>l||(v instanceof s?v:null),null);if(r)return r}return null}class mt{constructor(s){this.maxValue=s.max,this.minValue=s.min}constrain(s){let r=s;return b(this.minValue)||(r=Math.max(r,this.minValue)),b(this.maxValue)||(r=Math.min(r,this.maxValue)),r}}class ke{constructor(s,r=0){this.step=s,this.origin=r}constrain(s){const r=this.origin%this.step,l=Math.round((s-r)/this.step);return r+l*this.step}}const Fe=M("pop");class je{constructor(s,r){this.element=s.createElement("div"),this.element.classList.add(Fe()),r.viewProps.bindClassModifiers(this.element),F(r.shows,Y(this.element,Fe(void 0,"v")))}}class P{constructor(s,r){this.shows=ee(!1),this.viewProps=r.viewProps,this.view=new je(s,{shows:this.shows,viewProps:this.viewProps})}}const T=M("txt");class U{constructor(s,r){this.onChange_=this.onChange_.bind(this),this.element=s.createElement("div"),this.element.classList.add(T()),r.viewProps.bindClassModifiers(this.element),this.props_=r.props,this.props_.emitter.on("change",this.onChange_);const l=s.createElement("input");l.classList.add(T("i")),l.type="text",r.viewProps.bindDisabled(l),this.element.appendChild(l),this.inputElement=l,r.value.emitter.on("change",this.onChange_),this.value_=r.value,this.refresh()}refresh(){const s=this.props_.get("formatter");this.inputElement.value=s(this.value_.rawValue)}onChange_(){this.refresh()}}class H{constructor(s,r){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=r.parser,this.props=r.props,this.value=r.value,this.viewProps=r.viewProps,this.view=new U(s,{props:r.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(s){const l=s.currentTarget.value,v=this.parser_(l);b(v)||(this.value.rawValue=v),this.view.refresh()}}function ae(o){return o==="false"?!1:!!o}class Me{constructor(s){this.text=s}evaluate(){return Number(this.text)}toString(){return this.text}}const vt={"**":(o,s)=>Math.pow(o,s),"*":(o,s)=>o*s,"/":(o,s)=>o/s,"%":(o,s)=>o%s,"+":(o,s)=>o+s,"-":(o,s)=>o-s,"<<":(o,s)=>o<<s,">>":(o,s)=>o>>s,">>>":(o,s)=>o>>>s,"&":(o,s)=>o&s,"^":(o,s)=>o^s,"|":(o,s)=>o|s};class Jt{constructor(s,r,l){this.left=r,this.operator=s,this.right=l}evaluate(){const s=vt[this.operator];if(!s)throw new Error(`unexpected binary operator: '${this.operator}`);return s(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const we={"+":o=>o,"-":o=>-o,"~":o=>~o};class xe{constructor(s,r){this.operator=s,this.expression=r}evaluate(){const s=we[this.operator];if(!s)throw new Error(`unexpected unary operator: '${this.operator}`);return s(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Le(o){return(s,r)=>{for(let l=0;l<o.length;l++){const v=o[l](s,r);if(v!=="")return v}return""}}function st(o,s){var r;const l=o.substr(s).match(/^\s+/);return(r=l&&l[0])!==null&&r!==void 0?r:""}function Xe(o,s){const r=o.substr(s,1);return r.match(/^[1-9]$/)?r:""}function It(o,s){var r;const l=o.substr(s).match(/^[0-9]+/);return(r=l&&l[0])!==null&&r!==void 0?r:""}function Dt(o,s){const r=It(o,s);if(r!=="")return r;const l=o.substr(s,1);if(s+=1,l!=="-"&&l!=="+")return"";const v=It(o,s);return v===""?"":l+v}function en(o,s){const r=o.substr(s,1);if(s+=1,r.toLowerCase()!=="e")return"";const l=Dt(o,s);return l===""?"":r+l}function Rt(o,s){const r=o.substr(s,1);if(r==="0")return r;const l=Xe(o,s);return s+=l.length,l===""?"":l+It(o,s)}function xn(o,s){const r=Rt(o,s);if(s+=r.length,r==="")return"";const l=o.substr(s,1);if(s+=l.length,l!==".")return"";const v=It(o,s);return s+=v.length,r+l+v+en(o,s)}function yn(o,s){const r=o.substr(s,1);if(s+=r.length,r!==".")return"";const l=It(o,s);return s+=l.length,l===""?"":r+l+en(o,s)}function Ts(o,s){const r=Rt(o,s);return s+=r.length,r===""?"":r+en(o,s)}const Vs=Le([xn,yn,Ts]);function Ns(o,s){var r;const l=o.substr(s).match(/^[01]+/);return(r=l&&l[0])!==null&&r!==void 0?r:""}function Os(o,s){const r=o.substr(s,2);if(s+=r.length,r.toLowerCase()!=="0b")return"";const l=Ns(o,s);return l===""?"":r+l}function Cn(o,s){var r;const l=o.substr(s).match(/^[0-7]+/);return(r=l&&l[0])!==null&&r!==void 0?r:""}function Is(o,s){const r=o.substr(s,2);if(s+=r.length,r.toLowerCase()!=="0o")return"";const l=Cn(o,s);return l===""?"":r+l}function Ds(o,s){var r;const l=o.substr(s).match(/^[0-9a-f]+/i);return(r=l&&l[0])!==null&&r!==void 0?r:""}function Ft(o,s){const r=o.substr(s,2);if(s+=r.length,r.toLowerCase()!=="0x")return"";const l=Ds(o,s);return l===""?"":r+l}const Zn=Le([Os,Is,Ft]),Rs=Le([Zn,Vs]);function Pn(o,s){const r=Rs(o,s);return s+=r.length,r===""?null:{evaluable:new Me(r),cursor:s}}function Fs(o,s){const r=o.substr(s,1);if(s+=r.length,r!=="(")return null;const l=es(o,s);if(!l)return null;s=l.cursor,s+=st(o,s).length;const v=o.substr(s,1);return s+=v.length,v!==")"?null:{evaluable:l.evaluable,cursor:s}}function ft(o,s){var r;return(r=Pn(o,s))!==null&&r!==void 0?r:Fs(o,s)}function En(o,s){const r=ft(o,s);if(r)return r;const l=o.substr(s,1);if(s+=l.length,l!=="+"&&l!=="-"&&l!=="~")return null;const v=En(o,s);return v?(s=v.cursor,{cursor:s,evaluable:new xe(l,v.evaluable)}):null}function Qn(o,s,r){r+=st(s,r).length;const l=o.filter(v=>s.startsWith(v,r))[0];return l?(r+=l.length,r+=st(s,r).length,{cursor:r,operator:l}):null}function js(o,s){return(r,l)=>{const v=o(r,l);if(!v)return null;l=v.cursor;let w=v.evaluable;for(;;){const k=Qn(s,r,l);if(!k)break;l=k.cursor;const V=o(r,l);if(!V)return null;l=V.cursor,w=new Jt(k.operator,w,V.evaluable)}return w?{cursor:l,evaluable:w}:null}}const Jn=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((o,s)=>js(o,s),En);function es(o,s){return s+=st(o,s).length,Jn(o,s)}function Bs(o){const s=es(o,0);return!s||s.cursor+st(o,s.cursor).length!==o.length?null:s.evaluable}function jt(o){var s;const r=Bs(o);return(s=r==null?void 0:r.evaluate())!==null&&s!==void 0?s:null}function We(o){if(typeof o=="number")return o;if(typeof o=="string"){const s=jt(o);if(!b(s))return s}return 0}function pe(o){return s=>s.toFixed(Math.max(Math.min(o,20),0))}const Us=pe(0);function tn(o){return Us(o)+"%"}function ts(o){return String(o)}function kn(o,s){for(;o.length<s;)o.push(void 0)}function ns(o){const s=[];return kn(s,o),ee(s)}function ss(o){const s=o.indexOf(void 0);return s<0?o:o.slice(0,s)}function zs(o,s){const r=[...ss(o),s];return r.length>o.length?r.splice(0,r.length-o.length):kn(r,o.length),r}function Bt({primary:o,secondary:s,forward:r,backward:l}){let v=!1;function w(k){v||(v=!0,k(),v=!1)}o.emitter.on("change",k=>{w(()=>{s.setRawValue(r(o,s),k.options)})}),s.emitter.on("change",k=>{w(()=>{o.setRawValue(l(o,s),k.options)}),w(()=>{s.setRawValue(r(o,s),k.options)})}),w(()=>{s.setRawValue(r(o,s),{forceEmit:!1,last:!0})})}function bt(o,s){const r=o*(s.altKey?.1:1)*(s.shiftKey?10:1);return s.upKey?+r:s.downKey?-r:0}function Ut(o){return{altKey:o.altKey,downKey:o.key==="ArrowDown",shiftKey:o.shiftKey,upKey:o.key==="ArrowUp"}}function Mn(o){return{altKey:o.altKey,downKey:o.key==="ArrowLeft",shiftKey:o.shiftKey,upKey:o.key==="ArrowRight"}}function Ks(o){return o==="ArrowUp"||o==="ArrowDown"}function is(o){return Ks(o)||o==="ArrowLeft"||o==="ArrowRight"}function Ln(o,s){var r,l;const v=s.ownerDocument.defaultView,w=s.getBoundingClientRect();return{x:o.pageX-(((r=v&&v.scrollX)!==null&&r!==void 0?r:0)+w.left),y:o.pageY-(((l=v&&v.scrollY)!==null&&l!==void 0?l:0)+w.top)}}class Ze{constructor(s){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=s,this.emitter=new E,s.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),s.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),s.addEventListener("touchend",this.onTouchEnd_),s.addEventListener("mousedown",this.onMouseDown_)}computePosition_(s){const r=this.elem_.getBoundingClientRect();return{bounds:{width:r.width,height:r.height},point:s?{x:s.x,y:s.y}:null}}onMouseDown_(s){var r;s.preventDefault(),(r=s.currentTarget)===null||r===void 0||r.focus();const l=this.elem_.ownerDocument;l.addEventListener("mousemove",this.onDocumentMouseMove_),l.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:s.altKey,data:this.computePosition_(Ln(s,this.elem_)),sender:this,shiftKey:s.shiftKey})}onDocumentMouseMove_(s){this.emitter.emit("move",{altKey:s.altKey,data:this.computePosition_(Ln(s,this.elem_)),sender:this,shiftKey:s.shiftKey})}onDocumentMouseUp_(s){const r=this.elem_.ownerDocument;r.removeEventListener("mousemove",this.onDocumentMouseMove_),r.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:s.altKey,data:this.computePosition_(Ln(s,this.elem_)),sender:this,shiftKey:s.shiftKey})}onTouchStart_(s){s.preventDefault();const r=s.targetTouches.item(0),l=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:s.altKey,data:this.computePosition_(r?{x:r.clientX-l.left,y:r.clientY-l.top}:void 0),sender:this,shiftKey:s.shiftKey}),this.lastTouch_=r}onTouchMove_(s){const r=s.targetTouches.item(0),l=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:s.altKey,data:this.computePosition_(r?{x:r.clientX-l.left,y:r.clientY-l.top}:void 0),sender:this,shiftKey:s.shiftKey}),this.lastTouch_=r}onTouchEnd_(s){var r;const l=(r=s.targetTouches.item(0))!==null&&r!==void 0?r:this.lastTouch_,v=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:s.altKey,data:this.computePosition_(l?{x:l.clientX-v.left,y:l.clientY-v.top}:void 0),sender:this,shiftKey:s.shiftKey})}}function J(o,s,r,l,v){const w=(o-s)/(r-s);return l+w*(v-l)}function _t(o){return String(o.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Ve(o,s,r){return Math.min(Math.max(o,s),r)}const me=M("txt");class Sn{constructor(s,r){this.onChange_=this.onChange_.bind(this),this.props_=r.props,this.props_.emitter.on("change",this.onChange_),this.element=s.createElement("div"),this.element.classList.add(me(),me(void 0,"num")),r.arrayPosition&&this.element.classList.add(me(void 0,r.arrayPosition)),r.viewProps.bindClassModifiers(this.element);const l=s.createElement("input");l.classList.add(me("i")),l.type="text",r.viewProps.bindDisabled(l),this.element.appendChild(l),this.inputElement=l,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=r.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(me()),this.inputElement.classList.add(me("i"));const v=s.createElement("div");v.classList.add(me("k")),this.element.appendChild(v),this.knobElement=v;const w=s.createElementNS($,"svg");w.classList.add(me("g")),this.knobElement.appendChild(w);const k=s.createElementNS($,"path");k.classList.add(me("gb")),w.appendChild(k),this.guideBodyElem_=k;const V=s.createElementNS($,"path");V.classList.add(me("gh")),w.appendChild(V),this.guideHeadElem_=V;const R=s.createElement("div");R.classList.add(M("tt")()),this.knobElement.appendChild(R),this.tooltipElem_=R,r.value.emitter.on("change",this.onChange_),this.value=r.value,this.refresh()}onDraggingChange_(s){if(s.rawValue===null){this.element.classList.remove(me(void 0,"drg"));return}this.element.classList.add(me(void 0,"drg"));const r=s.rawValue/this.props_.get("draggingScale"),l=r+(r>0?-1:r<0?1:0),v=Ve(-l,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${l+v},0 L${l},4 L${l+v},8`,`M ${r},-1 L${r},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${r},4`);const w=this.props_.get("formatter");this.tooltipElem_.textContent=w(this.value.rawValue),this.tooltipElem_.style.left=`${r}px`}refresh(){const s=this.props_.get("formatter");this.inputElement.value=s(this.value.rawValue)}onChange_(){this.refresh()}}class Gs{constructor(s,r){var l;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=r.baseStep,this.parser_=r.parser,this.props=r.props,this.sliderProps_=(l=r.sliderProps)!==null&&l!==void 0?l:null,this.value=r.value,this.viewProps=r.viewProps,this.dragging_=ee(null),this.view=new Sn(s,{arrayPosition:r.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const v=new Ze(this.view.knobElement);v.emitter.on("down",this.onPointerDown_),v.emitter.on("move",this.onPointerMove_),v.emitter.on("up",this.onPointerUp_)}constrainValue_(s){var r,l;const v=(r=this.sliderProps_)===null||r===void 0?void 0:r.get("minValue"),w=(l=this.sliderProps_)===null||l===void 0?void 0:l.get("maxValue");let k=s;return v!==void 0&&(k=Math.max(k,v)),w!==void 0&&(k=Math.min(k,w)),k}onInputChange_(s){const l=s.currentTarget.value,v=this.parser_(l);b(v)||(this.value.rawValue=this.constrainValue_(v)),this.view.refresh()}onInputKeyDown_(s){const r=bt(this.baseStep_,Ut(s));r!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+r),{forceEmit:!1,last:!1})}onInputKeyUp_(s){bt(this.baseStep_,Ut(s))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(s){if(!s.point)return null;const r=s.point.x-s.bounds.width/2;return this.constrainValue_(this.originRawValue_+r*this.props.get("draggingScale"))}onPointerMove_(s){const r=this.computeDraggingValue_(s.data);r!==null&&(this.value.setRawValue(r,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(s){const r=this.computeDraggingValue_(s.data);r!==null&&(this.value.setRawValue(r,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}function it(o,s){o.write(s)}function rs(o){const s=o?Ie(o,ke):null;return s?s.step:null}function $s(o,s){const r=o&&Ie(o,ke);return r?_t(r.step):Math.max(_t(s),2)}function An(o){const s=rs(o);return s!=null?s:1}function os(o,s){var r;const l=o&&Ie(o,ke),v=Math.abs((r=l==null?void 0:l.step)!==null&&r!==void 0?r:s);return v===0?.1:Math.pow(10,Math.floor(Math.log10(v))-1)}function nn(o){return[o[0],o[1],o[2]]}function zt(o){const s=Ve(Math.floor(o),0,255).toString(16);return s.length===1?`0${s}`:s}function qs(o,s="#"){const r=nn(o.getComponents("rgb")).map(zt).join("");return`${s}${r}`}function as(o,s="#"){const r=o.getComponents("rgb"),l=[r[0],r[1],r[2],r[3]*255].map(zt).join("");return`${s}${l}`}function ls(o,s){const r=pe(s==="float"?2:0);return`rgb(${nn(o.getComponents("rgb",s)).map(v=>r(v)).join(", ")})`}function Hs(o){return s=>ls(s,o)}function Ys(o,s){const r=pe(2),l=pe(s==="float"?2:0);return`rgba(${o.getComponents("rgb",s).map((w,k)=>(k===3?r:l)(w)).join(", ")})`}function Xs(o){return s=>Ys(s,o)}function Ws(o){const s=[pe(0),tn,tn];return`hsl(${nn(o.getComponents("hsl")).map((l,v)=>s[v](l)).join(", ")})`}function Zs(o){const s=[pe(0),tn,tn,pe(2)];return`hsla(${o.getComponents("hsl").map((l,v)=>s[v](l)).join(", ")})`}function Tn(o,s){const r=pe(s==="float"?2:0),l=["r","g","b"];return`{${nn(o.getComponents("rgb",s)).map((w,k)=>`${l[k]}: ${r(w)}`).join(", ")}}`}function Kt(o){return s=>Tn(s,o)}function Qs(o,s){const r=pe(2),l=pe(s==="float"?2:0),v=["r","g","b","a"];return`{${o.getComponents("rgb",s).map((k,V)=>{const R=V===3?r:l;return`${v[V]}: ${R(k)}`}).join(", ")}}`}function Gt(o){return s=>Qs(s,o)}[...["int","float"].reduce((o,s)=>[...o,{format:{alpha:!1,mode:"rgb",notation:"func",type:s},stringifier:Hs(s)},{format:{alpha:!0,mode:"rgb",notation:"func",type:s},stringifier:Xs(s)},{format:{alpha:!1,mode:"rgb",notation:"object",type:s},stringifier:Kt(s)},{format:{alpha:!0,mode:"rgb",notation:"object",type:s},stringifier:Gt(s)}],[])];class Js{constructor(s){this.components=s.components,this.asm_=s.assembly}constrain(s){const r=this.asm_.toComponents(s).map((l,v)=>{var w,k;return(k=(w=this.components[v])===null||w===void 0?void 0:w.constrain(l))!==null&&k!==void 0?k:l});return this.asm_.fromComponents(r)}}const sn=M("pndtxt");class cs{constructor(s,r){this.textViews=r.textViews,this.element=s.createElement("div"),this.element.classList.add(sn()),this.textViews.forEach(l=>{const v=s.createElement("div");v.classList.add(sn("a")),v.appendChild(l.element),this.element.appendChild(v)})}}function ei(o,s,r){return new Gs(o,{arrayPosition:r===0?"fst":r===s.axes.length-1?"lst":"mid",baseStep:s.axes[r].baseStep,parser:s.parser,props:s.axes[r].textProps,value:ee(0,{constraint:s.axes[r].constraint}),viewProps:s.viewProps})}class Vn{constructor(s,r){this.value=r.value,this.viewProps=r.viewProps,this.acs_=r.axes.map((l,v)=>ei(s,r,v)),this.acs_.forEach((l,v)=>{Bt({primary:this.value,secondary:l.value,forward:w=>r.assembly.toComponents(w.rawValue)[v],backward:(w,k)=>{const V=r.assembly.toComponents(w.rawValue);return V[v]=k.rawValue,r.assembly.fromComponents(V)}})}),this.view=new cs(s,{textViews:this.acs_.map(l=>l.view)})}}function ti(o,s){return"step"in o&&!b(o.step)?new ke(o.step,s):null}function ni(o){return"max"in o&&!b(o.max)||"min"in o&&!b(o.min)?new mt({max:o.max,min:o.min}):null}const si={monitor:{defaultInterval:200,defaultLineCount:3}},Qe=M("grl");class ii{constructor(s,r){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=s.createElement("div"),this.element.classList.add(Qe()),r.viewProps.bindClassModifiers(this.element),this.formatter_=r.formatter,this.props_=r.props,this.cursor_=r.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const l=s.createElementNS($,"svg");l.classList.add(Qe("g")),l.style.height=`calc(var(--bld-us) * ${r.lineCount})`,this.element.appendChild(l),this.svgElem_=l;const v=s.createElementNS($,"polyline");this.svgElem_.appendChild(v),this.lineElem_=v;const w=s.createElement("div");w.classList.add(Qe("t"),M("tt")()),this.element.appendChild(w),this.tooltipElem_=w,r.value.emitter.on("change",this.onValueUpdate_),this.value=r.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const s=this.svgElem_.getBoundingClientRect(),r=this.value.rawValue.length-1,l=this.props_.get("minValue"),v=this.props_.get("maxValue"),w=[];this.value.rawValue.forEach(($e,Kn)=>{if($e===void 0)return;const Gn=J(Kn,0,r,0,s.width),at=J($e,l,v,s.height,0);w.push([Gn,at].join(","))}),this.lineElem_.setAttributeNS(null,"points",w.join(" "));const k=this.tooltipElem_,V=this.value.rawValue[this.cursor_.rawValue];if(V===void 0){k.classList.remove(Qe("t","a"));return}const R=J(this.cursor_.rawValue,0,r,0,s.width),ce=J(V,l,v,s.height,0);k.style.left=`${R}px`,k.style.top=`${ce}px`,k.textContent=`${this.formatter_(V)}`,k.classList.contains(Qe("t","a"))||(k.classList.add(Qe("t","a"),Qe("t","in")),oe(k),k.classList.remove(Qe("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class ri{constructor(s,r){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=r.props,this.value=r.value,this.viewProps=r.viewProps,this.cursor_=ee(-1),this.view=new ii(s,{cursor:this.cursor_,formatter:r.formatter,lineCount:r.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),!Wt(s))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const l=new Ze(this.view.element);l.emitter.on("down",this.onGraphPointerDown_),l.emitter.on("move",this.onGraphPointerMove_),l.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(s){const r=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(J(s.offsetX,0,r.width,0,this.value.rawValue.length))}onGraphPointerDown_(s){this.onGraphPointerMove_(s)}onGraphPointerMove_(s){if(!s.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(J(s.data.point.x,0,s.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}class oi{constructor(s){this.controller_=s}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(s){this.controller_.viewProps.set("disabled",s)}get title(){var s;return(s=this.controller_.props.get("title"))!==null&&s!==void 0?s:""}set title(s){this.controller_.props.set("title",s)}on(s,r){const l=r.bind(this);return this.controller_.emitter.on(s,()=>{l(new d(this))}),this}}class ai extends d{constructor(s,r,l){super(s),this.cell=r,this.index=l}}class li extends a{constructor(s){super(s),this.cellToApiMap_=new Map,this.emitter_=new E;const r=this.controller_.valueController;r.cellControllers.forEach((l,v)=>{const w=new oi(l);this.cellToApiMap_.set(l,w),l.emitter.on("click",()=>{const k=v%r.size[0],V=Math.floor(v/r.size[0]);this.emitter_.emit("click",{event:new ai(this,w,[k,V])})})})}cell(s,r){const l=this.controller_.valueController,v=l.cellControllers[r*l.size[0]+s];return this.cellToApiMap_.get(v)}on(s,r){const l=r.bind(this);return this.emitter_.on(s,v=>{l(v.event)}),this}}class ps{constructor(s,r){this.size=r.size;const[l,v]=this.size,w=[];for(let k=0;k<v;k++)for(let V=0;V<l;V++){const R=new ne(s,{props:se.fromObject(Object.assign({},r.cellConfig(V,k))),viewProps:Oe.create()});w.push(R)}this.cellCs_=w,this.viewProps=Oe.create(),this.viewProps.handleDispose(()=>{this.cellCs_.forEach(k=>{k.viewProps.set("disposed",!0)})}),this.view=new nt(s,{viewProps:this.viewProps,viewName:"btngrid"}),this.view.element.style.gridTemplateColumns=`repeat(${l}, 1fr)`,this.cellCs_.forEach(k=>{this.view.element.appendChild(k.view.element)})}get cellControllers(){return this.cellCs_}}const ci={id:"buttongrid",type:"blade",css:'.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us)*5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',accept(o){const s=W,r=B(o,{cells:s.required.function,size:s.required.array(s.required.number),view:s.required.constant("buttongrid"),label:s.optional.string});return r?{params:r}:null},controller(o){return new tt(o.document,{blade:o.blade,props:se.fromObject({label:o.params.label}),valueController:new ps(o.document,{cellConfig:o.params.cells,size:o.params.size})})},api(o){return!(o.controller instanceof tt)||!(o.controller.valueController instanceof ps)?null:new li(o.controller)}};class pi extends a{get label(){return this.controller_.props.get("label")}set label(s){this.controller_.props.set("label",s)}get value(){return this.controller_.valueController.value.rawValue}set value(s){this.controller_.valueController.value.rawValue=s}on(s,r){const l=r.bind(this);return this.controller_.valueController.value.emitter.on(s,v=>{l(new m(this,v.rawValue,void 0,v.options.last))}),this}}function Se(o,s,r){return o*(1-r)+s*r}const us=20,ui=.001,Nn=100;function di(o,s){let r=.25,l=.5,v=-1;for(let w=0;w<us;w++){const[k,V]=o.curve(l);if(l+=r*(k<s?1:-1),v=V,r*=.5,Math.abs(s-k)<ui)break}return v}class Be{constructor(s=0,r=0,l=1,v=1){this.cache_=[],this.comps_=[s,r,l,v]}get x1(){return this.comps_[0]}get y1(){return this.comps_[1]}get x2(){return this.comps_[2]}get y2(){return this.comps_[3]}static isObject(s){return b(s)||!Array.isArray(s)?!1:typeof s[0]=="number"&&typeof s[1]=="number"&&typeof s[2]=="number"&&typeof s[3]=="number"}static equals(s,r){return s.x1===r.x1&&s.y1===r.y1&&s.x2===r.x2&&s.y2===r.y2}curve(s){const r=Se(0,this.x1,s),l=Se(0,this.y1,s),v=Se(this.x1,this.x2,s),w=Se(this.y1,this.y2,s),k=Se(this.x2,1,s),V=Se(this.y2,1,s),R=Se(r,v,s),ce=Se(l,w,s),$e=Se(v,k,s),Kn=Se(w,V,s);return[Se(R,$e,s),Se(ce,Kn,s)]}y(s){if(this.cache_.length===0){const r=[];for(let l=0;l<Nn;l++)r.push(di(this,J(l,0,Nn-1,0,1)));this.cache_=r}return this.cache_[Math.round(J(Ve(s,0,1),0,1,0,Nn-1))]}toObject(){return[this.comps_[0],this.comps_[1],this.comps_[2],this.comps_[3]]}}const ds={toComponents:o=>o.toObject(),fromComponents:o=>new Be(...o)};function Ue(o){const s=pe(2);return`cubic-bezier(${o.toObject().map(l=>s(l)).join(", ")})`}const On=[0,.5,.5,1];function hi(o){const s=o.match(/^cubic-bezier\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*\)$/);if(!s)return new Be(...On);const r=[s[1],s[2],s[3],s[4]].reduce((l,v)=>{if(!l)return null;const w=Number(v);return isNaN(w)?null:[...l,w]},[]);return new Be(...r!=null?r:On)}const ie=M("cbz");class mi{constructor(s,r){this.element=s.createElement("div"),this.element.classList.add(ie()),r.viewProps.bindClassModifiers(this.element),r.foldable.bindExpandedClass(this.element,ie(void 0,"expanded")),I(r.foldable,"completed",Y(this.element,ie(void 0,"cpl")));const l=s.createElement("div");l.classList.add(ie("h")),this.element.appendChild(l);const v=s.createElement("button");v.classList.add(ie("b")),r.viewProps.bindDisabled(v);const w=s.createElementNS($,"svg");w.innerHTML='<path d="M2 13C8 13 8 3 14 3"/>',v.appendChild(w),l.appendChild(v),this.buttonElement=v;const k=s.createElement("div");if(k.classList.add(ie("t")),l.appendChild(k),this.textElement=k,r.pickerLayout==="inline"){const V=s.createElement("div");V.classList.add(ie("p")),this.element.appendChild(V),this.pickerElement=V}else this.pickerElement=null}}const gt=M("cbzp");class hs{constructor(s,r){this.element=s.createElement("div"),this.element.classList.add(gt()),r.viewProps.bindClassModifiers(this.element);const l=s.createElement("div");l.classList.add(gt("g")),this.element.appendChild(l),this.graphElement=l;const v=s.createElement("div");v.classList.add(gt("t")),this.element.appendChild(v),this.textElement=v}}function rn(o,s){const r=new MutationObserver(v=>{for(const w of v)w.type==="childList"&&w.addedNodes.forEach(k=>{!k.contains(k)||(s(),r.disconnect())})}),l=o.ownerDocument;r.observe(l.body,{attributes:!0,childList:!0,subtree:!0})}const ze=M("cbzg");function vi(o,s){return r=>s(o(r))}class fi{constructor(s,r){this.element=s.createElement("div"),this.element.classList.add(ze()),r.viewProps.bindClassModifiers(this.element),r.viewProps.bindTabIndex(this.element);const l=s.createElement("div");l.classList.add(ze("p")),this.element.appendChild(l),this.previewElement=l;const v=s.createElementNS($,"svg");v.classList.add(ze("g")),this.element.appendChild(v),this.svgElem_=v;const w=s.createElementNS($,"path");w.classList.add(ze("u")),this.svgElem_.appendChild(w),this.guideElem_=w;const k=s.createElementNS($,"polyline");k.classList.add(ze("l")),this.svgElem_.appendChild(k),this.lineElem_=k,this.handleElems_=[s.createElement("div"),s.createElement("div")],this.handleElems_.forEach(V=>{V.classList.add(ze("h")),this.element.appendChild(V)}),this.vectorElems_=[s.createElementNS($,"line"),s.createElementNS($,"line")],this.vectorElems_.forEach(V=>{V.classList.add(ze("v")),this.svgElem_.appendChild(V)}),this.value_=r.value,this.value_.emitter.on("change",this.onValueChange_.bind(this)),this.sel_=r.selection,this.handleElems_.forEach((V,R)=>{F(this.sel_,vi(ce=>ce===R,Y(V,ze("h","sel"))))}),rn(this.element,()=>{this.refresh()})}getVertMargin_(s){return s*.25}valueToPosition(s,r){const l=this.element.getBoundingClientRect(),v=l.width,w=l.height,k=this.getVertMargin_(w);return{x:J(s,0,1,0,v),y:J(r,0,1,w-k,k)}}positionToValue(s,r){const l=this.element.getBoundingClientRect(),v=l.width,w=l.height,k=this.getVertMargin_(w);return{x:Ve(J(s,0,v,0,1),0,1),y:J(r,w-k,k,0,1)}}refresh(){this.guideElem_.setAttributeNS(null,"d",[0,1].map(w=>{const k=this.valueToPosition(0,w),V=this.valueToPosition(1,w);return[`M ${k.x},${k.y}`,`L ${V.x},${V.y}`].join(" ")}).join(" "));const s=this.value_.rawValue,r=[];let l=0;for(;;){const w=this.valueToPosition(...s.curve(l));if(r.push([w.x,w.y].join(",")),l>=1)break;l=Math.min(l+.05,1)}this.lineElem_.setAttributeNS(null,"points",r.join(" "));const v=s.toObject();[0,1].forEach(w=>{const k=this.valueToPosition(w,w),V=this.valueToPosition(v[w*2],v[w*2+1]),R=this.vectorElems_[w];R.setAttributeNS(null,"x1",String(k.x)),R.setAttributeNS(null,"y1",String(k.y)),R.setAttributeNS(null,"x2",String(V.x)),R.setAttributeNS(null,"y2",String(V.y));const ce=this.handleElems_[w];ce.style.left=`${V.x}px`,ce.style.top=`${V.y}px`})}onValueChange_(){this.refresh()}}const ms=24,wt=400,ve=1e3,De=M("cbzprv");class Ke{constructor(s,r){this.stopped_=!0,this.startTime_=-1,this.onDispose_=this.onDispose_.bind(this),this.onTimer_=this.onTimer_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.element=s.createElement("div"),this.element.classList.add(De()),r.viewProps.bindClassModifiers(this.element);const l=s.createElementNS($,"svg");l.classList.add(De("g")),this.element.appendChild(l),this.svgElem_=l;const v=s.createElementNS($,"path");v.classList.add(De("t")),this.svgElem_.appendChild(v),this.ticksElem_=v;const w=s.createElement("div");w.classList.add(De("m")),this.element.appendChild(w),this.markerElem_=w,this.value_=r.value,this.value_.emitter.on("change",this.onValueChange_),r.viewProps.handleDispose(this.onDispose_),rn(this.element,()=>{this.refresh()})}play(){this.stop(),this.updateMarker_(0),this.markerElem_.classList.add(De("m","a")),this.startTime_=new Date().getTime()+wt,this.stopped_=!1,requestAnimationFrame(this.onTimer_)}stop(){this.stopped_=!0,this.markerElem_.classList.remove(De("m","a"))}onDispose_(){this.stop()}updateMarker_(s){const r=this.value_.rawValue.y(Ve(s,0,1));this.markerElem_.style.left=`${r*100}%`}refresh(){const s=this.svgElem_.getBoundingClientRect(),r=s.width,l=s.height,v=[],w=this.value_.rawValue;for(let k=0;k<ms;k++){const V=J(k,0,ms-1,0,1),R=J(w.y(V),0,1,0,r);v.push(`M ${R},0 v${l}`)}this.ticksElem_.setAttributeNS(null,"d",v.join(" "))}onTimer_(){if(this.startTime_===null)return;const s=new Date().getTime()-this.startTime_,r=s/ve;this.updateMarker_(r),s>ve+wt&&this.stop(),this.stopped_||requestAnimationFrame(this.onTimer_)}onValueChange_(){this.refresh(),this.play()}}function In(o,s,r,l){const v=r-o,w=l-s;return Math.sqrt(v*v+w*w)}function vs(o,s,r,l){const v=In(o,s,r,l),w=Math.atan2(l-s,r-o),k=Math.round(w/(Math.PI/4))*Math.PI/4;return{x:o+Math.cos(k)*v,y:s+Math.sin(k)*v}}class Dn{constructor(s,r){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=r.baseStep,this.value=r.value,this.sel_=ee(0),this.viewProps=r.viewProps,this.view=new fi(s,{selection:this.sel_,value:this.value,viewProps:this.viewProps}),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_),this.prevView_=new Ke(s,{value:this.value,viewProps:this.viewProps}),this.prevView_.element.addEventListener("mousedown",v=>{v.stopImmediatePropagation(),v.preventDefault(),this.prevView_.play()}),this.view.previewElement.appendChild(this.prevView_.element);const l=new Ze(this.view.element);l.emitter.on("down",this.onPointerDown_),l.emitter.on("move",this.onPointerMove_),l.emitter.on("up",this.onPointerUp_)}refresh(){this.view.refresh(),this.prevView_.refresh(),this.prevView_.play()}updateValue_(s,r,l){const v=this.sel_.rawValue,w=this.value.rawValue.toObject(),k=this.view.positionToValue(s.x,s.y),V=r?vs(v,v,k.x,k.y):k;w[v*2]=V.x,w[v*2+1]=V.y,this.value.setRawValue(new Be(...w),l)}onPointerDown_(s){const r=s.data;if(!r.point)return;const l=this.value.rawValue,v=this.view.valueToPosition(l.x1,l.y1),w=In(r.point.x,r.point.y,v.x,v.y),k=this.view.valueToPosition(l.x2,l.y2),V=In(r.point.x,r.point.y,k.x,k.y);this.sel_.rawValue=w<=V?0:1,this.updateValue_(r.point,s.shiftKey,{forceEmit:!1,last:!1})}onPointerMove_(s){const r=s.data;!r.point||this.updateValue_(r.point,s.shiftKey,{forceEmit:!1,last:!1})}onPointerUp_(s){const r=s.data;!r.point||this.updateValue_(r.point,s.shiftKey,{forceEmit:!0,last:!0})}onKeyDown_(s){is(s.key)&&s.preventDefault();const r=this.sel_.rawValue,l=this.value.rawValue.toObject();l[r*2]+=bt(this.baseStep_,Mn(s)),l[r*2+1]+=bt(this.baseStep_,Ut(s)),this.value.setRawValue(new Be(...l),{forceEmit:!1,last:!1})}onKeyUp_(s){is(s.key)&&s.preventDefault();const r=bt(this.baseStep_,Mn(s)),l=bt(this.baseStep_,Ut(s));r===0&&l===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class rt{constructor(s,r){this.value=r.value,this.viewProps=r.viewProps,this.view=new hs(s,{viewProps:this.viewProps}),this.gc_=new Dn(s,{baseStep:r.axis.baseStep,value:this.value,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.gc_.view.element);const l=Object.assign(Object.assign({},r.axis),{constraint:new mt({max:1,min:0})}),v=Object.assign(Object.assign({},r.axis),{constraint:void 0});this.tc_=new Vn(s,{assembly:ds,axes:[l,v,l,v],parser:jt,value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element)}get allFocusableElements(){return[this.gc_.view.element,...this.tc_.view.textViews.map(s=>s.inputElement)]}refresh(){this.gc_.refresh()}}class te{constructor(s,r){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=r.value,this.viewProps=r.viewProps,this.foldable_=_n(r.expanded),this.view=new mi(s,{foldable:this.foldable_,pickerLayout:r.pickerLayout,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("blur",this.onButtonBlur_),this.view.buttonElement.addEventListener("click",this.onButtonClick_),this.tc_=new H(s,{parser:hi,props:se.fromObject({formatter:Ue}),value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element),this.popC_=r.pickerLayout==="popup"?new P(s,{viewProps:this.viewProps}):null;const l=new rt(s,{axis:r.axis,value:this.value,viewProps:this.viewProps});l.allFocusableElements.forEach(v=>{v.addEventListener("blur",this.onPopupChildBlur_),v.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=l,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),F(this.popC_.shows,v=>{v&&l.refresh()}),Bt({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:v=>v.rawValue,backward:(v,w)=>w.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),qe(this.foldable_,this.view.pickerElement))}onButtonBlur_(s){if(!this.popC_)return;const r=s.relatedTarget;(!r||!this.popC_.view.element.contains(r))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.allFocusableElements[0].focus()}onPopupChildBlur_(s){if(!this.popC_)return;const r=this.popC_.view.element,l=Vt(s);l&&r.contains(l)||l&&l===this.view.buttonElement&&!Wt(r.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(s){!this.popC_||s.key==="Escape"&&(this.popC_.shows.rawValue=!1)}}function fs(){return new Js({assembly:ds,components:[0,1,2,3].map(o=>o%2===0?new mt({min:0,max:1}):void 0)})}const le={id:"cubic-bezier",type:"blade",css:'.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us)*5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',accept(o){const s=W,r=B(o,{value:s.required.array(s.required.number),view:s.required.constant("cubicbezier"),expanded:s.optional.boolean,label:s.optional.string,picker:s.optional.custom(l=>l==="inline"||l==="popup"?l:void 0)});return r?{params:r}:null},controller(o){var s,r;const l=new Be(...o.params.value),v=ee(l,{constraint:fs(),equals:Be.equals}),w=new te(o.document,{axis:{baseStep:.1,textProps:se.fromObject({draggingScale:.01,formatter:pe(2)})},expanded:(s=o.params.expanded)!==null&&s!==void 0?s:!1,pickerLayout:(r=o.params.picker)!==null&&r!==void 0?r:"popup",value:v,viewProps:o.viewProps});return new He(o.document,{blade:o.blade,props:se.fromObject({label:o.params.label}),valueController:w})},api(o){return!(o.controller instanceof He)||!(o.controller.valueController instanceof te)?null:new pi(o.controller)}};class bs extends a{begin(){this.controller_.valueController.begin()}end(){this.controller_.valueController.end()}}const ye=20;class bi{constructor(){this.start_=null,this.duration_=0,this.fps_=null,this.frameCount_=0,this.timestamps_=[]}get duration(){return this.duration_}get fps(){return this.fps_}begin(s){this.start_=s.getTime()}calculateFps_(s){if(this.timestamps_.length===0)return null;const r=this.timestamps_[0];return 1e3*(this.frameCount_-r.frameCount)/(s-r.time)}compactTimestamps_(){if(this.timestamps_.length<=ye)return;const s=this.timestamps_.length-ye;this.timestamps_.splice(0,s);const r=this.timestamps_[0].frameCount;this.timestamps_.forEach(l=>{l.frameCount-=r}),this.frameCount_-=r}end(s){if(this.start_===null)return;const r=s.getTime();this.duration_=r-this.start_,this.start_=null,this.fps_=this.calculateFps_(r),this.timestamps_.push({frameCount:this.frameCount_,time:r}),++this.frameCount_,this.compactTimestamps_()}}const Ge=M("fps");class Rn{constructor(s,r){this.element=s.createElement("div"),this.element.classList.add(Ge()),r.viewProps.bindClassModifiers(this.element),this.graphElement=s.createElement("div"),this.graphElement.classList.add(Ge("g")),this.element.appendChild(this.graphElement);const l=s.createElement("div");l.classList.add(Ge("l")),this.element.appendChild(l);const v=s.createElement("span");v.classList.add(Ge("v")),v.textContent="--",l.appendChild(v),this.valueElement=v;const w=s.createElement("span");w.classList.add(Ge("u")),w.textContent="FPS",l.appendChild(w)}}class _s{constructor(s,r){this.stopwatch_=new bi,this.onTick_=this.onTick_.bind(this),this.ticker_=r.ticker,this.ticker_.emitter.on("tick",this.onTick_),this.value_=r.value,this.viewProps=r.viewProps,this.view=new Rn(s,{viewProps:this.viewProps}),this.graphC_=new ri(s,{formatter:pe(0),lineCount:r.lineCount,props:se.fromObject({maxValue:r.maxValue,minValue:r.minValue}),value:this.value_,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.graphC_.view.element),this.viewProps.handleDispose(()=>{this.graphC_.viewProps.set("disposed",!0),this.ticker_.dispose()})}begin(){this.stopwatch_.begin(new Date)}end(){this.stopwatch_.end(new Date)}onTick_(){const s=this.stopwatch_.fps;if(s!==null){const r=this.value_.rawValue;this.value_.rawValue=zs(r,s),this.view.valueElement.textContent=s.toFixed(0)}}}function _i(o,s){return s===0?new Ye:new wn(o,s!=null?s:si.monitor.defaultInterval)}const Fn={id:"fpsgraph",type:"blade",accept(o){const s=W,r=B(o,{view:s.required.constant("fpsgraph"),interval:s.optional.number,label:s.optional.string,lineCount:s.optional.number,max:s.optional.number,min:s.optional.number});return r?{params:r}:null},controller(o){var s,r,l,v;const w=(s=o.params.interval)!==null&&s!==void 0?s:500;return new tt(o.document,{blade:o.blade,props:se.fromObject({label:o.params.label}),valueController:new _s(o.document,{lineCount:(r=o.params.lineCount)!==null&&r!==void 0?r:2,maxValue:(l=o.params.max)!==null&&l!==void 0?l:90,minValue:(v=o.params.min)!==null&&v!==void 0?v:0,ticker:_i(o.document,w),value:ns(80),viewProps:o.viewProps})})},api(o){return!(o.controller instanceof tt)||!(o.controller.valueController instanceof _s)?null:new bs(o.controller)}};class Ae{constructor(s,r){this.min=s,this.max=r}static isObject(s){if(typeof s!="object"||s===null)return!1;const r=s.min,l=s.max;return!(typeof r!="number"||typeof l!="number")}static equals(s,r){return s.min===r.min&&s.max===r.max}get length(){return this.max-this.min}toObject(){return{min:this.min,max:this.max}}}const on={fromComponents:o=>new Ae(o[0],o[1]),toComponents:o=>[o.min,o.max]};class xt{constructor(s){this.edge=s}constrain(s){var r,l,v,w,k,V,R,ce;if(s.min<=s.max)return new Ae((l=(r=this.edge)===null||r===void 0?void 0:r.constrain(s.min))!==null&&l!==void 0?l:s.min,(w=(v=this.edge)===null||v===void 0?void 0:v.constrain(s.max))!==null&&w!==void 0?w:s.max);const $e=(s.min+s.max)/2;return new Ae((V=(k=this.edge)===null||k===void 0?void 0:k.constrain($e))!==null&&V!==void 0?V:$e,(ce=(R=this.edge)===null||R===void 0?void 0:R.constrain($e))!==null&&ce!==void 0?ce:$e)}}const yt=M("rsltxt");class gs{constructor(s,r){this.sliderView_=r.sliderView,this.textView_=r.textView,this.element=s.createElement("div"),this.element.classList.add(yt());const l=s.createElement("div");l.classList.add(yt("s")),l.appendChild(this.sliderView_.element),this.element.appendChild(l);const v=s.createElement("div");v.classList.add(yt("t")),v.appendChild(this.textView_.element),this.element.appendChild(v)}}const be=M("rsl");class ws{constructor(s,r){this.maxValue_=r.maxValue,this.minValue_=r.minValue,this.element=s.createElement("div"),this.element.classList.add(be()),r.viewProps.bindClassModifiers(this.element),this.value_=r.value,this.value_.emitter.on("change",this.onValueChange_.bind(this));const l=s.createElement("div");l.classList.add(be("t")),this.element.appendChild(l),this.trackElement=l;const v=s.createElement("div");v.classList.add(be("b")),l.appendChild(v),this.barElement=v;const w=["min","max"].map(k=>{const V=s.createElement("div");return V.classList.add(be("k"),be("k",k)),l.appendChild(V),V});this.knobElements=[w[0],w[1]],this.update()}valueToX_(s){return Ve(J(s,this.minValue_,this.maxValue_,0,1),0,1)*100}update(){const s=this.value_.rawValue;s.length===0?this.element.classList.add(be(void 0,"zero")):this.element.classList.remove(be(void 0,"zero"));const r=[this.valueToX_(s.min),this.valueToX_(s.max)];this.barElement.style.left=`${r[0]}%`,this.barElement.style.right=`${100-r[1]}%`,this.knobElements.forEach((l,v)=>{l.style.left=`${r[v]}%`})}onValueChange_(){this.update()}}class jn{constructor(s,r){this.grabbing_=null,this.grabOffset_=0,this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.maxValue_=r.maxValue,this.minValue_=r.minValue,this.viewProps=r.viewProps,this.value=r.value,this.view=new ws(s,{maxValue:r.maxValue,minValue:r.minValue,value:this.value,viewProps:r.viewProps});const l=new Ze(this.view.trackElement);l.emitter.on("down",this.onPointerDown_),l.emitter.on("move",this.onPointerMove_),l.emitter.on("up",this.onPointerUp_)}ofs_(){return this.grabbing_==="min"?this.view.knobElements[0].getBoundingClientRect().width/2:this.grabbing_==="max"?-this.view.knobElements[1].getBoundingClientRect().width/2:0}valueFromData_(s){if(!s.point)return null;const r=(s.point.x+this.ofs_())/s.bounds.width;return J(r,0,1,this.minValue_,this.maxValue_)}onPointerDown_(s){if(!s.data.point)return;const r=s.data.point.x/s.data.bounds.width,l=this.value.rawValue,v=J(l.min,this.minValue_,this.maxValue_,0,1),w=J(l.max,this.minValue_,this.maxValue_,0,1);Math.abs(w-r)<=.025?this.grabbing_="max":Math.abs(v-r)<=.025?this.grabbing_="min":r>=v&&r<=w?(this.grabbing_="length",this.grabOffset_=J(r-v,0,1,0,this.maxValue_-this.minValue_)):r<v?(this.grabbing_="min",this.onPointerMove_(s)):r>w&&(this.grabbing_="max",this.onPointerMove_(s))}applyPointToValue_(s,r){const l=this.valueFromData_(s);if(l!==null){if(this.grabbing_==="min")this.value.setRawValue(new Ae(l,this.value.rawValue.max),r);else if(this.grabbing_==="max")this.value.setRawValue(new Ae(this.value.rawValue.min,l),r);else if(this.grabbing_==="length"){const v=this.value.rawValue.length;let w=l-this.grabOffset_,k=w+v;w<this.minValue_?(w=this.minValue_,k=this.minValue_+v):k>this.maxValue_&&(w=this.maxValue_-v,k=this.maxValue_),this.value.setRawValue(new Ae(w,k),r)}}}onPointerMove_(s){this.applyPointToValue_(s.data,{forceEmit:!1,last:!1})}onPointerUp_(s){this.applyPointToValue_(s.data,{forceEmit:!0,last:!0}),this.grabbing_=null}}class Bn{constructor(s,r){this.value=r.value,this.viewProps=r.viewProps,this.sc_=new jn(s,r);const l={baseStep:r.baseStep,constraint:r.constraint,textProps:se.fromObject({draggingScale:r.draggingScale,formatter:r.formatter})};this.tc_=new Vn(s,{assembly:on,axes:[l,l],parser:r.parser,value:this.value,viewProps:r.viewProps}),this.view=new gs(s,{sliderView:this.sc_.view,textView:this.tc_.view})}get textController(){return this.tc_}}function gi(o){return Ae.isObject(o)?new Ae(o.min,o.max):new Ae(0,0)}function an(o,s){o.writeProperty("max",s.max),o.writeProperty("min",s.min)}function Ct(o){const s=[],r=ni(o);r&&s.push(r);const l=ti(o);return l&&s.push(l),new xt(new Ot(s))}const Pt={id:"input-interval",type:"input",css:'.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us)*5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--bld-us));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--bld-us) - 8px);margin-top:calc((var(--bld-us) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--elm-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',accept:(o,s)=>{if(!Ae.isObject(o))return null;const r=W,l=B(s,{format:r.optional.function,max:r.optional.number,min:r.optional.number,step:r.optional.number});return l?{initialValue:new Ae(o.min,o.max),params:l}:null},binding:{reader:o=>gi,constraint:o=>Ct(o.params),equals:Ae.equals,writer:o=>an},controller(o){var s;const r=o.value,l=o.constraint;if(!(l instanceof xt))throw x.shouldNeverHappen();const v=(r.rawValue.min+r.rawValue.max)/2,w=(s=o.params.format)!==null&&s!==void 0?s:pe($s(l.edge,v)),k=l.edge&&Ie(l.edge,mt);if((k==null?void 0:k.minValue)!==void 0&&(k==null?void 0:k.maxValue)!==void 0)return new Bn(o.document,{baseStep:An(l.edge),constraint:l.edge,draggingScale:os(k,v),formatter:w,maxValue:k.maxValue,minValue:k.minValue,parser:jt,value:r,viewProps:o.viewProps});const V={baseStep:An(l.edge),constraint:l.edge,textProps:se.fromObject({draggingScale:v,formatter:w})};return new Vn(o.document,{assembly:on,axes:[V,V],parser:jt,value:r,viewProps:o.viewProps})}};class ln{constructor(s){this.controller_=s}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(s){this.controller_.viewProps.set("disabled",s)}get title(){var s;return(s=this.controller_.props.get("title"))!==null&&s!==void 0?s:""}set title(s){this.controller_.props.set("title",s)}}class wi extends m{constructor(s,r,l,v,w){super(s,v,w),this.cell=r,this.index=l}}class xi extends a{constructor(s){super(s),this.cellToApiMap_=new Map,this.controller_.valueController.cellControllers.forEach(l=>{const v=new ln(l);this.cellToApiMap_.set(l,v)})}get value(){return this.controller_.value}cell(s,r){const l=this.controller_.valueController,v=l.cellControllers[r*l.size[0]+s];return this.cellToApiMap_.get(v)}on(s,r){const l=r.bind(this);this.controller_.value.emitter.on(s,v=>{const w=this.controller_.valueController,k=w.findCellByValue(v.rawValue);if(!k)return;const V=this.cellToApiMap_.get(k);if(!V)return;const R=w.cellControllers.indexOf(k);l(new wi(this,V,[R%w.size[0],Math.floor(R/w.size[0])],v.rawValue,void 0))})}}const $t=M("rad");class yi{constructor(s,r){this.element=s.createElement("div"),this.element.classList.add($t()),r.viewProps.bindClassModifiers(this.element);const l=s.createElement("label");l.classList.add($t("l")),this.element.appendChild(l);const v=s.createElement("input");v.classList.add($t("i")),v.name=r.name,v.type="radio",r.viewProps.bindDisabled(v),l.appendChild(v),this.inputElement=v;const w=s.createElement("div");w.classList.add($t("b")),l.appendChild(w);const k=s.createElement("div");k.classList.add($t("t")),w.appendChild(k),I(r.props,"title",V=>{k.textContent=V})}}class ot{constructor(s,r){this.props=r.props,this.viewProps=r.viewProps,this.view=new yi(s,{name:r.name,props:this.props,viewProps:this.viewProps})}}class Un{constructor(s,r){this.cellCs_=[],this.cellValues_=[],this.onCellInputChange_=this.onCellInputChange_.bind(this),this.size=r.size;const[l,v]=this.size;for(let w=0;w<v;w++)for(let k=0;k<l;k++){const V=new ot(s,{name:r.groupName,props:se.fromObject(Object.assign({},r.cellConfig(k,w))),viewProps:Oe.create()});this.cellCs_.push(V),this.cellValues_.push(r.cellConfig(k,w).value)}this.value=r.value,F(this.value,w=>{const k=this.findCellByValue(w);!k||(k.view.inputElement.checked=!0)}),this.viewProps=Oe.create(),this.view=new nt(s,{viewProps:this.viewProps,viewName:"radgrid"}),this.view.element.style.gridTemplateColumns=`repeat(${l}, 1fr)`,this.cellCs_.forEach(w=>{w.view.inputElement.addEventListener("change",this.onCellInputChange_),this.view.element.appendChild(w.view.element)})}get cellControllers(){return this.cellCs_}findCellByValue(s){const r=this.cellValues_.findIndex(l=>l===s);return r<0?null:this.cellCs_[r]}onCellInputChange_(s){const r=s.currentTarget,l=this.cellCs_.findIndex(v=>v.view.inputElement===r);l<0||(this.value.rawValue=this.cellValues_[l])}}const Ci=function(){return{id:"radiogrid",type:"blade",accept(o){const s=W,r=B(o,{cells:s.required.function,groupName:s.required.string,size:s.required.array(s.required.number),value:s.required.raw,view:s.required.constant("radiogrid"),label:s.optional.string});return r?{params:r}:null},controller(o){return new He(o.document,{blade:o.blade,props:se.fromObject({label:o.params.label}),valueController:new Un(o.document,{groupName:o.params.groupName,cellConfig:o.params.cells,size:o.params.size,value:ee(o.params.value)})})},api(o){return!(o.controller instanceof He)||!(o.controller.valueController instanceof Un)?null:new xi(o.controller)}}}();function zn(o){return{id:"input-radiogrid",type:"input",accept(s,r){if(!o.isType(s))return null;const l=W,v=B(r,{cells:l.required.function,groupName:l.required.string,size:l.required.array(l.required.number),view:l.required.constant("radiogrid")});return v?{initialValue:s,params:v}:null},binding:o.binding,controller:s=>new Un(s.document,{cellConfig:s.params.cells,groupName:s.params.groupName,size:s.params.size,value:s.value})}}const Pi=zn({isType:o=>typeof o=="number",binding:{reader:o=>We,writer:o=>it}}),xs=zn({isType:o=>typeof o=="string",binding:{reader:o=>ts,writer:o=>it}}),Ei=zn({isType:o=>typeof o=="boolean",binding:{reader:o=>ae,writer:o=>it}}),ki=[ci,le,Fn,Pt,Ci,Ei,Pi,xs];p.CubicBezier=Be,p.plugins=ki,Object.defineProperty(p,"__esModule",{value:!0})})})(Xn,Xn.exports);const yo=_o(Xn.exports),Co=jr({__proto__:null,default:yo},[Xn.exports]);let Ht,Wn;const Po=(L="tres-container")=>{Ht=new Ss.exports.Pane({container:document.querySelector(L)||void 0}),Ht.registerPlugin(Co),Wn=Ht.addBlade({view:"fpsgraph",label:"fpsgraph"});function u(){Ht&&Ht.dispose()}return Te.onMounted(()=>{const{onBeforeLoop:p,onAfterLoop:a,resume:d}=Cs.useRenderLoop();d(),p(()=>Wn.begin()),a(()=>Wn.end())}),Te.onUnmounted(()=>{u()}),{pane:Ht,fpsGraph:Wn,disposeTweakPane:u}};let As=null;function Eo(L,u){return p=>{u&&u(p),As||(As=new go),As.setDecoderPath(L.decoderPath||"https://www.gstatic.com/draco/versioned/decoders/1.4.3/")}}async function er(L,u={draco:!1},p){return await Cs.useLoader(Ur,L,Eo(u,p))}const ko=Te.defineComponent({name:"GLTFModel",props:{path:String,draco:Boolean},async setup(L){const u=Te.inject("local-scene"),{scene:p}=await er(L.path,{draco:L.draco});return u!=null&&u.value&&u.value.add(p),()=>null}});Ne.GLTFModel=ko,Ne.OrbitControls=xo,Ne.useGLTF=er,Ne.useTweakPane=Po,Object.defineProperties(Ne,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
